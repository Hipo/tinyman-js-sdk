"use strict";var e=require("algosdk"),t=require("base64-js"),n=require("crypto");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(){s=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function p(e,t,n,a){var s=t&&t.prototype instanceof f?t:f,o=Object.create(s.prototype),i=new _(a||[]);return r(o,"_invoke",{value:y(e,n,i)}),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=p;var d={};function f(){}function m(){}function h(){}var g={};c(g,o,(function(){return this}));var A=Object.getPrototypeOf,x=A&&A(A(E([])));x&&x!==t&&n.call(x,o)&&(g=x);var I=h.prototype=f.prototype=Object.create(g);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function a(r,s,o,i){var u=l(e[r],e,s);if("throw"!==u.type){var c=u.arg,p=c.value;return p&&"object"==typeof p&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){a("next",e,o,i)}),(function(e){a("throw",e,o,i)})):t.resolve(p).then((function(e){c.value=e,o(c)}),(function(e){return a("throw",e,o,i)}))}i(u.arg)}var s;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){a(e,n,t,r)}))}return s=s?s.then(r,r):r()}})}function y(e,t,n){var r="suspendedStart";return function(a,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw s;return S()}for(n.method=a,n.arg=s;;){var o=n.delegate;if(o){var i=b(o,n);if(i){if(i===d)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var a=l(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,d;var s=a.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function E(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:S}}function S(){return{value:void 0,done:!0}}return m.prototype=h,r(I,"constructor",{value:h,configurable:!0}),r(h,"constructor",{value:m,configurable:!0}),m.displayName=c(h,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,u,"GeneratorFunction")),e.prototype=Object.create(I),e},e.awrap=function(e){return{__await:e}},w(v.prototype),c(v.prototype,i,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,r,a,s){void 0===s&&(s=Promise);var o=new v(p(t,n,r,a),s);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},w(I),c(I,u,"Generator"),c(I,o,(function(){return this})),c(I,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=E,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var i=n.call(s,"catchLoc"),u=n.call(s,"finallyLoc");if(i&&u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(i){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var s=a;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;k(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function o(e,t,n,r,a,s,o){try{var i=e[s](o),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,a)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function i(e){o(s,r,a,i,u,"next",e)}function u(e){o(s,r,a,i,u,"throw",e)}i(void 0)}))}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,k(r.key),r)}}function p(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e,t,n){return(t=k(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function g(e,t,n){return g=h()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&m(a,n.prototype),a},g.apply(null,arguments)}function A(e){var t="function"==typeof Map?new Map:void 0;return A=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return g(e,arguments,f(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),m(r,e)},A(e)}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){var t=h();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return x(e)}(this,n)}}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,s,o,i=[],u=!0,c=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=s.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){c=!0,a=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw a}}return i}}(e,t)||y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function T(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=y(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw s}}}}function k(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var _=function(e){return e.SwapRouterStaleDataError="SwapRouterStaleDataError",e.SwapRouterNoRouteError="SwapRouterNoRouteError",e.SwapRouterLowSwapAmountError="SwapRouterLowSwapAmountError",e.SwapRouterInsufficientReservesError="SwapRouterInsufficientReservesError",e.SwapRouterPoolHasNoLiquidityError="SwapRouterPoolHasNoLiquidityError",e.NoAvailablePoolError="NoAvailablePoolError",e.OutputAmountExceedsAvailableLiquidityError="OutputAmountExceedsAvailableLiquidityError",e.UnknownError="UnknownError",e.LowSwapAmountError="LowSwapAmountError",e.AssetDoesNotBelongToPoolError="AssetDoesNotBelongToPoolError",e.InvalidSwapTypeError="InvalidSwapTypeError",e}({}),E=function(e){d(n,A(Error));var t=I(n);function n(e,r){var a;return u(this,n),(a=t.call(this,r)).type=e,a.message=r,Error.captureStackTrace&&Error.captureStackTrace(x(a),n),a}return p(n)}(),S=Uint8Array.from([1]),P=1e5,D=1e5,O=1e5,N=1e5,L=1e5,B=5e4,C=28500,F=1e3,R=1e3,M={mainnet:{base:"https://mainnet.analytics.tinyman.org/api",v1:"https://mainnet.analytics.tinyman.org/api/v1"},testnet:{base:"https://testnet.analytics.tinyman.org/api",v1:"https://testnet.analytics.tinyman.org/api/v1"}},U={V1_1:"v1_1",V2:"v2"},j=0,V={id:"".concat(j),name:"Algorand",unit_name:"ALGO",decimals:6,url:"https://algorand.org",is_liquidity_token:!1,total_amount:"6615503326932151",clawback_address:""},X={V1:"TM1POOL",V1_1:"TMPOOL11",V2:"TMPOOL2"},G="- would result negative",q="logic eval error:",Q="exceeds schema integer count",W=/transaction \w+:/,z=function(e){d(n,A(Error));var t=I(n);function n(e,r){var a;u(this,n);for(var s=arguments.length,o=new Array(s>2?s-2:0),i=2;i<s;i++)o[i-2]=arguments[i];var c=(a=t.call.apply(t,[this].concat(o))).extractMessageFromAlgoSDKError(e);return a.data=e,a.type=a.getErrorType(c),a.setMessage(a.getErrorMessage(c,a.type,r)),a}return p(n,[{key:"setMessage",value:function(e){this.message=e}},{key:"getErrorType",value:function(e){var t="Unknown";return e.includes(G)?t="SlippageTolerance":e.includes(Q)?t="ExceedingExcessAmountCount":e.includes(q)?t="LogicError":e.match(W)&&(t="TransactionError"),t}},{key:"getErrorMessage",value:function(e,t,n){var r;switch(t){case"SlippageTolerance":r="The process failed due to too much slippage in the price. Please adjust the slippage tolerance and try again.";break;case"ExceedingExcessAmountCount":r="The process failed due to the number of excess amounts accumulated for your account in the Tinyman app.";break;case"LogicError":r=e.split(q)[1];break;case"TransactionError":r=e.split(W)[1];break;case"Unknown":e&&(r=e)}return r||(r=n||"We encountered an unexpected error, try again later."),r.trim()}},{key:"extractMessageFromAlgoSDKError",value:function(e){var t,n,r,a="";return null!=e&&null!==(t=e.response)&&void 0!==t&&null!==(n=t.body)&&void 0!==n&&n.message?a=e.response.body.message:null!=e&&null!==(r=e.response)&&void 0!==r&&r.text?a=e.response.text:"string"==typeof(null==e?void 0:e.message)&&(a=this.isMessageObjectString(null==e?void 0:e.message)?JSON.parse(e.message||"{message: ''}").message:e.message),"string"!=typeof a&&(a=String(a)),a}},{key:"isMessageObjectString",value:function(e){return"string"==typeof e&&e.includes("{message:")}}]),n}();function J(e){return K.apply(this,arguments)}function K(){return(K=i(s().mark((function t(n){var r,a,o,i,u;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.assetID,o=n.initiatorAddr,t.prev=1,t.next=4,r.getTransactionParams().do();case 4:return i=t.sent,u=e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:o,to:o,assetIndex:a,amount:0,suggestedParams:i}),t.abrupt("return",[{txn:u,signers:[o]}]);case 9:throw t.prev=9,t.t0=t.catch(1),new z(t.t0,"We encountered something unexpected while opting into this asset. Try again later.");case 12:case"end":return t.stop()}}),t,null,[[1,9]])})))).apply(this,arguments)}function Y(e,t){var n=Number(e.id),r=Number(t.id);return n>r?[a(a({},e),{},{id:n}),a(a({},t),{},{id:r})]:[a(a({},t),{},{id:r}),a(a({},e),{},{id:n})]}function H(e,t){var n=[e,t];return[Math.max.apply(Math,n),Math.min.apply(Math,n)]}function $(e){return Number(e)===j}function Z(e){return Number(e.id)}function ee(e){var t,n=e.stateArray,r=void 0===n?[]:n,a=e.shouldDecodeKeys,s=void 0!==a&&a,o={},i=T(r);try{for(i.s();!(t=i.n()).done;){var u=t.value,c=u.key,p=void 0;if(1==u.value.type)p=u.value.bytes;else{if(2!=u.value.type)throw new Error("Unexpected state type: ".concat(u.value.type));p=u.value.uint}o[s?atob(c):c]=p}}catch(e){i.e(e)}finally{i.f()}return o}function te(e){var t,n=e.reduce((function(e,t){return e+t.length}),0),r=new Uint8Array(n),a=0,s=T(e);try{for(s.s();!(t=s.n()).done;){var o=t.value;r.set(o,a),a+=o.length}}catch(e){s.e(e)}finally{s.f()}return r}var ne=100000n,re=100000n,ae=100000n,se=25000n+25000n,oe=25000n+3500n;function ie(e){var t=e["apps-total-schema"],n=0n,r=0n;t&&(t["num-byte-slice"]&&(n=t["num-byte-slice"]),t["num-uint"]&&(r=t["num-uint"]));var a=e["apps-local-state"]||[],s=e["created-apps"]||[],o=e.assets||[];return ne+re*BigInt(o.length)+ae*BigInt(s.length+a.length)+oe*r+se*n}function ue(e){return new Promise((function(t){setTimeout((function(){t(null)}),e)}))}function ce(e,t){return pe.apply(this,arguments)}function pe(){return(pe=i(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,ue(1e3);case 3:return r=null,e.prev=4,e.next=7,t.pendingTransactionInformation(n).do();case 7:r=e.sent,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(4);case 12:if(!r){e.next=17;break}if(!r["confirmed-round"]){e.next=15;break}return e.abrupt("return",r);case 15:if(!r["pool-error"]){e.next=17;break}throw new Error("Transaction Rejected: ".concat(r["pool-error"]));case 17:e.next=0;break;case 19:case"end":return e.stop()}}),e,null,[[4,10]])})))).apply(this,arguments)}function le(e,t,n){if(t>1||t<0)throw new Error("Invalid slippage value. Must be between 0 and 1, got ".concat(t));var r;try{var a="negative"===e?1-t:1+t;r=BigInt(Math.floor(Number(n)*a))}catch(e){throw new Error(e.message)}return r}function de(e,t){var n=Number(e);return fe({decimalPlaces:n},Math.pow(10,-n)*Number(t))}function fe(e,t){var n=e.decimalPlaces,r=void 0===n?0:n;if(r>0){var a=w(he(t),2),s=a[0],o=a[1],i=w(he(Math.round(Number(me(s,o+r)))),2),u=i[0],c=i[1];return Number(me(u,c-r))}return Math.round(t)}function me(e,t){return e+(t<0?"e".concat(t):"e+".concat(t))}function he(e){if(e.toString().includes("e")){var t=e.toString().split("e");return[parseFloat(t[0]),parseFloat(t[1])]}return[e,0]}function ge(e,t){return Ae.apply(this,arguments)}function Ae(){return(Ae=i(s().mark((function e(t,n){var r,a,o,i,u,c,p,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=[],a=T(n),e.prev=3,a.s();case 5:if((o=a.n()).done){e.next=18;break}return i=o.value,e.next=9,t.sendRawTransaction(i).do();case 9:return u=e.sent,c=u.txId,e.next=13,ce(t,c);case 13:p=e.sent,l=p["confirmed-round"],r.push({confirmedRound:l,txnID:c});case 16:e.next=5;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),a.e(e.t0);case 23:return e.prev=23,a.f(),e.finish(23);case 26:return e.abrupt("return",r);case 29:throw e.prev=29,e.t1=e.catch(0),new z(e.t1,"We encountered an error while processing this transaction. Try again later.");case 32:case"end":return e.stop()}}),e,null,[[0,29],[3,20,23,26]])})))).apply(this,arguments)}function xe(e){return e.reduce((function(e,t){return e+t.txn.fee}),0)}function Ie(e){return(t=e[0].txn.group)?Buffer.from(t).toString("base64"):"";var t}function we(e){for(var t=[];;){var n=Number(e&BigInt(127));if(!(e>>=BigInt(7))){t.push(n);break}t.push(128|n)}return t}function ve(e){return(new TextEncoder).encode(e)}var ye,be=new(function(){function e(){u(this,e),this.clientName="tinyman-js-sdk"}return p(e,[{key:"getClientName",value:function(){return this.clientName}},{key:"setClientName",value:function(e){this.clientName=e}},{key:"getAppCallTxnNoteWithClientName",value:function(e){var t=e===U.V1_1?"v1":e;return ve("tinyman/".concat(t,':j{"origin":"').concat(this.clientName,'"}'))}}]),e}()),Te=(l(ye={},U.V1_1,{testnet:62368684,mainnet:552635992}),l(ye,U.V2,{testnet:148607e3,mainnet:1002541853}),ye);function ke(e,t){var n=Te[t][e];if(!n)throw new Error("No Validator App exists for ".concat(e," network with ").concat(t," contract version"));return n}function _e(){return(_e=i(s().mark((function t(n){var r,a,o,i,u,c;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.network,o=n.contractVersion,i=n.initiatorAddr,t.next=3,r.getTransactionParams().do();case 3:return u=t.sent,c=e.makeApplicationOptInTxnFromObject({from:i,appIndex:ke(a,o),note:be.getAppCallTxnNoteWithClientName(o),suggestedParams:u}),t.abrupt("return",[{txn:c,signers:[i]}]);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ee(){return(Ee=i(s().mark((function t(n){var r,a,o,i,u,c;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.network,o=n.contractVersion,i=n.initiatorAddr,t.next=3,r.getTransactionParams().do();case 3:return u=t.sent,c=e.makeApplicationClearStateTxnFromObject({from:i,appIndex:ke(a,o),note:be.getAppCallTxnNoteWithClientName(o),suggestedParams:u}),t.abrupt("return",[{txn:c,signers:[i]}]);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Se,Pe,De,Oe=function(e){return e.FixedInput="fixed-input",e.FixedOutput="fixed-output",e}({}),Ne=.003,Le=function(e){return e[e.INPUT_TXN=0]="INPUT_TXN",e[e.APP_CALL_TXN=1]="APP_CALL_TXN",e}({}),Be=(l(Se={},Oe.FixedInput,1),l(Se,Oe.FixedOutput,2),Se),Ce=2,Fe=ve("swap"),Re=(l(Pe={},Oe.FixedInput,ve("fixed-input")),l(Pe,Oe.FixedOutput,ve("fixed-output")),Pe),Me={ASSET_OPT_IN:ve("asset_opt_in")},Ue={testnet:184778019,mainnet:1083651166},je=(l(De={},Oe.FixedInput,7),l(De,Oe.FixedOutput,8),De);function Ve(e){var t=Qe(e),n=t.assetIn,r=t.assetOut;return de(r.asset.decimals,Number(r.amount))/de(n.asset.decimals,Number(n.amount))}function Xe(e){var t=Ue[e];if(!t)throw new Error("Unknown network or network not supported: ".concat(e));return t}function Ge(e){return e[e.length-1].quote.amount_out}function qe(e){return e[0].quote.amount_in}function Qe(e){return{assetIn:qe(e),assetOut:Ge(e)}}function We(e){return ze.apply(this,arguments)}function ze(){return(ze=i(s().mark((function t(n){var r,a,o,i,u,c,p;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.routerAppID,o=n.assetIDs,i=n.initiatorAddr,t.next=3,r.getTransactionParams().do();case 3:return u=t.sent,c=e.makeApplicationNoOpTxnFromObject({from:i,appIndex:a,appArgs:[Me.ASSET_OPT_IN],foreignAssets:o,suggestedParams:u}),p=o.length,c.fee=e.ALGORAND_MIN_TX_FEE*(p+1),t.abrupt("return",c);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Je(e){return Ke.apply(this,arguments)}function Ke(){return(Ke=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,w,v,y,b,T,k,_,E,S,P,D;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.initiatorAddr,a=n.client,o=n.network,i=n.swapType,u=n.route,c=n.slippage,t.next=3,a.getTransactionParams().do();case 3:return p=t.sent,l=[Z(u[0].quote.amount_in.asset),Z(u[0].quote.amount_out.asset),Z(u[1].quote.amount_out.asset)],d=l[0],f=l[1],m=l[2],h=[Number(qe(u).amount),Number(Ge(u).amount)],g=h[0],A=h[1],x=[u[0].pool.address,u[1].pool.address],I=x[0],w=x[1],v=i===Oe.FixedInput?g:le("positive",c,g),y=i===Oe.FixedOutput?A:le("negative",c,A),b=$(d),T=Xe(o),k=b?e.makePaymentTxnWithSuggestedParamsFromObject({from:r,to:e.getApplicationAddress(T),amount:v,suggestedParams:p}):e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:r,to:e.getApplicationAddress(T),amount:v,assetIndex:d,suggestedParams:p}),(_=e.makeApplicationNoOpTxnFromObject({from:r,appIndex:T,appArgs:[Fe,Re[i],e.encodeUint64(y)],foreignApps:[ke(o,U.V2)],foreignAssets:[d,f,m],accounts:[I,w],suggestedParams:p,note:be.getAppCallTxnNoteWithClientName(U.V2)})).fee=e.ALGORAND_MIN_TX_FEE*(je[i]+1),E=[k,_],t.next=17,Ye({client:a,network:o,assetIDs:[d,f,m]});case 17:if(!((S=t.sent).length>0)){t.next=23;break}return t.next=21,We({client:a,initiatorAddr:r,assetIDs:S,routerAppID:T});case 21:P=t.sent,E.unshift(P);case 23:return D=e.assignGroupID(E),t.abrupt("return",D.map((function(e){return{txn:e,signers:[r]}})));case 25:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ye(e){return He.apply(this,arguments)}function He(){return(He=i(s().mark((function t(n){var r,a,o,i,u,c;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.network,o=n.assetIDs,i=e.getApplicationAddress(Xe(a)),t.next=4,r.accountInformation(i).do();case 4:return u=t.sent,c=u.assets.map((function(e){return e["asset-id"]})),t.abrupt("return",o.filter((function(e){return e!==j&&!c.includes(e)})));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function $e(e){return Ze.apply(this,arguments)}function Ze(){return(Ze=i(s().mark((function e(t){var n,r,a,o,i,u,c,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.amount,r=t.assetInID,a=t.assetOutID,o=t.swapType,i=t.network,u={asset_in_id:String(r),asset_out_id:String(a),swap_type:o,amount:String(n)},e.next=4,fetch("".concat(M[i].v1,"/swap-router/quotes/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).catch((function(){throw new Error("Network error")}));case 4:return c=e.sent,e.next=7,c.json();case 7:if(p=e.sent,c.ok){e.next=14;break}if(s=p,!Boolean(s)||void 0===s.fallback_message){e.next=13;break}throw new E(p.type,p.fallback_message);case 13:throw new E(_.UnknownError,"There was an error while getting a quote from Swap Router");case 14:if(!(p.route.length<2)){e.next=16;break}throw new E(_.SwapRouterNoRouteError,"Swap router couldn't find a route for this swap.");case 16:return e.abrupt("return",p);case 17:case"end":return e.stop()}var s}),e)})))).apply(this,arguments)}var et=function(e){return e.Direct="direct",e.Router="router",e}({}),tt=4*e.ALGORAND_MIN_TX_FEE;function nt(t){return(Be[t]+Ce)*e.ALGORAND_MIN_TX_FEE}function rt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ne;return Math.ceil(1/e)}function at(e){return e<rt(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ne)}function st(t){return(Be[t]+1)*e.ALGORAND_MIN_TX_FEE}function ot(e){var t=e.assetIn,n=e.assetOut;return de(n.decimals,Number(n.amount))/de(t.decimals,Number(t.amount))}function it(e){var t=e.inputSupply,n=e.outputSupply,r=e.assetIn,a=e.assetOut,s=ot({assetIn:r,assetOut:a}),o=de(a.decimals,Number(n))/de(r.decimals,Number(t));return fe({decimalPlaces:5},Math.abs(s/o-1))}function ut(e){if(e.type===et.Router){var t=qe(e.data.route);return{id:Z(t.asset),amount:Number(t.amount)}}return{id:e.data.quote.assetInID,amount:e.data.quote.assetInAmount}}function ct(e){if(e.type===et.Router){var t=Ge(e.data.route);return{id:Z(t.asset),amount:Number(t.amount)}}return{id:e.data.quote.assetOutID,amount:e.data.quote.assetOutAmount}}function pt(e){return e.type===et.Direct?e.data.pool.contractVersion:U.V2}function lt(e){return e.type===et.Direct?e.data.quote.rate:Ve(e.data.route)}function dt(e){for(var t=e[0],n=lt(t),r=1;r<e.length;r++){var a=e[r],s=lt(a);s>n&&(t=a,n=s)}return t}function ft(e){return e instanceof E&&[_.SwapRouterInsufficientReservesError,_.SwapRouterLowSwapAmountError,_.OutputAmountExceedsAvailableLiquidityError,_.LowSwapAmountError].includes(e.type)}var mt={type:"logicsig",logic:{bytecode:"BCAIAQCBgICAgICAgPABgICAgICAgIDwAQMEBQYlJA1EMQkyAxJEMRUyAxJEMSAyAxJEMgQiDUQzAQAxABJEMwEQIQcSRDMBGIGCgICAgICAgPABEkQzARkiEjMBGyEEEhA3ARoAgAlib290c3RyYXASEEAAXDMBGSMSRDMBG4ECEjcBGgCABHN3YXASEEACOzMBGyISRDcBGgCABG1pbnQSQAE7NwEaAIAEYnVybhJAAZg3ARoAgAZyZWRlZW0SQAJbNwEaAIAEZmVlcxJAAnkAIQYhBSQjEk0yBBJENwEaARclEjcBGgIXJBIQRDMCADEAEkQzAhAhBBJEMwIhIxJEMwIiIxwSRDMCIyEHEkQzAiQjEkQzAiWACFRNUE9PTDExEkQzAiZRAA+AD1RpbnltYW5Qb29sMS4xIBJEMwIngBNodHRwczovL3RpbnltYW4ub3JnEkQzAikyAxJEMwIqMgMSRDMCKzIDEkQzAiwyAxJEMwMAMQASRDMDECEFEkQzAxElEkQzAxQxABJEMwMSIxJEJCMTQAAQMwEBMwIBCDMDAQg1AUIBsTMEADEAEkQzBBAhBRJEMwQRJBJEMwQUMQASRDMEEiMSRDMBATMCAQgzAwEIMwQBCDUBQgF8MgQhBhJENwEcATEAE0Q3ARwBMwQUEkQzAgAxABNEMwIUMQASRDMDADMCABJEMwIRJRJEMwMUMwMHMwMQIhJNMQASRDMDESMzAxAiEk0kEkQzBAAxABJEMwQUMwIAEkQzAQEzBAEINQFCAREyBCEGEkQ3ARwBMQATRDcBHAEzAhQSRDMDFDMDBzMDECISTTcBHAESRDMCADEAEkQzAhQzBAASRDMCESUSRDMDADEAEkQzAxQzAwczAxAiEk0zBAASRDMDESMzAxAiEk0kEkQzBAAxABNEMwQUMQASRDMBATMCAQgzAwEINQFCAJAyBCEFEkQ3ARwBMQATRDMCADcBHAESRDMCADEAE0QzAwAxABJEMwIUMwIHMwIQIhJNMQASRDMDFDMDBzMDECISTTMCABJEMwEBMwMBCDUBQgA+MgQhBBJENwEcATEAE0QzAhQzAgczAhAiEk03ARwBEkQzAQEzAgEINQFCABIyBCEEEkQzAQEzAgEINQFCAAAzAAAxABNEMwAHMQASRDMACDQBD0M=",address:"ABUKAXTANWR6K6ZYV75DWJEPVWWOU6SFUVRI6QHO44E4SIDLHBTD2CZ64A",size:881,variables:[{name:"TMPL_ASSET_ID_1",type:"int",index:15,length:10},{name:"TMPL_ASSET_ID_2",type:"int",index:5,length:10},{name:"TMPL_VALIDATOR_APP_ID",type:"int",index:74,length:10}],source:"https://github.com/tinymanorg/tinyman-contracts-v1/tree/dc9ab40c58b85c15d58f63a1507e18be76720dbb/contracts/pool_logicsig.teal.tmpl"},name:"pool_logicsig"},ht={type:"app",global_state_schema:{num_uints:0,num_byte_slices:0},local_state_schema:{num_uints:16,num_byte_slices:0},name:"validator_app"},gt=p((function e(t){u(this,e),this.schema={numLocalInts:t.local_state_schema.num_uints,numLocalByteSlices:t.local_state_schema.num_byte_slices,numGlobalInts:t.global_state_schema.num_uints,numGlobalByteSlices:t.global_state_schema.num_byte_slices}})),At=function(n){d(a,gt);var r=I(a);function a(e,t){var n;return u(this,a),(n=r.call(this,e)).poolLogicSigContractTemplate=t.logic.bytecode,n.templateVariables=t.logic.variables,n}return p(a,[{key:"generateLogicSigAccountForPool",value:function(n){if(n.asset1ID===n.asset2ID)throw new Error("Assets are the same");var r=ke(n.network,U.V1_1),a=w(H(n.asset1ID,n.asset2ID),2),s=a[0],o=a[1],i=Array.from(t.toByteArray(this.poolLogicSigContractTemplate)),u={asset_id_1:s,asset_id_2:o,validator_app_id:r},c=0;this.templateVariables.sort((function(e,t){return e.index-t.index}));for(var p=0;p<this.templateVariables.length;p++){var l=this.templateVariables[p],d=u[l.name.split("TMPL_")[1].toLowerCase()],f=l.index-c,m=f+l.length,h=we(BigInt(d));c+=l.length-h.length,i=i.slice(0,f).concat(h).concat(i.slice(m))}var g=new Uint8Array(i);return new e.LogicSigAccount(g)}}]),a}(),xt=new At(ht,mt),It={type:"logicsig",logic:{bytecode:"BoAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgQBbNQA0ADEYEkQxGYEBEkSBAUM="},name:"pool_logicsig"},wt={type:"app",global_state_schema:{num_uints:0,num_byte_slices:3},local_state_schema:{num_uints:12,num_byte_slices:2},name:"validator_app"},vt=new(function(t){d(r,gt);var n=I(r);function r(e,t){var a;return u(this,r),(a=n.call(this,e)).poolLogicSigContractTemplate=t.logic.bytecode,a}return p(r,[{key:"generateLogicSigAccountForPool",value:function(t){if(t.asset1ID===t.asset2ID)throw new Error("Assets are the same");var n=ke(t.network,U.V2),r=w(H(t.asset1ID,t.asset2ID),2),a=r[0],s=r[1],o={bytes:Array.from(Buffer.from(this.poolLogicSigContractTemplate,"base64")),validatorAppId:Array.from(e.encodeUint64(n)),asset1ID:Array.from(e.encodeUint64(a)),asset2ID:Array.from(e.encodeUint64(s))},i=[].concat(v(o.bytes.slice(0,3)),v(o.validatorAppId.slice(0,8)),v(o.asset1ID.slice(0,8)),v(o.asset2ID.slice(0,8)),v(o.bytes.slice(27)));return new e.LogicSigAccount(new Uint8Array(i))}}]),r}())(wt,It);function yt(e){return function(e){return e===U.V2}(e)?vt:xt}function bt(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.IntDecoding.DEFAULT;return new Promise(function(){var e=i(s().mark((function e(o,i){var u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.accountInformation(n).setIntDecoding(r).do();case 3:u=e.sent,o(a(a({},u),{},{minimum_required_balance:kt(u)})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),i(new Error(e.t0.message||"Failed to fetch account information"));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}())}function Tt(e,t){var n=e["apps-local-state"].find((function(e){return e.id===t}));return n?ee({stateArray:n["key-value"],shouldDecodeKeys:!0}):null}function kt(e){var t=e["apps-total-schema"];return P+D*(e.assets||[]).length+N*(e["created-apps"]||[]).length+O*(e["apps-local-state"]||[]).length+B*Number(t&&t["num-byte-slice"]||0)+C*Number(t&&t["num-uint"]||0)+L*(e["apps-total-extra-pages"]||0)}var _t=ve("e");function Et(e){return St.apply(this,arguments)}function St(){return(St=i(s().mark((function n(r){var a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,w,v,y,b,k,_;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=r.client,o=r.pool,i=r.accountAddr,n.next=3,a.accountInformation(i).setIntDecoding(e.IntDecoding.BIGINT).do();case 3:u=n.sent,c=u["apps-local-state"]||[],p=0n,l=0n,d=0n,f=o.account.address(),m=T(c),n.prev=10,m.s();case 12:if((h=m.n()).done){n.next=31;break}if((g=h.value).id==o.validatorAppID){n.next=16;break}return n.abrupt("continue",29);case 16:if(A=g["key-value"]){n.next=19;break}return n.abrupt("break",31);case 19:x=ee({stateArray:A}),I=t.fromByteArray(te([e.decodeAddress(f).publicKey,_t,e.encodeUint64(o.asset1ID)])),w=t.fromByteArray(te([e.decodeAddress(f).publicKey,_t,e.encodeUint64(o.asset2ID)])),v=t.fromByteArray(te([e.decodeAddress(f).publicKey,_t,e.encodeUint64(o.poolTokenID)])),y=x[I],b=x[w],k=x[v],"bigint"==typeof y&&(p=y),"bigint"==typeof b&&(l=b),"bigint"==typeof k&&(d=k);case 29:n.next=12;break;case 31:n.next=36;break;case 33:n.prev=33,n.t0=n.catch(10),m.e(n.t0);case 36:return n.prev=36,m.f(),n.finish(36);case 39:if(!((_={excessAsset1:p,excessAsset2:l,excessPoolTokens:d}).excessAsset1<0n||_.excessAsset2<0n||_.excessPoolTokens<0n)){n.next=42;break}throw new Error("Invalid account excess: ".concat(_));case 42:return n.abrupt("return",_);case 43:case"end":return n.stop()}}),n,null,[[10,33,36,39]])})))).apply(this,arguments)}function Pt(){return(Pt=i(s().mark((function n(r){var a,o,i,u,c,p,l,d,f,m,h,g,A,x,I;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=r.client,o=r.accountAddr,i=r.validatorAppID,n.next=3,a.accountInformation(o).setIntDecoding(e.IntDecoding.BIGINT).do();case 3:if(u=n.sent,c=u["apps-local-state"]||[],p=c.find((function(e){return e.id==i})),l=[],p&&p["key-value"])for(d=ee({stateArray:p["key-value"]}),f=0,m=Object.entries(d);f<m.length;f++)h=m[f],g=w(h,2),A=g[0],x=g[1],41===(I=t.toByteArray(A)).length&&101===I[32]&&l.push({poolAddress:e.encodeAddress(I.slice(0,32)),assetID:e.decodeUint64(I.slice(33,41),"safe"),amount:parseInt(x)});return n.abrupt("return",l);case 9:case"end":return n.stop()}}),n)})))).apply(this,arguments)}var Dt,Ot=function(e){return e.NOT_CREATED="not created",e.BOOTSTRAP="bootstrap",e.READY="ready",e.ERROR="error",e}({}),Nt=(l(Dt={},U.V1_1,{asset1:"a1",asset2:"a2"}),l(Dt,U.V2,{asset1:"asset_1_id",asset2:"asset_2_id",poolTokenID:"pool_token_asset_id",issuedPoolTokens:"issued_pool_tokens",asset1Reserves:"asset_1_reserves",asset2Reserves:"asset_2_reserves",asset1ProtocolFees:"asset_1_protocol_fees",asset2ProtocolFees:"asset_2_protocol_fees",totalFeeShare:"total_fee_share",protocolFeeRatio:"protocol_fee_ratio",cumulativePriceUpdateTimeStamp:"cumulative_price_update_timestamp"}),Dt),Lt=1e3,Bt=ve("o"),Ct=0xffffffffffffffffn;function Ft(e){return Rt.apply(this,arguments)}function Rt(){return(Rt=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d,f,m,h,g;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.client,a=t.network,o=t.asset1ID,i=t.asset2ID,u=yt(U.V1_1),c=u.generateLogicSigAccountForPool(t),p=ke(a,U.V1_1),l=c.address(),d=H(o,i),e.next=8,bt(r,l);case 8:return f=e.sent,m=Tt(f,p),h=null===(n=f["created-assets"][0])||void 0===n?void 0:n.index,g={account:c,validatorAppID:p,asset1ID:d[0],asset2ID:d[1],status:m||h?Ot.READY:Ot.NOT_CREATED,contractVersion:U.V1_1,poolTokenID:h},m&&(g.asset1ID=m[Nt.v1_1.asset1],g.asset2ID=m[Nt.v1_1.asset2]),e.abrupt("return",g);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mt(){return(Mt=i(s().mark((function n(r,a){var o,i,u,c,p,l,d,f,m,h,g,A,x,I,w,v,y,b,k,_,E,S,P,D,O,N;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,bt(r,a.account.address(),e.IntDecoding.BIGINT);case 2:o=n.sent,i=o["apps-local-state"]||[],u=0n,c=0n,p=0n,l=T(i),n.prev=8,l.s();case 10:if((d=l.n()).done){n.next=29;break}if((f=d.value).id==a.validatorAppID){n.next=14;break}return n.abrupt("continue",27);case 14:if(m=f["key-value"]){n.next=17;break}return n.abrupt("break",29);case 17:h=ee({stateArray:m}),g=t.fromByteArray(te([Bt,e.encodeUint64(a.asset1ID)])),A=t.fromByteArray(te([Bt,e.encodeUint64(a.asset2ID)])),x=t.fromByteArray(te([Bt,e.encodeUint64(a.poolTokenID)])),I=h[g],w=h[A],v=h[x],"bigint"==typeof I&&(u=I),"bigint"==typeof w&&(c=w),"bigint"==typeof v&&(p=v);case 27:n.next=10;break;case 29:n.next=34;break;case 31:n.prev=31,n.t0=n.catch(8),l.e(n.t0);case 34:return n.prev=34,l.f(),n.finish(34);case 37:y=0n,b=0n,k=0n,_=T(o.assets);try{for(_.s();!(E=_.n()).done;)S=E.value,P=S["asset-id"],D=S.amount,P==a.asset1ID?y=BigInt(D):P==a.asset2ID?b=BigInt(D):P==a.poolTokenID&&(k=BigInt(D))}catch(e){_.e(e)}finally{_.f()}if(0===a.asset2ID&&(O=ie(o),(b=BigInt(o.amount)-O)<0n&&(b=0n)),!((N={asset1:y-u,asset2:b-c,issuedLiquidity:Ct-k+p,round:o.round}).asset1<0n||N.asset2<0n)){n.next=46;break}throw new Error("The pool reserves are below zero. The manager of one of the assets has used clawback to remove assets from this pool. Do not interact with the pool.");case 46:if(!(N.issuedLiquidity<0n||N.issuedLiquidity>Ct)){n.next=48;break}throw new Error("Issued liquidity value is out of the expected range ([0n, ".concat(Ct,"]): ").concat(N.issuedLiquidity));case 48:return n.abrupt("return",N);case 49:case"end":return n.stop()}}),n,null,[[8,31,34,37]])})))).apply(this,arguments)}function Ut(){return Ut=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.client,r=t.address,a=t.network,!(o=d.length>1&&void 0!==d[1]?d[1]:{})[r]){e.next=4;break}return e.abrupt("return",o[r]);case 4:return e.next=6,bt(n,r);case 6:return i=e.sent,u=Tt(i,ke(a,U.V1_1)),c=null,u&&(l=i["created-assets"][0],p=l.index,c={asset1ID:u[Nt[U.V1_1].asset1],asset2ID:u[Nt[U.V1_1].asset2],poolTokenID:p},o[r]=c),e.abrupt("return",c);case 11:case"end":return e.stop()}}),e)}))),Ut.apply(this,arguments)}var jt=Object.freeze({__proto__:null,getPoolAssets:function(e){return Ut.apply(this,arguments)},getPoolInfo:Ft,getPoolReserves:function(e,t){return Mt.apply(this,arguments)}});function Vt(e){return Xt.apply(this,arguments)}function Xt(){return(Xt=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d,f,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.network,a=t.asset1ID,o=t.asset2ID,i=yt(U.V2),u=i.generateLogicSigAccountForPool(t),c=ke(r,U.V2),p=u.address(),l=H(a,o),e.next=8,bt(n,p);case 8:return d=e.sent,f=Tt(d,c),m={account:u,validatorAppID:c,asset1ID:l[0],asset2ID:l[1],status:f?Ot.READY:Ot.NOT_CREATED,contractVersion:U.V2},f&&(m.asset1ProtocolFees=BigInt(f[Nt.v2.asset1ProtocolFees]),m.asset2ProtocolFees=BigInt(f[Nt.v2.asset2ProtocolFees]),m.asset1Reserves=BigInt(f[Nt.v2.asset1Reserves]),m.asset2Reserves=BigInt(f[Nt.v2.asset2Reserves]),m.issuedPoolTokens=BigInt(f[Nt.v2.issuedPoolTokens]),m.cumulativePriceUpdateTimeStamp=Number(f[Nt.v2.cumulativePriceUpdateTimeStamp]),m.protocolFeeRatio=Number(f[Nt.v2.protocolFeeRatio]),m.totalFeeShare=BigInt(f[Nt.v2.totalFeeShare]),m.poolTokenID=Number(f[Nt.v2.poolTokenID]),m.asset1ID=Number(f[Nt.v2.asset1]),m.asset2ID=Number(f[Nt.v2.asset2])),e.abrupt("return",m);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gt(){return(Gt=i(s().mark((function e(t,n){var r,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,bt(t,n.account.address());case 2:return r=e.sent,a=Tt(r,n.validatorAppID),o={asset1:0n,asset2:0n,issuedLiquidity:0n,round:r.round},a&&(o.asset1=BigInt(a[Nt.v2.asset1Reserves]),o.asset2=BigInt(a[Nt.v2.asset2Reserves]),o.issuedLiquidity=BigInt(a[Nt.v2.issuedPoolTokens])),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qt(){return(qt=i(s().mark((function e(t){var n,r,a,o,i,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.address,a=t.network,e.next=3,bt(n,r);case 3:return o=e.sent,i=Tt(o,ke(a,U.V2)),u=null,i&&(u={asset1ID:i[Nt[U.V2].asset1],asset2ID:i[Nt[U.V2].asset2],poolTokenID:i[Nt[U.V2].poolTokenID]}),e.abrupt("return",u);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Qt=Object.freeze({__proto__:null,getPoolAssets:function(e){return qt.apply(this,arguments)},getPoolInfo:Vt,getPoolReserves:function(e,t){return Gt.apply(this,arguments)}});function Wt(e){return Boolean(e&&!(e.asset1+e.asset2))}var zt,Jt=Object.freeze({__proto__:null,getPoolPairRatio:function(e){var t=Wt(e),n=null;return e&&!t&&e.asset1&&e.asset2&&(n=Number(e.asset1)/Number(e.asset2)),n},getPoolShare:function(e,t){var n=Number(t)/Number(e);return Number.isFinite(n)||(n=0),n},getPoolsForPair:function(e){return Promise.all([Ft(e),Vt(e)])},isPoolEmpty:Wt,isPoolNotCreated:function(e){return(null==e?void 0:e.status)===Ot.NOT_CREATED},isPoolReady:function(e){return(null==e?void 0:e.status)===Ot.READY}}),Kt=a((l(zt={},U.V1_1,a(a({},jt),Jt)),l(zt,U.V2,a(a({},Qt),Jt)),zt),Jt),Yt=function(e){return e[e.FUNDING_TXN=0]="FUNDING_TXN",e[e.VALIDATOR_APP_CALL=1]="VALIDATOR_APP_CALL",e[e.POOL_TOKEN_CREATE=2]="POOL_TOKEN_CREATE",e[e.ASSET1_OPT_IN=3]="ASSET1_OPT_IN",e[e.ASSET2_OPT_IN=4]="ASSET2_OPT_IN",e}({}),Ht={ASA_ALGO:96e4,ASA_ASA:859e3};function $t(){return($t=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,v,y,b,T,k,_,E,S,P;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.network,o=n.asset_1,i=n.asset_2,u=n.initiatorAddr,t.next=3,r.getTransactionParams().do();case 3:return c=t.sent,p=Y(o,i),l=w(p,2),d=l[0],f=d.id,m=d.unit_name,h=l[1],g=h.id,A=h.unit_name,x=$(g),I=ke(a,U.V1_1),v=xt.generateLogicSigAccountForPool({network:a,asset1ID:f,asset2ID:g}),y=v.address(),b=e.makeApplicationOptInTxnFromObject({from:y,appIndex:I,note:be.getAppCallTxnNoteWithClientName(U.V1_1),appArgs:[ve("bootstrap"),e.encodeUint64(f),e.encodeUint64(g)],foreignAssets:x?[f]:[g],suggestedParams:c}),T=e.makeAssetCreateTxnWithSuggestedParamsFromObject({from:y,total:0xffffffffffffffffn,decimals:6,defaultFrozen:!1,unitName:X.V1_1,assetName:"TinymanPool1.1 ".concat(m,"-").concat(A),assetURL:"https://tinyman.org",suggestedParams:c}),k=e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:y,to:y,assetIndex:f,amount:0,suggestedParams:c}),_=e.makePaymentTxnWithSuggestedParamsFromObject({from:u,to:y,amount:Zt(x),suggestedParams:c}),(E=[])[Yt.FUNDING_TXN]=_,E[Yt.VALIDATOR_APP_CALL]=b,E[Yt.POOL_TOKEN_CREATE]=T,E[Yt.ASSET1_OPT_IN]=k,x||(E[Yt.ASSET2_OPT_IN]=e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:y,to:y,assetIndex:g,amount:0,suggestedParams:c})),S=e.assignGroupID(E),P=[{txn:S[Yt.FUNDING_TXN],signers:[u]},{txn:S[Yt.VALIDATOR_APP_CALL],signers:[y]},{txn:S[Yt.POOL_TOKEN_CREATE],signers:[y]},{txn:S[Yt.ASSET1_OPT_IN],signers:[y]}],S[Yt.ASSET2_OPT_IN]&&P.push({txn:S[Yt.ASSET2_OPT_IN],signers:[y]}),t.abrupt("return",P);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Zt(e){return e?Ht.ASA_ALGO:Ht.ASA_ASA}function en(){return(en=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.txGroup,a=n.network,o=n.initiatorSigner,i=n.asset1ID,u=n.asset2ID,t.next=3,o([r]);case 3:return c=t.sent,p=w(c,1),l=p[0],d=H(i,u),f=w(d,2),m=f[0],h=f[1],g=xt.generateLogicSigAccountForPool({network:a,asset1ID:m,asset2ID:h}),A=[],x=r.map((function(t,n){if(n===Yt.FUNDING_TXN)return A.push(t.txn.txID().toString()),l;var r=e.signLogicSigTransactionObject(t.txn,g),a=r.txID,s=r.blob;return A.push(a),s})),t.abrupt("return",{signedTxns:x,txnIDs:A});case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function tn(e){return nn.apply(this,arguments)}function nn(){return(nn=i(s().mark((function e(t){var n,r,a,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.signedTxns,a=t.txnIDs,e.prev=1,e.next=4,n.sendRawTransaction(r).do();case 4:return e.next=6,ce(n,a[Yt.POOL_TOKEN_CREATE]);case 6:if(o=e.sent,"number"==typeof(i=o["asset-index"])){e.next=10;break}throw new Error("Generated ID is not valid: got ".concat(i));case 10:return e.abrupt("return",{poolTokenID:i});case 13:throw e.prev=13,e.t0=e.catch(1),new z(e.t0,"We encountered something unexpected while bootstraping the pool. Try again later.");case 16:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function rn(){return(rn=i(s().mark((function e(t){var n,r,a,o,i,u,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.network,a=t.pool,o=a.asset1ID,i=a.asset2ID,u=t.signedTxns,c=t.txnIDs,e.next=3,tn({client:n,signedTxns:u,txnIDs:c});case 3:return e.abrupt("return",Kt.v1_1.getPoolInfo({client:n,network:r,asset1ID:o,asset2ID:i}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var an={generateTxns:function(e){return $t.apply(this,arguments)},signTxns:function(e){return en.apply(this,arguments)},execute:function(e){return rn.apply(this,arguments)},getBootstrapFundingTxnAmount:Zt};var sn=function(e){return e[e.FUNDING_TXN=0]="FUNDING_TXN",e[e.VALIDATOR_APP_CALL=1]="VALIDATOR_APP_CALL",e}({}),on={ASA_ALGO:5,ASA_ASA:6};function un(e,t){return cn.apply(this,arguments)}function cn(){return(cn=i(s().mark((function t(n,r){var a,o,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(o=null===(a=r.find((function(e){return"appl"===e.txn.type})))||void 0===a?void 0:a.txn.txID())){t.next=7;break}return t.next=4,e.waitForConfirmation(n,o,R);case 4:t.t0=t.sent,t.next=8;break;case 7:t.t0=void 0;case 8:return i=t.t0,t.abrupt("return",i);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function pn(e,t){return ln.apply(this,arguments)}function ln(){return(ln=i(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,un(t,n);case 2:return r=e.sent,e.abrupt("return",null==r?void 0:r["inner-txns"]);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dn(e,t){return fn.apply(this,arguments)}function fn(){return(fn=i(s().mark((function t(n,r){var a,o;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,pn(n,r);case 2:return a=t.sent,s=r[0].txn,o=e.encodeAddress(s.from.publicKey),t.abrupt("return",null==a?void 0:a.reduce((function(t,n){var r=t,a=n.txn.txn;return a.type===e.TransactionType.axfer&&e.encodeAddress(a.arcv)===o?r.push({id:a.xaid,amount:a.aamt}):a.type===e.TransactionType.pay&&e.encodeAddress(a.rcv)===o&&r.push({id:j,amount:a.amt}),r}),[]));case 5:case"end":return t.stop()}var s}),t)})))).apply(this,arguments)}function mn(){return(mn=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,v,y,b,T;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.network,o=n.asset_1,i=n.asset_2,u=n.initiatorAddr,t.next=3,r.getTransactionParams().do();case 3:return c=t.sent,p=ke(a,U.V2),l=e.getApplicationAddress(p),d=Y(o,i),f=w(d,2),m=f[0].id,h=f[1].id,t.next=9,Kt.v2.getPoolInfo({client:r,network:a,asset1ID:m,asset2ID:h});case 9:if(t.sent.status!==Ot.READY){t.next=12;break}throw new Error("Pool for ".concat(o.unit_name,"-").concat(i.unit_name," already exists"));case 12:return g=vt.generateLogicSigAccountForPool({network:a,asset1ID:m,asset2ID:h}),A=g.address(),x=$(h),(I=e.makeApplicationOptInTxnFromObject({from:A,appIndex:p,appArgs:[ve("bootstrap")],note:be.getAppCallTxnNoteWithClientName(U.V2),foreignAssets:[m,h],rekeyTo:l,suggestedParams:c})).fee=gn(x),v=e.makePaymentTxnWithSuggestedParamsFromObject({from:u,to:A,amount:hn(x),suggestedParams:c}),(y=[])[sn.FUNDING_TXN]=v,y[sn.VALIDATOR_APP_CALL]=I,b=e.assignGroupID(y),(T=[])[sn.FUNDING_TXN]={txn:b[sn.FUNDING_TXN],signers:[u]},T[sn.VALIDATOR_APP_CALL]={txn:b[sn.VALIDATOR_APP_CALL],signers:[A]},t.abrupt("return",T);case 26:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function hn(e){return function(e,t){var n=yt(e).schema,r=n.numLocalInts,a=n.numLocalByteSlices,s=P+D+D+O+C*r+B*a;return t||(s+=D),s}(U.V2,e)+gn(e)+D}function gn(t){return((t?on.ASA_ALGO:on.ASA_ASA)+1)*e.ALGORAND_MIN_TX_FEE}function An(){return(An=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.txGroup,a=n.network,o=n.initiatorSigner,i=n.asset1ID,u=n.asset2ID,t.next=3,o([r]);case 3:return c=t.sent,p=w(c,1),l=p[0],d=H(i,u),f=w(d,2),m=f[0],h=f[1],g=vt.generateLogicSigAccountForPool({network:a,asset1ID:m,asset2ID:h}),A=[],x=r.map((function(t,n){if(n===sn.FUNDING_TXN)return A.push(t.txn.txID().toString()),l;var r=e.signLogicSigTransactionObject(t.txn,g),a=r.txID,s=r.blob;return A.push(a),s})),t.abrupt("return",{signedTxns:x,txnIDs:A});case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function xn(){return(xn=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.network,a=t.pool,o=a.asset1ID,i=a.asset2ID,u=t.txGroup,c=t.signedTxns,e.prev=1,e.next=4,n.sendRawTransaction(c).do();case 4:return e.next=6,un(n,u);case 6:if(e.t1=p=e.sent,e.t0=null===e.t1,e.t0){e.next=10;break}e.t0=void 0===p;case 10:if(!e.t0){e.next=14;break}e.t2=void 0,e.next=15;break;case 14:e.t2=null===(l=p["local-state-delta"][0].delta)||void 0===l||null===(d=l.find((function(e){return e.key===btoa(Nt.v2.poolTokenID)})))||void 0===d?void 0:d.value.uint;case 15:if("number"==typeof(f=e.t2)){e.next=18;break}throw new Error("Generated ID is not valid: got ".concat(f));case 18:return e.abrupt("return",Kt.v2.getPoolInfo({client:n,network:r,asset1ID:o,asset2ID:i}));case 21:throw e.prev=21,e.t3=e.catch(1),new z(e.t3,"We encountered something unexpected while bootstraping the pool. Try again later.");case 24:case"end":return e.stop()}}),e,null,[[1,21]])})))).apply(this,arguments)}var In,wn={generateTxns:function(e){return mn.apply(this,arguments)},signTxns:function(e){return An.apply(this,arguments)},execute:function(e){return xn.apply(this,arguments)},getBootstrapFundingTxnAmount:hn,getTotalCost:function(t){return e.ALGORAND_MIN_TX_FEE+hn(t)}};var vn,yn,bn,Tn,kn=(l(In={},U.V1_1,an),l(In,U.V2,wn),l(In,"generateTxns",(function(e){return e.contractVersion===U.V1_1?an.generateTxns(e):wn.generateTxns(e)})),l(In,"signTxns",(function(e){return e.contractVersion===U.V1_1?an.signTxns(e):wn.signTxns(e)})),l(In,"execute",(function(e){return e.contractVersion===U.V1_1?an.execute(e):wn.execute(e)})),l(In,"calculateBootstrapFundingTxnAmount",(function(e){var t=e.contractVersion,n=e.isAlgoPool;return t===U.V1_1?an.getBootstrapFundingTxnAmount(n):wn.getBootstrapFundingTxnAmount(n)})),In),_n=function(e){return e[e.FEE_TXN=0]="FEE_TXN",e[e.VALIDATOR_APP_CALL_TXN=1]="VALIDATOR_APP_CALL_TXN",e[e.ASSET1_IN_TXN=2]="ASSET1_IN_TXN",e[e.ASSET2_IN_TXN=3]="ASSET2_IN_TXN",e[e.LIQUDITY_OUT_TXN=4]="LIQUDITY_OUT_TXN",e}({}),En=5*e.ALGORAND_MIN_TX_FEE,Sn=function(e){return e.SINGLE="single",e.FLEXIBLE="flexible",e.INITIAL="initial",e}({}),Pn=(l(vn={},Sn.FLEXIBLE,{ASSET1_IN_TXN:0,ASSET2_IN_TXN:1,VALIDATOR_APP_CALL_TXN:2}),l(vn,Sn.SINGLE,{ASSET_IN_TXN:0,VALIDATOR_APP_CALL_TXN:1}),l(vn,Sn.INITIAL,{ASSET1_IN_TXN:0,ASSET2_IN_TXN:1,VALIDATOR_APP_CALL_TXN:2}),vn),Dn=(l(yn={},Sn.INITIAL,1),l(yn,Sn.SINGLE,2),l(yn,Sn.FLEXIBLE,2),yn),On=(l(bn={},Sn.INITIAL,3),l(bn,Sn.FLEXIBLE,3),l(bn,Sn.SINGLE,2),bn);function Nn(e){var t,n,r,a=e.reserves,s=e.totalFeeShare,o=e.asset1,i=e.asset2,u=a.asset1*a.asset2,c=a.asset1+BigInt(o.amount),p=a.asset2+BigInt(i.amount),l=c*p,d=BigInt(parseInt(String(Math.sqrt(Number(l*a.issuedLiquidity*a.issuedLiquidity/u))))),f=d-a.issuedLiquidity,m=f*c/d,h=f*p/d,g=BigInt(o.amount)-m,A=BigInt(i.amount)-h;if(g>A){var x=g;r=Bn(x,s),t={id:o.id,amount:x+r,decimals:o.decimals,reserves:a.asset1},n={id:i.id,amount:BigInt(Math.abs(Math.min(Number(A),0))),decimals:i.decimals,reserves:a.asset2},f-=r*d/(c*BigInt(2))}else{var I=A;r=Bn(I,s),t={id:i.id,amount:I+r,decimals:i.decimals,reserves:a.asset2},n={id:o.id,amount:BigInt(Math.abs(Math.min(Number(g),0))),decimals:o.decimals,reserves:a.asset1},f-=r*d/(p*BigInt(2))}return{poolTokenOutAmount:f,internalSwapQuote:{assetIn:t,assetOut:n,swapFees:r,priceImpact:it({inputSupply:t.reserves,outputSupply:n.reserves,assetIn:t,assetOut:n})}}}function Ln(e,t){if(!e.amount||!t.amount)throw new Error("Both assets are required for the initial add liquidity");return BigInt(Math.floor(Math.abs(Math.sqrt(Number(e.amount)*Number(t.amount))-Lt)))}function Bn(e,t){return e*BigInt(t)/(BigInt(1e4)-BigInt(t))}function Cn(t){return(Dn[t]+1)*e.ALGORAND_MIN_TX_FEE}var Fn=ve("add_liquidity"),Rn=(l(Tn={},U.V1_1,[ve("mint")]),l(Tn,U.V2,{INITIAL_LIQUIDITY:[ve("add_initial_liquidity")],SINGLE_ASSET_MODE:[Fn,ve("single")],FLEXIBLE_MODE:[Fn,ve("flexible")]}),Tn);function Mn(){return(Mn=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.network,o=n.poolAddress,i=n.asset1In,u=n.asset2In,c=n.poolTokenOut,p=n.slippage,l=n.initiatorAddr,d=le("negative",p,c.amount),t.next=4,r.getTransactionParams().do();case 4:return f=t.sent,m=e.makeApplicationNoOpTxnFromObject({from:o,appIndex:ke(a,U.V1_1),appArgs:Rn.v1_1,accounts:[l],note:be.getAppCallTxnNoteWithClientName(U.V1_1),foreignAssets:u.id==j?[i.id,c.id]:[i.id,u.id,c.id],suggestedParams:f}),h=e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:o,assetIndex:i.id,amount:i.amount,suggestedParams:f}),g=u.id===j?e.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:o,amount:u.amount,suggestedParams:f}):e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:o,assetIndex:u.id,amount:u.amount,suggestedParams:f}),A=e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:o,to:l,assetIndex:c.id,amount:d,suggestedParams:f}),x=e.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:o,amount:m.fee+A.fee,note:S,suggestedParams:f}),I=e.assignGroupID([x,m,h,g,A]),t.abrupt("return",[{txn:I[0],signers:[l]},{txn:I[1],signers:[o]},{txn:I[2],signers:[l]},{txn:I[3],signers:[l]},{txn:I[4],signers:[o]}]);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Un(){return(Un=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.pool,a=n.txGroup,o=n.initiatorSigner,i=r.account,t.next=4,o([a]);case 4:return u=t.sent,c=w(u,3),p=c[0],l=c[1],d=c[2],f=a.map((function(t,n){return n===_n.FEE_TXN?p:n===_n.ASSET1_IN_TXN?l:n===_n.ASSET2_IN_TXN?d:e.signLogicSigTransactionObject(t.txn,i).blob})),t.abrupt("return",f);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function jn(){return(jn=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.pool,a=t.txGroup,o=t.signedTxns,i=t.initiatorAddr,e.prev=1,u=BigInt(a[_n.LIQUDITY_OUT_TXN].txn.amount),e.next=5,Et({client:n,pool:r,accountAddr:i});case 5:return c=e.sent,e.next=8,ge(n,[o]);case 8:return p=e.sent,l=w(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,h=xe(a),g=Ie(a),e.next=17,Et({client:n,pool:r,accountAddr:i});case 17:return A=e.sent,(x=A.excessPoolTokens-c.excessPoolTokens)<0n&&(x=0n),e.abrupt("return",{round:f,fees:h,poolTokenID:r.poolTokenID,poolTokenOut:u+x,excessAmount:{excessAmountForAddingLiquidity:x,totalExcessAmount:A.excessPoolTokens},txnID:m,groupID:g});case 23:throw e.prev=23,e.t0=e.catch(1),"SlippageTolerance"===(I=new z(e.t0,"We encountered something unexpected while adding liquidity. Try again later.")).type&&I.setMessage("Adding liquidity failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),I;case 28:case"end":return e.stop()}}),e,null,[[1,23]])})))).apply(this,arguments)}var Vn=Object.freeze({__proto__:null,execute:function(e){return jn.apply(this,arguments)},generateTxns:function(e){return Mn.apply(this,arguments)},getQuote:function(e){var t=e.pool,n=e.reserves,r=e.asset1In,a=e.asset2In;if(0n===n.issuedLiquidity){var s=BigInt(Math.floor(Math.sqrt(Number(r)*Number(a))));if(s<=BigInt(F))throw new Error("Initial liquidity amount is too small. The amount must be greater than ".concat(F,", this quote is for ").concat(s,"."));return{round:n.round,asset1ID:t.asset1ID,asset1In:BigInt(r),asset2ID:t.asset2ID,asset2In:BigInt(a),poolTokenID:t.poolTokenID,poolTokenOut:s-BigInt(F),share:1}}var o=BigInt(r)*n.issuedLiquidity/n.asset1,i=BigInt(a)*n.issuedLiquidity/n.asset2,u=o<i?o:i;return{round:n.round,asset1ID:t.asset1ID,asset1In:BigInt(r),asset2ID:t.asset2ID,asset2In:BigInt(a),poolTokenID:t.poolTokenID,poolTokenOut:u,share:Kt.getPoolShare(n.issuedLiquidity+u,u)}},signTxns:function(e){return Un.apply(this,arguments)}});function Xn(e){var t=e.txGroup;return(0,e.initiatorSigner)([t])}function Gn(e){return qn.apply(this,arguments)}function qn(){return(qn=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d,f,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.pool,a=t.txGroup,o=t.signedTxns,e.prev=1,e.next=4,ge(n,[o]);case 4:return i=e.sent,u=w(i,1),c=u[0],p=c.confirmedRound,l=c.txnID,e.prev=9,e.next=12,dn(n,a);case 12:if(e.t1=f=e.sent,e.t0=null===e.t1,e.t0){e.next=16;break}e.t0=void 0===f;case 16:if(!e.t0){e.next=20;break}e.t2=void 0,e.next=21;break;case 20:e.t2=f.find((function(e){return e.id===r.poolTokenID}));case 21:d=e.t2,e.next=26;break;case 24:e.prev=24,e.t3=e.catch(9);case 26:return e.abrupt("return",{round:p,assetOut:d,fees:xe(a),poolTokenID:r.poolTokenID,txnID:l,groupID:Ie(a)});case 29:throw e.prev=29,e.t4=e.catch(1),"SlippageTolerance"===(m=new z(e.t4,"We encountered something unexpected while adding liquidity. Try again later.")).type&&m.setMessage("Adding liquidity failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),m;case 34:case"end":return e.stop()}}),e,null,[[1,29],[9,24]])})))).apply(this,arguments)}function Qn(){return(Qn=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,y,b;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.network,o=n.poolAddress,i=n.asset1In,u=n.asset2In,c=n.poolTokenOut,p=n.initiatorAddr,l=n.minPoolTokenAssetAmount,t.next=3,r.getTransactionParams().do();case 3:return d=t.sent,f=Y(i,u),m=w(f,2),h=m[0],g=m[1],A=$(g.id),x=e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:o,assetIndex:h.id,amount:h.amount,suggestedParams:d}),I=A?e.makePaymentTxnWithSuggestedParamsFromObject({from:p,to:o,amount:g.amount,suggestedParams:d}):e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:o,assetIndex:g.id,amount:g.amount,suggestedParams:d}),(y=e.makeApplicationNoOpTxnFromObject({from:p,appIndex:ke(a,U.V2),note:be.getAppCallTxnNoteWithClientName(U.V2),appArgs:[].concat(v(Rn.v2.FLEXIBLE_MODE),[e.encodeUint64(l)]),accounts:[o],foreignAssets:[c.id],suggestedParams:d})).fee=Cn(Sn.FLEXIBLE),b=e.assignGroupID([x,I,y]),t.abrupt("return",[{txn:b[0],signers:[p]},{txn:b[1],signers:[p]},{txn:b[2],signers:[p]}]);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Wn=Object.freeze({__proto__:null,execute:Gn,generateTxns:function(e){return Qn.apply(this,arguments)},getQuote:function(e){var t=e.pool,n=e.slippage,r=void 0===n?.05:n,a=e.asset1,s=e.asset2;if(0n===t.issuedPoolTokens)throw new Error("Pool has no liquidity at the moment. To be able to do Flexible Swap, you should first add initial liquidity.");if(t.status!==Ot.READY)throw new Error("Pool is not ready");if(!t.poolTokenID)throw new Error("Pool token ID is not available");var o={asset1:t.asset1Reserves||0n,asset2:t.asset2Reserves||0n,issuedLiquidity:t.issuedPoolTokens||0n},i=Nn({reserves:o,totalFeeShare:t.totalFeeShare,asset1:{id:t.asset1ID,amount:a.amount,decimals:a.decimals},asset2:{id:t.asset2ID,amount:s.amount,decimals:s.decimals}}),u=i.poolTokenOutAmount,c=i.internalSwapQuote,p=u-BigInt(Math.ceil(Number(u)*r));return{asset1In:{id:t.asset1ID,amount:BigInt(a.amount)},asset2In:{id:t.asset2ID,amount:BigInt(s.amount)},poolTokenOut:{id:t.poolTokenID,amount:u},share:Kt.getPoolShare(o.issuedLiquidity+u,u),slippage:r,internalSwapQuote:c,minPoolTokenAssetAmountWithSlippage:p}},signTxns:Xn});function zn(){return(zn=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.network,o=n.poolAddress,i=n.assetIn,u=n.poolTokenId,c=n.initiatorAddr,p=n.minPoolTokenAssetAmount,t.next=3,r.getTransactionParams().do();case 3:return l=t.sent,d=$(i.id),f=d?e.makePaymentTxnWithSuggestedParamsFromObject({from:c,to:o,amount:i.amount,suggestedParams:l}):e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:c,to:o,assetIndex:i.id,amount:i.amount,suggestedParams:l}),(m=e.makeApplicationNoOpTxnFromObject({from:c,appIndex:ke(a,U.V2),note:be.getAppCallTxnNoteWithClientName(U.V2),appArgs:[].concat(v(Rn.v2.SINGLE_ASSET_MODE),[e.encodeUint64(p)]),accounts:[o],foreignAssets:[u],suggestedParams:l})).fee=Cn(Sn.SINGLE),h=e.assignGroupID([f,m]),t.abrupt("return",[{txn:h[0],signers:[c]},{txn:h[1],signers:[c]}]);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Jn=Object.freeze({__proto__:null,execute:Gn,generateTxns:function(e){return zn.apply(this,arguments)},getQuote:function(e){var t=e.pool,n=e.assetIn,r=e.slippage,a=void 0===r?.05:r,s=e.decimals;if(0n===t.issuedPoolTokens)throw new Error("Pool has no liquidity");if(t.status!==Ot.READY)throw new Error("Pool is not ready");if(!t.poolTokenID)throw new Error("Pool token ID is not available");var o=n.id===t.asset1ID,i=n.id===t.asset2ID;if(!o&&!i)throw new Error("Provided input asset id didn't match any asset of the pool");var u={id:t.asset1ID,amount:o?n.amount:0,decimals:s.asset1},c={id:t.asset2ID,amount:i?n.amount:0,decimals:s.asset2},p={asset1:t.asset1Reserves||0n,asset2:t.asset2Reserves||0n,issuedLiquidity:t.issuedPoolTokens||0n},l=Nn({reserves:p,totalFeeShare:t.totalFeeShare||0,asset1:u,asset2:c}),d=l.poolTokenOutAmount,f=l.internalSwapQuote,m=d-BigInt(Math.ceil(Number(d)*a));return{assetIn:{id:o?t.asset1ID:t.asset2ID,amount:BigInt(n.amount)},poolTokenOut:{id:t.poolTokenID,amount:d},share:Kt.getPoolShare(p.issuedLiquidity+d,d),slippage:a,internalSwapQuote:f,minPoolTokenAssetAmountWithSlippage:m}},signTxns:Xn});function Kn(){return(Kn=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.pool,o=n.network,i=n.poolAddress,u=n.asset1In,c=n.asset2In,p=n.poolTokenId,l=n.initiatorAddr,d=$(a.asset2ID),t.next=4,r.getTransactionParams().do();case 4:return f=t.sent,m=e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:i,assetIndex:a.asset1ID,amount:u.amount,suggestedParams:f}),h=d?e.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:i,amount:c.amount,suggestedParams:f}):e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:i,assetIndex:a.asset2ID,amount:c.amount,suggestedParams:f}),(g=e.makeApplicationNoOpTxnFromObject({from:l,appIndex:ke(o,U.V2),appArgs:Rn.v2.INITIAL_LIQUIDITY,note:be.getAppCallTxnNoteWithClientName(U.V2),accounts:[i],foreignAssets:[p],suggestedParams:f})).fee=Cn(Sn.INITIAL),t.abrupt("return",e.assignGroupID([m,h,g]).map((function(e){return{txn:e,signers:[l]}})));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Yn,Hn=Object.freeze({__proto__:null,execute:Gn,generateTxns:function(e){return Kn.apply(this,arguments)},getQuote:function(e){var t=e.pool,n=e.asset1,r=e.asset2,a=e.slippage,s=void 0===a?.05:a;if(0n!==t.issuedPoolTokens)throw new Error("Pool already has liquidity");var o=BigInt(Math.floor(Math.sqrt(Number(n.amount)*Number(r.amount))));if(o<=BigInt(Lt))throw new Error("Initial liquidity amount is too small. Liquidity amount must be greater than ".concat(Lt,", this quote is for ").concat(o,"."));return{asset1In:{id:t.asset1ID,amount:BigInt(n.amount)},asset2In:{id:t.asset2ID,amount:BigInt(r.amount)},poolTokenOut:{id:t.poolTokenID,amount:Ln(n,r)},slippage:s}},signTxns:Xn}),$n=Object.freeze({__proto__:null,flexible:Wn,initial:Hn,withSingleAsset:Jn}),Zn=(l(Yn={},U.V1_1,Vn),l(Yn,U.V2,$n),Yn),er=function(e){return e[e.FEE_TXN=0]="FEE_TXN",e[e.VALIDATOR_APP_CALL_TXN=1]="VALIDATOR_APP_CALL_TXN",e[e.ASSET1_OUT_TXN=2]="ASSET1_OUT_TXN",e[e.ASSET2_OUT_TXN=3]="ASSET2_OUT_TXN",e[e.POOL_TOKEN_IN_TXN=4]="POOL_TOKEN_IN_TXN",e}({}),tr=Object.values(er).length,nr=2,rr=ve("remove_liquidity"),ar=function(e){return e[e.ASSET_TRANSFER_TXN=0]="ASSET_TRANSFER_TXN",e[e.APP_CALL_TXN=1]="APP_CALL_TXN",e}({});function sr(){return(sr=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,w,v,y,b;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.pool,o=n.poolTokenIn,i=n.asset1Out,u=n.asset2Out,c=n.slippage,p=n.initiatorAddr,t.next=3,r.getTransactionParams().do();case 3:return l=t.sent,d=a.account.address(),f=$(a.asset2ID),m=e.makeApplicationNoOpTxnFromObject({from:d,appIndex:a.validatorAppID,appArgs:[ve("burn")],note:be.getAppCallTxnNoteWithClientName(U.V1_1),accounts:[p],foreignAssets:f?[a.asset1ID,a.poolTokenID]:[a.asset1ID,a.asset2ID,a.poolTokenID],suggestedParams:l}),h=le("negative",c,i),g=e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:d,to:p,assetIndex:a.asset1ID,amount:h,suggestedParams:l}),A=le("negative",c,u),x=f?e.makePaymentTxnWithSuggestedParamsFromObject({from:d,to:p,amount:A,suggestedParams:l}):e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:d,to:p,assetIndex:a.asset2ID,amount:A,suggestedParams:l}),I=e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:d,assetIndex:a.poolTokenID,amount:o,suggestedParams:l}),w=m.fee+g.fee+x.fee,v=e.makePaymentTxnWithSuggestedParamsFromObject({from:p,to:d,amount:w,note:S,suggestedParams:l}),(y=[])[er.FEE_TXN]=v,y[er.VALIDATOR_APP_CALL_TXN]=m,y[er.ASSET1_OUT_TXN]=g,y[er.ASSET2_OUT_TXN]=x,y[er.POOL_TOKEN_IN_TXN]=I,b=e.assignGroupID(y),t.abrupt("return",[{txn:b[er.FEE_TXN],signers:[p]},{txn:b[er.VALIDATOR_APP_CALL_TXN],signers:[d]},{txn:b[er.ASSET1_OUT_TXN],signers:[d]},{txn:b[er.ASSET2_OUT_TXN],signers:[d]},{txn:b[er.POOL_TOKEN_IN_TXN],signers:[p]}]);case 22:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function or(){return(or=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.pool,a=n.txGroup,o=n.initiatorSigner,t.next=3,o([a]);case 3:return i=t.sent,u=w(i,2),c=u[0],p=u[1],l=r.account,d=a.map((function(t,n){return n===er.FEE_TXN?c:n===er.POOL_TOKEN_IN_TXN?p:e.signLogicSigTransactionObject(t.txn,l).blob})),t.abrupt("return",d);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ir(){return(ir=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,v;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.pool,a=t.txGroup,o=t.signedTxns,i=t.initiatorAddr,e.prev=1,u=a[er.ASSET1_OUT_TXN].txn.amount,c=a[er.ASSET2_OUT_TXN].txn.amount,p=a[er.POOL_TOKEN_IN_TXN].txn.amount,e.next=7,Et({client:n,pool:r,accountAddr:i});case 7:return l=e.sent,e.next=10,ge(n,[o]);case 10:return d=e.sent,f=w(d,1),m=f[0],h=m.confirmedRound,g=m.txnID,e.next=17,Et({client:n,pool:r,accountAddr:i});case 17:return A=e.sent,(x=A.excessAsset1-l.excessAsset1)<0n&&(x=0n),(I=A.excessAsset2-l.excessAsset2)<0n&&(I=0n),e.abrupt("return",{round:h,fees:xe(a),asset1ID:r.asset1ID,asset1Out:BigInt(u)+x,asset2ID:r.asset2ID,asset2Out:BigInt(c)+I,poolTokenID:r.poolTokenID,poolTokenIn:BigInt(p),excessAmounts:[{assetID:r.asset1ID,excessAmountForBurning:x,totalExcessAmount:A.excessAsset1},{assetID:r.asset2ID,excessAmountForBurning:I,totalExcessAmount:A.excessAsset2}],txnID:g,groupID:Ie(a)});case 25:throw e.prev=25,e.t0=e.catch(1),"SlippageTolerance"===(v=new z(e.t0,"We encountered something unexpected while burning liquidity. Try again later.")).type&&v.setMessage("The burn failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),v;case 30:case"end":return e.stop()}}),e,null,[[1,25]])})))).apply(this,arguments)}var ur={generateTxns:function(e){return sr.apply(this,arguments)},getQuote:function(e){var t=e.pool,n=e.reserves,r=e.poolTokenIn,a=BigInt(r),s=n.issuedLiquidity&&a*n.asset1/n.issuedLiquidity,o=n.issuedLiquidity&&a*n.asset2/n.issuedLiquidity;return{round:n.round,poolTokenID:t.poolTokenID,poolTokenIn:a,asset1ID:t.asset1ID,asset1Out:s,asset2ID:t.asset2ID,asset2Out:o}},signTxns:function(e){return or.apply(this,arguments)},execute:function(e){return ir.apply(this,arguments)}};function cr(){return(cr=i(s().mark((function t(n){var r,o,i,u,c,p,l,d,f,m,h,g,A,x,I,w,v,y,b,T;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.quote.type!==et.Router){t.next=2;break}return t.abrupt("return",Je(a(a({},n),{},{route:n.quote.data.route})));case 2:if(r=n.client,o=n.initiatorAddr,i=n.slippage,u=n.swapType,c=n.quote,p=c.data,l=p.pool,d=p.quote,f=d.assetInID,m=d.assetOutID,h=l.account.address(),(g=[l.asset1ID,l.asset2ID]).includes(f)&&g.includes(m)&&f!==m){t.next=9;break}throw new z({pool:l,quote:c},"Input asset (#".concat(f,") and output asset (#").concat(m,") provided to generate transactions do not belong to the pool ").concat(h,"."));case 9:return t.next=11,r.getTransactionParams().do();case 11:return A=t.sent,x=$(f),I=u===Oe.FixedInput?d.assetInAmount:le("positive",i,d.assetInAmount),w=u===Oe.FixedOutput?d.assetOutAmount:le("negative",i,d.assetOutAmount),v=x?e.makePaymentTxnWithSuggestedParamsFromObject({from:o,to:h,amount:I,suggestedParams:A}):e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:o,to:h,amount:I,assetIndex:f,suggestedParams:A}),(y=e.makeApplicationNoOpTxnFromObject({from:o,appIndex:l.validatorAppID,appArgs:[Fe,Re[u],e.encodeUint64(w)],note:be.getAppCallTxnNoteWithClientName(U.V2),accounts:[h],foreignAssets:[l.asset1ID,l.asset2ID],suggestedParams:A})).fee=st(u),(b=[])[Le.INPUT_TXN]=v,b[Le.APP_CALL_TXN]=y,T=e.assignGroupID(b),t.abrupt("return",[{txn:T[Le.INPUT_TXN],signers:[o]},{txn:T[Le.APP_CALL_TXN],signers:[o]}]);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function pr(){return(pr=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.client,i=t.quote,u=t.txGroup,c=t.signedTxns,e.next=3,ge(o,[c]);case 3:return p=e.sent,l=w(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,h=ct(i).id,g=ut(i),e.prev=10,e.next=13,dn(o,u);case 13:A=e.sent,e.next=18;break;case 16:e.prev=16,e.t0=e.catch(10);case 18:return x=null===(n=A)||void 0===n||null===(r=n.find((function(e){return e.id===g.id})))||void 0===r?void 0:r.amount,I=null===(a=A)||void 0===a?void 0:a.find((function(e){return e.id===h})),e.abrupt("return",{round:f,assetIn:{amount:BigInt(g.amount)-BigInt(x||0),id:g.id},assetOut:I,quote:i,txnID:m});case 21:case"end":return e.stop()}}),e,null,[[10,16]])})))).apply(this,arguments)}function lr(){return(lr=i(s().mark((function e(t){var n,r,a,o,i,u,c,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.type,r=t.amount,a=t.assetIn,o=t.assetOut,i=t.network,u=t.isSwapRouterEnabled,c=t.pool,n!==Oe.FixedInput){e.next=7;break}return e.next=4,hr({assetIn:a,assetOut:o,amount:r,isSwapRouterEnabled:u,network:i,pool:c});case 4:p=e.sent,e.next=10;break;case 7:return e.next=9,Ar({amount:r,assetIn:a,assetOut:o,isSwapRouterEnabled:u,network:i,pool:c});case 9:p=e.sent;case 10:return e.abrupt("return",p);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dr(e){return Promise.allSettled(e).then((function(e){if(e.every((function(e){return"rejected"===e.status}))){var t=e[0].reason;if(2===e.length){var n=e[1].reason;if(ft(t)&&!ft(n))throw t;throw n}throw t}return e.filter((function(e){return"fulfilled"===e.status&&e.value})).map((function(e){return e.value}))}))}function fr(e){var t=e.amount,n=e.assetIn,r=e.assetOut,a=e.pool;if(!Kt.isPoolReady(a))throw new E(_.NoAvailablePoolError,"There is not an available pool for this asset pair");var s,o,i=n.id,u=n.decimals,c=r.id,p=r.decimals,l=BigInt(t),d=a.totalFeeShare;if(i===a.asset1ID)s=a.asset1Reserves,o=a.asset2Reserves;else{if(i!==a.asset2ID)throw new E(_.AssetDoesNotBelongToPoolError,"Input asset (#".concat(i,") doesn't belong to the pool ").concat(a.account.address(),"."));s=a.asset2Reserves,o=a.asset1Reserves}var f=Ir({inputSupply:s,outputSupply:o,swapInputAmount:l,totalFeeShare:d,decimals:{assetIn:u,assetOut:p}}),m=f.swapOutputAmount,h=f.totalFeeAmount,g=f.priceImpact;if(m>o)throw new E(_.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");if(at(Number(t)))throw new E(_.LowSwapAmountError,"Swap amount is too low.");return{assetInID:i,assetInAmount:l,assetOutID:c,assetOutAmount:m,swapFee:Number(h),rate:de(p,Number(m))/de(u,Number(l)),priceImpact:g}}function mr(e){var t=e.amount,n=e.assetIn,r=e.assetOut,a=e.pool;if(!a||!Kt.isPoolReady(a))throw new E(_.NoAvailablePoolError,"There is not an available pool for this asset pair");var s,o,i=n.id,u=n.decimals,c=r.id,p=r.decimals,l=BigInt(t),d=a.totalFeeShare;if(c===a.asset1ID)s=a.asset2Reserves,o=a.asset1Reserves;else{if(c!==a.asset2ID)throw new E(_.AssetDoesNotBelongToPoolError,"Output asset (#".concat(c,") doesn't belong to the pool ").concat(a.account.address(),"."));s=a.asset1Reserves,o=a.asset2Reserves}var f=function(e){var t=e.inputSupply,n=e.outputSupply,r=e.swapOutputAmount,a=e.totalFeeShare,s=e.decimals,o=function(e){var t=e.inputSupply,n=e.outputSupply,r=e.outputAmount,a=t*n,s=BigInt(a/(n-r))-t;return s+=BigInt(1),s}({inputSupply:t,outputSupply:n,outputAmount:r}),i=function(e){var t=e.swapAmount,n=e.totalFeeShare,r=Math.floor(Number(t*BigInt(1e4)/(BigInt(1e4)-BigInt(n)))),a=BigInt(r)-t;return a}({swapAmount:o,totalFeeShare:a}),u=o+i,c=it({inputSupply:t,outputSupply:n,assetIn:{amount:u,decimals:s.assetIn},assetOut:{amount:r,decimals:s.assetOut}});return{swapInputAmount:u,totalFeeAmount:i,priceImpact:c}}({inputSupply:s,outputSupply:o,swapOutputAmount:l,totalFeeShare:d,decimals:{assetIn:u,assetOut:p}}),m=f.swapInputAmount,h=f.totalFeeAmount,g=f.priceImpact;if(l>o)throw new E(_.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");if(at(Number(m)))throw new E(_.LowSwapAmountError,"Swap amount is too low.");return{type:et.Direct,data:{pool:a,quote:{assetInID:i,assetInAmount:m,assetOutID:c,assetOutAmount:l,swapFee:Number(h),rate:de(p,Number(l))/de(u,Number(m)),priceImpact:g}}}}function hr(e){return gr.apply(this,arguments)}function gr(){return(gr=i(s().mark((function e(t){var n,r,a,o,i,u,c,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.amount,r=t.assetIn,a=t.assetOut,o=t.isSwapRouterEnabled,i=t.network,u=t.pool,c=[],u?c.push(new Promise((function(e,t){try{var s=fr({amount:n,assetIn:r,assetOut:a,pool:u});e({type:et.Direct,data:{pool:u,quote:s}})}catch(e){t(e)}}))):c.push(Promise.reject(new E(_.NoAvailablePoolError,"There is not an available pool for this asset pair"))),o&&c.push($e({amount:n,assetInID:r.id,assetOutID:a.id,swapType:Oe.FixedInput,network:i}).then((function(e){return{type:et.Router,data:e}}))),e.next=6,dr(c);case 6:return p=e.sent,e.abrupt("return",dt(p));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ar(e){return xr.apply(this,arguments)}function xr(){return(xr=i(s().mark((function e(t){var n,r,a,o,i,u,c,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.amount,r=t.assetIn,a=t.assetOut,o=t.isSwapRouterEnabled,i=t.network,u=t.pool,c=[new Promise((function(e,t){try{e(mr({amount:n,assetIn:r,assetOut:a,pool:u}))}catch(e){t(e)}}))],o&&c.push($e({amount:n,assetInID:r.id,assetOutID:a.id,swapType:Oe.FixedOutput,network:i}).then((function(e){return{type:et.Router,data:e}}))),e.next=5,dr(c);case 5:return p=e.sent,e.abrupt("return",dt(p));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ir(e){var t=e.inputSupply,n=e.outputSupply,r=e.swapInputAmount,a=e.totalFeeShare,s=e.decimals,o=BigInt(function(e){var t=e.inputAmount,n=e.totalFeeShare;return Math.floor(Number(t*BigInt(n))/1e4)}({inputAmount:r,totalFeeShare:a})),i=function(e){var t=e.inputSupply,n=e.outputSupply,r=e.swapAmount,a=t*n,s=n-BigInt(a/(t+BigInt(r)));return s-=BigInt(1)}({inputSupply:t,outputSupply:n,swapAmount:r-o});return{swapOutputAmount:i,totalFeeAmount:o,priceImpact:it({inputSupply:t,outputSupply:n,assetIn:{amount:r,decimals:s.assetIn},assetOut:{amount:i,decimals:s.assetOut}})}}var wr={getQuote:function(e){return lr.apply(this,arguments)},getFixedInputSwapQuote:hr,getFixedInputDirectSwapQuote:fr,getFixedOutputDirectSwapQuote:mr,getFixedOutputSwapQuote:Ar,generateTxns:function(e){return cr.apply(this,arguments)},signTxns:function(e){var t=e.txGroup;return(0,e.initiatorSigner)([t])},execute:function(e){return pr.apply(this,arguments)},calculateFixedInputSwap:Ir};function vr(e,t){var n,r,a=BigInt(e),s=t.issuedLiquidity;return s>a+BigInt(Lt)?(n=a*t.asset1/s,r=a*t.asset2/s):(n=t.asset1,r=t.asset2),{asset1OutputAmount:n,asset2OutputAmount:r}}function yr(){return(yr=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.pool,o=n.poolTokenIn,i=n.initiatorAddr,u=n.minAsset1Amount,c=n.minAsset2Amount,p=n.slippage,t.next=3,r.getTransactionParams().do();case 3:if(l=t.sent,d=a.account.address(),f=a.poolTokenID){t.next=8;break}throw new Error("Pool token asset ID is missing");case 8:return m=e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:i,to:d,assetIndex:f,amount:o,suggestedParams:l}),(h=e.makeApplicationNoOpTxnFromObject({from:i,appIndex:a.validatorAppID,note:be.getAppCallTxnNoteWithClientName(U.V2),appArgs:[rr,e.encodeUint64(le("negative",p,u)),e.encodeUint64(le("negative",p,c))],accounts:[d],foreignAssets:[a.asset1ID,a.asset2ID],suggestedParams:l})).fee=(nr+1)*e.ALGORAND_MIN_TX_FEE,(g=[])[ar.ASSET_TRANSFER_TXN]=m,g[ar.APP_CALL_TXN]=h,A=e.assignGroupID(g),t.abrupt("return",[{txn:A[ar.ASSET_TRANSFER_TXN],signers:[i]},{txn:A[ar.APP_CALL_TXN],signers:[i]}]);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function br(){return(br=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,w,v,y;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.pool,o=n.initiatorAddr,i=n.poolTokenIn,u=n.outputAssetId,c=n.minOutputAssetAmount,p=n.slippage,t.next=3,r.getTransactionParams().do();case 3:if(l=t.sent,d=a.asset1ID,f=a.asset2ID,m=a.account.address(),h=a.poolTokenID){t.next=9;break}throw new Error("Pool token asset ID is missing");case 9:if(g=0,A=0,x=le("negative",p,c),u!==d){t.next=17;break}g=x,A=0,t.next=23;break;case 17:if(u!==f){t.next=22;break}g=0,A=x,t.next=23;break;case 22:throw new Error("Invalid output asset id. It doesn't match with pool assets");case 23:return I=e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:o,to:m,assetIndex:h,amount:i,suggestedParams:l}),(w=e.makeApplicationNoOpTxnFromObject({from:o,appIndex:a.validatorAppID,note:be.getAppCallTxnNoteWithClientName(U.V2),appArgs:[rr,e.encodeUint64(g),e.encodeUint64(A)],accounts:[m],foreignAssets:[u],suggestedParams:l})).fee=(nr+1)*e.ALGORAND_MIN_TX_FEE,(v=[])[ar.ASSET_TRANSFER_TXN]=I,v[ar.APP_CALL_TXN]=w,y=e.assignGroupID(v),t.abrupt("return",[{txn:y[ar.ASSET_TRANSFER_TXN],signers:[o]},{txn:y[ar.APP_CALL_TXN],signers:[o]}]);case 31:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Tr(){return(Tr=i(s().mark((function e(t){var n,r,a,o,i,u,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.txGroup,a=t.signedTxns,e.next=3,ge(n,[a]);case 3:return o=e.sent,i=w(o,1),u=i[0].txnID,e.prev=6,e.next=9,dn(n,r);case 9:c=e.sent,e.next=14;break;case 12:e.prev=12,e.t0=e.catch(6);case 14:return e.abrupt("return",{outputAssets:c,txnID:u});case 15:case"end":return e.stop()}}),e,null,[[6,12]])})))).apply(this,arguments)}var kr,_r={getQuote:function(e){var t=e.pool,n=e.reserves,r=e.poolTokenIn,a=BigInt(r),s=vr(a,n),o=s.asset1OutputAmount,i=s.asset2OutputAmount;return{round:n.round,asset1Out:{assetId:t.asset1ID,amount:o},asset2Out:{assetId:t.asset2ID,amount:i},poolTokenIn:{assetId:t.poolTokenID,amount:a}}},getSingleAssetRemoveLiquidityQuote:function(e){var t,n=e.pool,r=e.reserves,a=e.poolTokenIn,s=e.assetOutID,o=e.decimals,i=BigInt(a),u=vr(i,r),c=u.asset1OutputAmount,p=u.asset2OutputAmount,l=n.totalFeeShare;if(s===n.asset1ID){var d=wr.calculateFixedInputSwap({inputSupply:r.asset2-p,outputSupply:r.asset1-c,swapInputAmount:p,totalFeeShare:l,decimals:o}),f=d.swapOutputAmount,m=d.totalFeeAmount,h=d.priceImpact;t={round:r.round,assetOut:{assetId:s,amount:c+f},poolTokenIn:{assetId:n.poolTokenID,amount:i},internalSwapQuote:{amountIn:{assetId:n.asset2ID,amount:p},amountOut:{assetId:n.asset1ID,amount:f},swapFees:{assetId:n.asset2ID,amount:m},priceImpact:h}}}else{if(s!==n.asset2ID)throw new Error("assetOutID must be one of the pool assets");var g=wr.calculateFixedInputSwap({inputSupply:r.asset1-c,outputSupply:r.asset2-p,swapInputAmount:c,totalFeeShare:l,decimals:o}),A=g.swapOutputAmount,x=g.totalFeeAmount,I=g.priceImpact;t={round:r.round,assetOut:{assetId:s,amount:p+A},poolTokenIn:{assetId:n.poolTokenID,amount:i},internalSwapQuote:{amountIn:{assetId:n.asset2ID,amount:p},amountOut:{assetId:n.asset1ID,amount:A},swapFees:{assetId:n.asset2ID,amount:x},priceImpact:I}}}return t},generateTxns:function(e){return yr.apply(this,arguments)},generateSingleAssetOutTxns:function(e){return br.apply(this,arguments)},signTxns:function(e){var t=e.txGroup;return(0,e.initiatorSigner)([t])},execute:function(e){return Tr.apply(this,arguments)}},Er=(l(kr={},U.V1_1,ur),l(kr,U.V2,_r),kr),Sr=3n,Pr=1000n,Dr=function(e){return e[e.FEE_TXN_INDEX=0]="FEE_TXN_INDEX",e[e.VALIDATOR_APP_CALL_TXN_INDEX=1]="VALIDATOR_APP_CALL_TXN_INDEX",e[e.ASSET_IN_TXN_INDEX=2]="ASSET_IN_TXN_INDEX",e[e.ASSET_OUT_TXN_INDEX=3]="ASSET_OUT_TXN_INDEX",e}(Dr||{});function Or(){return(Or=i(s().mark((function t(n){var r,a,o,i,u,c,p,l;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.pool,a=n.txGroup,o=n.initiatorSigner,t.next=3,o([a]);case 3:return i=t.sent,u=w(i,2),c=u[0],p=u[1],l=a.map((function(t,n){return n===Dr.FEE_TXN_INDEX?c:n===Dr.ASSET_IN_TXN_INDEX?p:e.signLogicSigTransactionObject(t.txn,r.account.lsig).blob})),t.abrupt("return",l);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Nr(){return(Nr=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,w,v,y,b;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.client,a=n.quoteAndPool,o=n.swapType,i=n.slippage,u=n.initiatorAddr,c=a.pool,p=a.quote,l=p.assetInID,d=p.assetOutID,f=c.account.address(),(m=[c.asset1ID,c.asset2ID]).includes(l)&&m.includes(d)&&l!==d){t.next=7;break}throw new z({pool:c,quote:p},"Input asset (#".concat(l,") and output asset (#").concat(d,") provided to generate transactions do not belong to the pool ").concat(f,"."));case 7:return t.next=9,r.getTransactionParams().do();case 9:return h=t.sent,g=[ve("swap"),o===Oe.FixedInput?ve("fi"):ve("fo")],A=e.makeApplicationNoOpTxnFromObject({from:f,appIndex:c.validatorAppID,appArgs:g,accounts:[u],note:be.getAppCallTxnNoteWithClientName(U.V1_1),foreignAssets:c.asset2ID==j?[c.asset1ID,c.poolTokenID]:[c.asset1ID,c.asset2ID,c.poolTokenID],suggestedParams:h}),x=o===Oe.FixedOutput?le("positive",i,p.assetInAmount):p.assetInAmount,I=l===j?e.makePaymentTxnWithSuggestedParamsFromObject({from:u,to:f,amount:x,suggestedParams:h}):e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:u,to:f,assetIndex:l,amount:x,suggestedParams:h}),w=o===Oe.FixedInput?le("negative",i,p.assetOutAmount):p.assetOutAmount,v=d===j?e.makePaymentTxnWithSuggestedParamsFromObject({from:f,to:u,amount:w,suggestedParams:h}):e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:f,to:u,assetIndex:d,amount:w,suggestedParams:h}),y=e.makePaymentTxnWithSuggestedParamsFromObject({from:u,to:f,amount:A.fee+v.fee,note:S,suggestedParams:h}),b=e.assignGroupID([y,A,I,v]),t.abrupt("return",[{txn:b[0],signers:[u]},{txn:b[1],signers:[f]},{txn:b[2],signers:[u]},{txn:b[3],signers:[f]}]);case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Lr(e){var t=e.pool,n=e.reserves,r=e.assetIn,s=e.decimals;if(t.status!==Ot.READY)throw new E(_.NoAvailablePoolError,"There is not an available pool for this asset pair");var o,i,u,c=BigInt(r.amount);if(r.id===t.asset1ID)o=t.asset2ID,i=n.asset1,u=n.asset2;else{if(r.id!==t.asset2ID)throw new E(_.AssetDoesNotBelongToPoolError,"Input asset (#".concat(r.id,") doesn't belong to the pool ").concat(t.account.address(),"."));o=t.asset1ID,i=n.asset2,u=n.asset1}var p=c*Sr/Pr,l=u-i*u/(i+(c-p));if(l>u)throw new E(_.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");var d={assetIn:{amount:c,decimals:s.assetIn},assetOut:{amount:l,decimals:s.assetOut}},f={round:n.round,assetInID:r.id,assetInAmount:c,assetOutID:o,assetOutAmount:l,swapFee:Number(p),rate:ot(d),priceImpact:it(a({inputSupply:i,outputSupply:u},d))};return{type:et.Direct,data:{pool:t,quote:f}}}function Br(e){return Cr.apply(this,arguments)}function Cr(){return(Cr=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d,f,m,h,g,A,x;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.pool,a=t.signedTxns,o=t.assetIn,i=t.assetOut,u=t.initiatorAddr,e.next=3,Et({client:n,pool:r,accountAddr:u});case 3:return c=e.sent,e.next=6,ge(n,[a]);case 6:return p=e.sent,l=w(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,e.next=13,Et({client:n,pool:r,accountAddr:u});case 13:return h=e.sent,i.id===r.asset1ID?(g=c.excessAsset1,A=h.excessAsset1):(g=c.excessAsset2,A=h.excessAsset2),(x=A-g)<0n&&(x=0n),e.abrupt("return",{round:f,assetInID:o.id,assetInAmount:BigInt(o.amount),assetOutID:i.id,assetOutAmount:BigInt(i.amount)+x,excessAmount:{assetID:i.id,excessAmountForSwap:x,totalExcessAmount:A},txnID:m});case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fr(e){var t=e.pool,n=e.reserves,r=e.assetOut,a=e.decimals;if(t.status!==Ot.READY)throw new E(_.NoAvailablePoolError,"There is not an available pool for this asset pair");var s,o,i,u=BigInt(r.amount);if(r.id===t.asset1ID)s=t.asset2ID,o=n.asset2,i=n.asset1;else{if(r.id!==t.asset2ID)throw new E(_.AssetDoesNotBelongToPoolError,"Output asset (#".concat(r.id,") doesn't belong to the pool ").concat(t.account.address(),"."));s=t.asset1ID,o=n.asset1,i=n.asset2}if(u>i)throw new E(_.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");var c=o*i/(i-u)-o,p=c*Pr/(Pr-Sr),l=p-c,d=de(a.assetOut,Number(u))/de(a.assetIn,Number(p)),f=de(a.assetOut,Number(i))/de(a.assetIn,Number(o)),m=fe({decimalPlaces:5},Math.abs(d/f-1)),h={round:n.round,assetInID:s,assetInAmount:p,assetOutID:r.id,assetOutAmount:u,swapFee:Number(l),rate:d,priceImpact:m};return{type:et.Direct,data:{pool:t,quote:h}}}function Rr(e){return Mr.apply(this,arguments)}function Mr(){return(Mr=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d,f,m,h,g,A,x;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.pool,a=t.signedTxns,o=t.assetIn,i=t.assetOut,u=t.initiatorAddr,e.next=3,Et({client:n,pool:r,accountAddr:u});case 3:return c=e.sent,e.next=6,ge(n,[a]);case 6:return p=e.sent,l=w(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,e.next=13,Et({client:n,pool:r,accountAddr:u});case 13:return h=e.sent,o.id===r.asset1ID?(g=c.excessAsset1,A=h.excessAsset1):(g=c.excessAsset2,A=h.excessAsset2),(x=A-g)<0n&&(x=0n),e.abrupt("return",{round:f,assetInID:o.id,assetInAmount:BigInt(o.amount)-x,assetOutID:i.id,assetOutAmount:BigInt(i.amount),excessAmount:{assetID:o.id,excessAmountForSwap:x,totalExcessAmount:A},txnID:m});case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ur(){return(Ur=i(s().mark((function e(t){var n,r,o,i,u,c,p,l,d,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.client,r=t.pool,o=t.swapType,i=t.txGroup,u=t.signedTxns,c=t.initiatorAddr,r.status===Ot.READY){e.next=3;break}throw new z({pool:r,swapType:o,txGroup:i},"There is not an available pool for this asset pair");case 3:if(e.prev=3,p={id:i[Dr.ASSET_IN_TXN_INDEX].txn.assetIndex||j,amount:i[Dr.ASSET_IN_TXN_INDEX].txn.amount},l={id:i[Dr.ASSET_OUT_TXN_INDEX].txn.assetIndex||j,amount:i[Dr.ASSET_OUT_TXN_INDEX].txn.amount},o!==Oe.FixedInput){e.next=12;break}return e.next=9,Br({client:n,pool:r,signedTxns:u,assetIn:p,assetOut:l,initiatorAddr:c});case 9:d=e.sent,e.next=15;break;case 12:return e.next=14,Rr({client:n,pool:r,signedTxns:u,assetIn:p,assetOut:l,initiatorAddr:c});case 14:d=e.sent;case 15:return e.abrupt("return",a(a({},d),{},{groupID:Ie(i),fees:xe(i)}));case 18:throw e.prev=18,e.t0=e.catch(3),"SlippageTolerance"===(f=new z(e.t0,"We encountered something unexpected while swapping. Try again later.")).type&&f.setMessage("The swap failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),f;case 23:case"end":return e.stop()}}),e,null,[[3,18]])})))).apply(this,arguments)}var jr,Vr={getQuote:function(e,t,n,r,a){return e===Oe.FixedInput?Lr({pool:t,reserves:n,assetIn:r,decimals:a}):Fr({pool:t,reserves:n,assetOut:r,decimals:a})},getFixedInputSwapQuote:Lr,getFixedOutputSwapQuote:Fr,generateTxns:function(e){return Nr.apply(this,arguments)},signTxns:function(e){return Or.apply(this,arguments)},execute:function(e){return Ur.apply(this,arguments)},executeFixedOutputSwap:Rr};function Xr(e){return Promise.allSettled(e).then((function(e){if(e.every((function(e){return"rejected"===e.status}))){var t=w(e.map((function(e){return e.reason})),2),n=t[0],r=t[1];if(ft(n)&&!ft(r))throw n;throw r}return e.filter((function(e){return"fulfilled"===e.status&&e.value})).map((function(e){return e.value}))}))}function Gr(){return(Gr=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.amount,a=t.assetIn,o=t.assetOut,i=t.isSwapRouterEnabled,u=t.pools,c=[],(p=u.find((function(e){return e.info.contractVersion===U.V1_1})))?c.push(new Promise((function(e,t){try{e(Vr.getFixedInputSwapQuote({pool:p.info,assetIn:{amount:r,id:Number(a.id)},decimals:{assetIn:a.decimals,assetOut:o.decimals},reserves:p.reserves}))}catch(e){t(e)}}))):c.push(Promise.reject(new E(_.NoAvailablePoolError,"Trying to swap from non-existent pool"))),l=u.find((function(e){return e.info.contractVersion===U.V2})),c.push(wr.getFixedInputSwapQuote({amount:r,assetIn:{id:Z(a),decimals:a.decimals},assetOut:{id:Z(o),decimals:o.decimals},pool:null!==(n=null==l?void 0:l.info)&&void 0!==n?n:null,isSwapRouterEnabled:i,network:t.network})),e.next=8,Xr(c);case 8:return d=e.sent,e.abrupt("return",dt(d));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qr(){return(qr=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.amount,a=t.assetIn,o=t.assetOut,i=t.pools,u=t.isSwapRouterEnabled,c=[],(p=i.find((function(e){return e.info.contractVersion===U.V1_1})))?c.push(new Promise((function(e,t){try{e(Vr.getFixedOutputSwapQuote({pool:p.info,assetOut:{amount:r,id:Number(o.id)},decimals:{assetIn:a.decimals,assetOut:o.decimals},reserves:p.reserves}))}catch(e){t(e)}}))):c.push(Promise.reject(new E(_.NoAvailablePoolError,"Trying to swap from non-existent pool"))),l=i.find((function(e){return e.info.contractVersion===U.V2})),c.push(wr.getFixedOutputSwapQuote({amount:r,assetIn:{id:Z(a),decimals:a.decimals},assetOut:{id:Z(o),decimals:o.decimals},pool:null!==(n=null==l?void 0:l.info)&&void 0!==n?n:null,isSwapRouterEnabled:u,network:t.network})),e.next=8,Xr(c);case 8:return d=e.sent,e.abrupt("return",dt(d));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Qr=(l(jr={},U.V1_1,Vr),l(jr,U.V2,wr),l(jr,"getQuote",(function(e){var t=e.type;if(t===Oe.FixedInput)return function(e){return Gr.apply(this,arguments)}(e);if(t===Oe.FixedOutput)return function(e){return qr.apply(this,arguments)}(e);throw new E(_.InvalidSwapTypeError,"Invalid swap type")})),l(jr,"generateTxns",(function(e){return e.quote.type===et.Direct&&pt(e.quote)===U.V1_1?Vr.generateTxns(a(a({},e),{},{quoteAndPool:e.quote.data})):wr.generateTxns(e)})),l(jr,"signTxns",(function(e){if(e.quote.type===et.Direct&&pt(e.quote)===U.V1_1){var t=e.quote.data.pool;return Vr.signTxns(a(a({},e),{},{pool:t}))}return wr.signTxns(e)})),l(jr,"execute",(function(e){return e.contractVersion===U.V1_1?Vr.execute(e):wr.execute(e)})),jr);function Wr(){return(Wr=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.pool,a=t.txGroup,o=t.initiatorSigner,e.prev=1,e.next=4,zr({txGroup:a,pool:r,initiatorSigner:o});case 4:return i=e.sent,e.next=7,ge(n,[i]);case 7:return u=e.sent,c=w(u,1),p=c[0],l=p.txnID,d=p.confirmedRound,e.abrupt("return",{fees:xe(a),confirmedRound:d,txnID:l,groupID:Ie(a)});case 15:throw e.prev=15,e.t0=e.catch(1),new z(e.t0,"We encountered something unexpected while redeeming. Try again later.");case 18:case"end":return e.stop()}}),e,null,[[1,15]])})))).apply(this,arguments)}function zr(e){return Jr.apply(this,arguments)}function Jr(){return(Jr=i(s().mark((function t(n){var r,a,o,i,u,c,p,l;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.txGroup,a=n.pool,o=n.initiatorSigner,t.next=3,o([r]);case 3:return i=t.sent,u=w(i,1),c=u[0],p=a.account.lsig,l=r.map((function(t,n){return 0===n?c:e.signLogicSigTransactionObject(t.txn,p).blob})),t.abrupt("return",l);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Kr(){return Kr=i(s().mark((function t(n){var r,a,o,u,c,p;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.data,o=n.initiatorSigner,t.prev=1,u=a.map((function(e){var t=e.txGroup,n=e.pool;return{txns:t,txnFees:xe(t),groupID:Ie(t),lsig:n.account.lsig}})),t.next=5,o(u.map((function(e){return e.txns})));case 5:return c=t.sent,p=Promise.all(u.map((function(t,n){return new Promise(function(){var a=i(s().mark((function a(o,i){var u,p,l,d,f,m;return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,u=t.txns.map((function(r,a){return 0===a?c[n]:e.signLogicSigTransactionObject(r.txn,t.lsig).blob})),a.next=4,ge(r,[u]);case 4:p=a.sent,l=w(p,1),d=l[0],f=d.txnID,m=d.confirmedRound,o({fees:t.txnFees,groupID:t.groupID,txnID:f,confirmedRound:m}),a.next=15;break;case 12:a.prev=12,a.t0=a.catch(0),i(a.t0);case 15:case"end":return a.stop()}}),a,null,[[0,12]])})));return function(e,t){return a.apply(this,arguments)}}())}))),t.abrupt("return",p);case 10:throw t.prev=10,t.t0=t.catch(1),new z(t.t0,"We encountered something unexpected while redeeming. Try again later.");case 13:case"end":return t.stop()}}),t,null,[[1,10]])}))),Kr.apply(this,arguments)}function Yr(){return(Yr=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.pool,o=n.assetID,i=n.assetOut,u=n.initiatorAddr,t.next=3,r.getTransactionParams().do();case 3:return c=t.sent,p=a.account.address(),l=e.makeApplicationNoOpTxnFromObject({from:p,appIndex:a.validatorAppID,appArgs:[ve("redeem")],note:be.getAppCallTxnNoteWithClientName(a.contractVersion),accounts:[u],foreignAssets:0==a.asset2ID?[a.asset1ID,a.poolTokenID]:[a.asset1ID,a.asset2ID,a.poolTokenID],suggestedParams:c}),d=0===o?e.makePaymentTxnWithSuggestedParamsFromObject({from:p,to:u,amount:BigInt(i),suggestedParams:c}):e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:u,assetIndex:o,amount:BigInt(i),suggestedParams:c}),f=e.makePaymentTxnWithSuggestedParamsFromObject({from:u,to:p,amount:l.fee+d.fee,note:S,suggestedParams:c}),m=e.assignGroupID([f,l,d]),t.abrupt("return",[{txn:m[0],signers:[u]},{txn:m[1],signers:[p]},{txn:m[2],signers:[p]}]);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Hr(e){var t,n={},r=T(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,s=(new TextDecoder).decode(Buffer.from(a.key,"base64")),o=void 0;o=1===a.value.type?a.value.bytes:a.value.uint,n[s]=o}}catch(e){r.e(e)}finally{r.f()}return n}function $r(e,t,n){return e*t/n}var Zr=BigInt(31536e3),ea=BigInt(1e14),ta=BigInt(1e16),na={testnet:548587153,mainnet:1385499515},ra=14;function aa(e){return sa.apply(this,arguments)}function sa(){return(sa=i(s().mark((function t(n){var r,a,o,i,u;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.network,o=n.assetIDs,i=e.getApplicationAddress(na[a]),t.next=4,bt(r,i);case 4:return u=t.sent.assets.map((function(e){return e["asset-id"]})),t.abrupt("return",o.filter((function(e){return e!==j&&!u.includes(e)})));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function oa(){return(oa=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,y,b,T,k,_,E,S;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.network,o=n.poolAddress,i=n.poolTokenId,u=n.lendingManagerId,c=n.asset1In,p=n.asset2In,l=n.initiatorAddr,d=e.getApplicationAddress(na[a]),t.next=4,r.getTransactionParams().do();case 4:return f=t.sent,m=[c,p].sort((function(e,t){return t.fAssetId-e.fAssetId})),h=w(m,2),g=h[0],A=h[1],x=$(A.id),I=e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:d,assetIndex:g.id,amount:g.amount,suggestedParams:f}),y=x?e.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:d,amount:A.amount,suggestedParams:f}):e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:d,assetIndex:A.id,amount:A.amount,suggestedParams:f}),(b=e.makeApplicationNoOpTxnFromObject({from:l,appIndex:na[a],appArgs:[ve("add_liquidity"),e.decodeAddress(o).publicKey,e.encodeUint64(g.lendingAppId),e.encodeUint64(A.lendingAppId)],foreignAssets:[g.id,A.id,g.fAssetId,A.fAssetId],foreignApps:[g.lendingAppId,A.lendingAppId,u],accounts:[o],suggestedParams:f})).fee=e.ALGORAND_MIN_TX_FEE*(ra+1),T=ke(a,U.V2),k=e.makeApplicationNoOpTxnFromObject({from:l,appIndex:na[a],appArgs:[ve("noop")],foreignAssets:[i],foreignApps:[T],accounts:[o],suggestedParams:f}),_=[I,y,b,k],t.next=16,aa({client:r,network:a,assetIDs:[g.id,A.id,g.fAssetId,A.fAssetId,i]});case 16:return(E=t.sent).length&&((S=[e.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:d,amount:D*E.length,suggestedParams:f}),e.makeApplicationNoOpTxnFromObject({from:l,appIndex:na[a],appArgs:[ve("asset_optin")].concat(v(E.map((function(t){return e.encodeUint64(t)})))),foreignAssets:v(E),suggestedParams:f})])[1].fee=(E.length+1)*e.ALGORAND_MIN_TX_FEE,_.unshift.apply(_,S)),t.abrupt("return",e.assignGroupID(_).map((function(e){return{txn:e,signers:[l]}})));case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ia(){return(ia=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,w;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.pool,o=n.poolTokenIn,i=n.initiatorAddr,u=n.asset1Out,c=n.asset2Out,p=n.lendingManagerId,l=n.network,d=e.getApplicationAddress(na[l]),t.next=4,r.getTransactionParams().do();case 4:if(f=t.sent,m=a.account.address(),h=a.poolTokenID){t.next=9;break}throw new Error("Pool token asset ID is missing");case 9:return g=e.makeAssetTransferTxnWithSuggestedParamsFromObject({from:i,to:d,assetIndex:h,amount:o,suggestedParams:f}),(A=e.makeApplicationNoOpTxnFromObject({from:i,appIndex:na[l],appArgs:[ve("remove_liquidity"),e.decodeAddress(m).publicKey,e.encodeUint64(u.lendingAppId),e.encodeUint64(c.lendingAppId)],accounts:[m],foreignAssets:[u.id,c.id,u.fAssetId,c.fAssetId],foreignApps:[u.lendingAppId,c.lendingAppId,p],suggestedParams:f})).fee=e.ALGORAND_MIN_TX_FEE*(ra+1),x=ke(l,U.V2),I=e.makeApplicationNoOpTxnFromObject({from:i,appIndex:na[l],appArgs:[ve("noop")],accounts:[m],foreignAssets:[h,u.fAssetId,c.fAssetId],foreignApps:[x],suggestedParams:f}),w=e.assignGroupID([g,A,I]),t.abrupt("return",w.map((function(e){return{txn:e,signers:[i]}})));case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ua(e,t,n){var r=BigInt(Math.floor((new Date).getTime()/1e3)-function(e){return null!=e?e:Math.floor((new Date).getTime()/1e3)}(n));return $r(e,ta+t*r/Zr,ta)}function ca(){return(ca=i(s().mark((function e(t,n){var r,a,o,i,u,c,p,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getApplicationByID(n).do();case 2:return r=e.sent,a=r.params["global-state"],o=Hr(a),i=Number(Buffer.from(o.pm,"base64").readBigUInt64BE(0)),u=Buffer.from(o.i,"base64"),c=u.readBigUInt64BE(32),p=u.readBigUInt64BE(40),l=Number(u.readBigUInt64BE(48)),e.abrupt("return",{appId:n,managerAppId:i,depositInterestRate:c,depositInterestIndex:p,lastUpdate:l});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var pa={AddLiquidity:Object.freeze({__proto__:null,generateTxns:function(e){return oa.apply(this,arguments)},getAddLiquidityTotalFee:function(t){return e.ALGORAND_MIN_TX_FEE*(4+ra)+(t?(t+1)*e.ALGORAND_MIN_TX_FEE+t*D:0)}}),RemoveLiquidity:Object.freeze({__proto__:null,generateTxns:function(e){return ia.apply(this,arguments)},getRemoveLiquidityTotalFee:function(){return e.ALGORAND_MIN_TX_FEE*(3+ra)}}),calculateWithdrawReturn:function(e){var t=e.withdrawAmount,n=ua(e.depositInterestIndex,e.depositInterestRate,e.lastUpdate);return $r(BigInt(t),n,ea)},calculateDepositReturn:function(e){var t=e.depositAmount,n=ua(e.depositInterestIndex,e.depositInterestRate,e.lastUpdate);return BigInt(t)*ea/n},getFolksWrapperAppOptInRequiredAssetIDs:aa};function la(t){var n=t.suggestedParams,r=t.stakingAppID,a=t.initiatorAddr,s=t.liquidityAssetID,o=t.program,i=t.amount,u=e.encodeUint64(i),c=e.encodeUint64(o.id);return e.makeApplicationNoOpTxnFromObject({appIndex:r,from:a,suggestedParams:n,foreignAssets:[s],accounts:[o.accountAddress],appArgs:[ve("commit"),u],note:te([ve("tinymanStaking/v1:b"),c,e.encodeUint64(s),u])})}function da(){return(da=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.client,a=n.stakingAppID,o=n.program,i=n.requiredAssetID,u=n.liquidityAssetID,c=n.amount,p=n.initiatorAddr,t.next=3,r.getTransactionParams().do();case 3:if(l=t.sent,d=la({suggestedParams:l,stakingAppID:a,program:o,liquidityAssetID:u,initiatorAddr:p,amount:c}),f=[d],"number"!=typeof i){t.next=10;break}return m=e.makeApplicationNoOpTxnFromObject({appIndex:a,from:p,suggestedParams:l,foreignAssets:[i],accounts:[o.accountAddress],appArgs:[ve("log_balance")]}),f=e.assignGroupID([d,m]),t.abrupt("return",[{txn:f[0],signers:[p]},{txn:f[1],signers:[p]}]);case 10:return t.abrupt("return",[{txn:f[0],signers:[p]}]);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function fa(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}var ma=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var a=0;a<e.length;a++){var s=e.charAt(a),o=s.charCodeAt(0);if(255!==n[o])throw new TypeError(s+" is ambiguous");n[o]=a}var i=e.length,u=e.charAt(0),c=Math.log(i)/Math.log(256),p=Math.log(256)/Math.log(i);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,a=0;e[t]===u;)r++,t++;for(var s=(e.length-t)*c+1>>>0,o=new Uint8Array(s);e[t];){var p=n[e.charCodeAt(t)];if(255===p)return;for(var l=0,d=s-1;(0!==p||l<a)&&-1!==d;d--,l++)p+=i*o[d]>>>0,o[d]=p%256>>>0,p=p/256>>>0;if(0!==p)throw new Error("Non-zero carry");a=l,t++}if(" "!==e[t]){for(var f=s-a;f!==s&&0===o[f];)f++;for(var m=new Uint8Array(r+(s-f)),h=r;f!==s;)m[h++]=o[f++];return m}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,a=0,s=t.length;a!==s&&0===t[a];)a++,n++;for(var o=(s-a)*p+1>>>0,c=new Uint8Array(o);a!==s;){for(var l=t[a],d=0,f=o-1;(0!==l||d<r)&&-1!==f;f--,d++)l+=256*c[f]>>>0,c[f]=l%i>>>0,l=l/i>>>0;if(0!==l)throw new Error("Non-zero carry");r=d,a++}for(var m=o-r;m!==o&&0===c[m];)m++;for(var h=u.repeat(n);m<o;++m)h+=e.charAt(c[m]);return h},decodeUnsafe:l,decode:function(e){var n=l(e);if(n)return n;throw new Error(`Non-${t} character`)}}},ha=ma;class ga{name;prefix;baseEncode;constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Aa{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Ia(this,e)}}class xa{decoders;constructor(e){this.decoders=e}or(e){return Ia(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(null!=n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function Ia(e,t){return new xa({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class wa{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new ga(e,t,n),this.decoder=new Aa(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function va({name:e,prefix:t,encode:n,decode:r}){return new wa(e,t,n,r)}function ya({name:e,prefix:t,alphabet:n}){const{encode:r,decode:a}=ha(n,e);return va({prefix:t,name:e,encode:r,decode:e=>fa(a(e))})}function ba({name:e,prefix:t,bitsPerChar:n,alphabet:r}){return va({prefix:t,name:e,encode:e=>function(e,t,n){const r="="===t[t.length-1],a=(1<<n)-1;let s="",o=0,i=0;for(let r=0;r<e.length;++r)for(i=i<<8|e[r],o+=8;o>n;)o-=n,s+=t[a&i>>o];if(0!==o&&(s+=t[a&i<<n-o]),r)for(;0!=(s.length*n&7);)s+="=";return s}(e,r,n),decode:t=>function(e,t,n,r){const a={};for(let e=0;e<t.length;++e)a[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*n/8|0);let i=0,u=0,c=0;for(let t=0;t<s;++t){const s=a[e[t]];if(void 0===s)throw new SyntaxError(`Non-${r} character`);u=u<<n|s,i+=n,i>=8&&(i-=8,o[c++]=255&u>>i)}if(i>=n||0!=(255&u<<8-i))throw new SyntaxError("Unexpected end of data");return o}(t,r,n,e)})}const Ta=ba({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ba({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ba({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ba({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ba({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ba({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ba({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ba({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ba({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const ka=ya({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});ya({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var _a=function e(t,n,r){n=n||[];var a=r=r||0;for(;t>=Pa;)n[r++]=255&t|Ea,t/=128;for(;t&Sa;)n[r++]=255&t|Ea,t>>>=7;return n[r]=0|t,e.bytes=r-a+1,n},Ea=128,Sa=-128,Pa=Math.pow(2,31);var Da=function e(t,n){var r,a=0,s=0,o=n=n||0,i=t.length;do{if(o>=i)throw e.bytes=0,new RangeError("Could not decode varint");r=t[o++],a+=s<28?(r&Na)<<s:(r&Na)*Math.pow(2,s),s+=7}while(r>=Oa);return e.bytes=o-n,a},Oa=128,Na=127;var La=Math.pow(2,7),Ba=Math.pow(2,14),Ca=Math.pow(2,21),Fa=Math.pow(2,28),Ra=Math.pow(2,35),Ma=Math.pow(2,42),Ua=Math.pow(2,49),ja=Math.pow(2,56),Va=Math.pow(2,63),Xa={encode:_a,decode:Da,encodingLength:function(e){return e<La?1:e<Ba?2:e<Ca?3:e<Fa?4:e<Ra?5:e<Ma?6:e<Ua?7:e<ja?8:e<Va?9:10}};function Ga(e,t=0){return[Xa.decode(e,t),Xa.decode.bytes]}function qa(e,t,n=0){return Xa.encode(e,t,n),t}function Qa(e){return Xa.encodingLength(e)}function Wa(e,t){const n=t.byteLength,r=Qa(e),a=r+Qa(n),s=new Uint8Array(a+n);return qa(e,s,0),qa(n,s,r),s.set(t,a),new za(e,n,t,s)}class za{code;size;digest;bytes;constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}function Ja(e,t){const{bytes:n,version:r}=e;return 0===r?function(e,t,n){const{prefix:r}=n;if(r!==ka.prefix)throw Error(`Cannot string encode V0 in ${n.name} encoding`);const a=t.get(r);if(null==a){const a=n.encode(e).slice(1);return t.set(r,a),a}return a}(n,Ya(e),t??ka.encoder):function(e,t,n){const{prefix:r}=n,a=t.get(r);if(null==a){const a=n.encode(e);return t.set(r,a),a}return a}(n,Ya(e),t??Ta.encoder)}const Ka=new WeakMap;function Ya(e){const t=Ka.get(e);if(null==t){const t=new Map;return Ka.set(e,t),t}return t}class Ha{code;version;multihash;bytes;"/";constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==$a)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Za)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Ha.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Wa(e,t);return Ha.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Ha.equals(this,e)}static equals(e,t){const n=t;return null!=n&&e.code===n.code&&e.version===n.version&&function(e,t){if(e===t)return!0;{const n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}(e.bytes,n.bytes)}}(e.multihash,n.multihash)}toString(e){return Ja(this,e)}toJSON(){return{"/":Ja(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Ha)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:n,multihash:r,bytes:a}=t;return new Ha(e,n,r,a??es(e,n,r.bytes))}if(!0===t[ts]){const{version:e,multihash:n,code:r}=t,a=function(e){const t=fa(e),[n,r]=Ga(t),[a,s]=Ga(t.subarray(r)),o=t.subarray(r+s);if(o.byteLength!==a)throw new Error("Incorrect length");return new za(n,a,o,t)}(n);return Ha.create(e,r,a)}return null}static create(e,t,n){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==$a)throw new Error(`Version 0 CID must use dag-pb (code: ${$a}) block encoding`);return new Ha(e,t,n,n.bytes);case 1:{const r=es(e,t,n.bytes);return new Ha(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return Ha.create(0,$a,e)}static createV1(e,t){return Ha.create(1,e,t)}static decode(e){const[t,n]=Ha.decodeFirst(e);if(0!==n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Ha.inspectBytes(e),n=t.size-t.multihashSize,r=fa(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const a=r.subarray(t.multihashSize-t.digestSize),s=new za(t.multihashCode,t.digestSize,a,r);return[0===t.version?Ha.createV0(s):Ha.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[n,r]=Ga(e.subarray(t));return t+=r,n};let r=n(),a=$a;if(18===r?(r=0,t=0):a=n(),0!==r&&1!==r)throw new RangeError(`Invalid CID version ${r}`);const s=t,o=n(),i=n(),u=t+i;return{version:r,codec:a,multihashCode:o,digestSize:i,multihashSize:u-s,size:u}}static parse(e,t){const[n,r]=function(e,t){switch(e[0]){case"Q":{const n=t??ka;return[ka.prefix,n.decode(`${ka.prefix}${e}`)]}case ka.prefix:{const n=t??ka;return[ka.prefix,n.decode(e)]}case Ta.prefix:{const n=t??Ta;return[Ta.prefix,n.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}(e,t),a=Ha.decode(r);if(0===a.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Ya(a).set(n,e),a}}const $a=112,Za=18;function es(e,t,n){const r=Qa(e),a=r+Qa(t),s=new Uint8Array(a+n.byteLength);return qa(e,s,0),qa(t,s,r),s.set(n,a),s}const ts=Symbol.for("@ipld/js-cid/CID");class ns{name;code;encode;constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Wa(this.code,t):t.then((e=>Wa(this.code,e)))}throw Error("Unknown type, must be binary type")}}const rs=function({name:e,code:t,encode:n}){return new ns(e,t,n)}({name:"sha2-256",code:18,encode:e=>fa(n.createHash("sha256").update(e).digest())}),as=85;var ss=604800,os={testnet:258703304,mainnet:NaN},is={testnet:480164661,mainnet:NaN},us={testnet:360907790,mainnet:NaN},cs={testnet:336189106,mainnet:NaN},ps={testnet:383416252,mainnet:NaN},ls={testnet:383416252,mainnet:NaN},ds=2500,fs=400,ms=604800,hs=126144e3,gs=1e7,As=Math.pow(2,64),xs=48,Is=21,ws=48,vs=ve("tp"),ys=ve("sc"),bs=28100,Ts=12900,ks=421700,_s=409700;function Es(e){return Math.floor(e/ms)*ms}function Ss(e,t){if(e>t)throw new Error("Old timestamp must be less than or equal to new timestamp");for(var n=[],r=Es(e)+ms;r<t;)n.push(r),r+=ms;return n.push(t),n}function Ps(e,t,n,r){return Ds.apply(this,arguments)}function Ds(){return(Ds=i(s().mark((function e(t,n,r,o){var i,u,c,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,i=Buffer.from(r).toString("base64"),null==o||!o.cacheData||!o.cacheData[i]){e.next=4;break}return e.abrupt("return",Uint8Array.from(Object.values(o.cacheData[i])));case 4:return e.next=6,t.getApplicationBoxByName(n,r).do();case 6:return u=e.sent,c=u.value,null!=o&&o.onCacheUpdate&&(p=a(a({},o.cacheData),{},l({},i,c)),o.onCacheUpdate(p)),e.abrupt("return",c);case 12:if(e.prev=12,e.t0=e.catch(0),"Network request error. Received status 404 (): box not found"!==e.t0.message){e.next=16;break}return e.abrupt("return",null);case 16:throw e.t0;case 17:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function Os(e,t,n){return Ns.apply(this,arguments)}function Ns(){return(Ns=i(s().mark((function e(t,n,r){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ps(t,n,r);case 3:return a=e.sent,e.abrupt("return",Boolean(a));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function Ls(e,t){if(t<0)throw new Error("Time delta must be greater than or equal to 0");return Math.floor(e*t/As)}function Bs(e,t,n){var r=Ls(t,n);r>e?r=t?e*e*As/(2*t):0:r=(e+(e-r))*n/2;return r}function Cs(e,t){return Fs.apply(this,arguments)}function Fs(){return(Fs=i(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getApplicationByID(n).do();case 2:return r=e.sent,e.abrupt("return",Rs(r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rs(e){var t,n={},r=T(e.params["global-state"]);try{for(r.s();!(t=r.n()).done;){var a=t.value,s=Buffer.from(a.key,"base64").toString(),o=void 0;o=1===a.value.type?Buffer.from(a.value.bytes||"","base64"):a.value.uint||0,n[s]=o}}catch(e){r.e(e)}finally{r.f()}return n}function Ms(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=t.reduce((function(e,t){return e+t.length}),0),a=new Uint8Array(r),s=0,o=0,i=t;o<i.length;o++){var u=i[o];a.set(u,s),s+=u.length}return a}function Us(){return(Us=i(s().mark((function e(t){var n,r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(new TextEncoder).encode(t),e.next=3,rs.digest(n);case 3:return r=e.sent,a=Ha.createV1(as,r),e.abrupt("return",a.toString(Ta));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function js(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n.flat().map((function(t){return t.group=void 0,e.decodeUnsignedTransaction(e.encodeUnsignedTransaction(t))}));return e.assignGroupID(a)}function Vs(e,t){return Xs.apply(this,arguments)}function Xs(){return(Xs=i(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getApplicationBoxes(n).do();case 2:return r=e.sent,e.abrupt("return",r.boxes.map((function(e){return e.name})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gs(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=new Uint8Array(t),r=e,a=t-1;a>=0;a--)n[a]=255&r,r>>=8;return n}function qs(e,t){return 0===Buffer.compare(e,t)}function Qs(e){for(var t=0,n=0;n<e.byteLength;n++){t*=256,t+=e[n]}return t}var Ws=function(){function e(t,n,r,a){u(this,e),this.lockedAmount=t,this.lockEndTime=n,this.powerCount=r,this.deletedPowerCount=a}return p(e,[{key:"freeAccountPowerSpaceCount",get:function(){var e=this.powerCount%Is;return e>0?Is-e:0}},{key:"lastAccountPowerBoxIndex",get:function(){return to(this.powerCount)[0]}},{key:"lastAccountPowerArrayIndex",get:function(){return to(this.powerCount)[1]}}]),e}(),zs=function(){function e(t,n,r,a){u(this,e),this.bias=t,this.timestamp=n,this.slope=r,this.cumulativePower=a}return p(e,[{key:"lockEndTimestamp",get:function(){var e=this.bias*Math.pow(2,64)/this.slope;return this.timestamp+e}},{key:"cumulativePowerAt",value:function(e){var t=e-this.timestamp;if(t<0)throw new Error("Time delta must be greater than or equal to 0");return this.cumulativePower+Bs(this.bias,this.slope,t)}}]),e}(),Js=p((function e(t,n,r,a){u(this,e),this.bias=t,this.timestamp=n,this.slope=r,this.cumulativePower=a})),Ks=p((function e(t){u(this,e),this.slopeDelta=t})),Ys=function(){function e(t,n,r,a){u(this,e),this.tinyAssetId=t,this.totalLockedAmount=n,this.totalPowerCount=r,this.lastTotalPowerTimestamp=a}return p(e,[{key:"freeTotalPowerSpaceCount",get:function(){var e=this.totalPowerCount%Is;return e>0?Is-e:0}},{key:"lastTotalPowerBoxIndex",get:function(){return to(this.totalPowerCount)[0]}},{key:"lastTotalPowerArrayIndex",get:function(){return to(this.totalPowerCount)[1]}}]),e}();function Hs(){return(Hs=i(s().mark((function e(t,n,r){var a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Zs(r),e.prev=1,e.next=4,Ps(t,n,a);case 4:if(!(o=e.sent)){e.next=7;break}return e.abrupt("return",$s(o));case 7:return e.abrupt("return",null);case 10:return e.prev=10,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}function $s(e){var t=Buffer.from(e);return new Ws(t.readUIntBE(0,8),t.readUIntBE(8,8),t.readUIntBE(16,8),t.readUIntBE(24,8))}function Zs(t){return e.decodeAddress(t).publicKey}function eo(e){var t=Gs(e),n=new Uint8Array(vs.length+t.length);return n.set(vs,0),n.set(t,vs.length),n}function to(e){var t=e-1;return[Math.floor(t/Is),t%Is]}function no(t,n){var r=e.decodeAddress(t).publicKey,a=Gs(n),s=new Uint8Array(r.length+a.length);return s.set(r,0),s.set(a,r.length),s}function ro(e,t,n){return ao.apply(this,arguments)}function ao(){return(ao=i(s().mark((function e(t,n,r){var a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=oo(r),e.next=3,Ps(t,n,a);case 3:if(o=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return e.abrupt("return",so(o));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function so(t){return new Ks(Number(e.bytesToBigInt(t.slice(t.length-16,t.length))))}function oo(e){return Ms(ys,Gs(e))}function io(e,t,n,r){return uo.apply(this,arguments)}function uo(){return(uo=i(s().mark((function e(t,n,r,a){var o,i,u,c,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=0,r&&(o=Math.ceil(r/Is)),i=[],u=0;case 4:if(!(u<o)){e.next=13;break}return c=eo(u),e.next=8,Ps(t,n,c,a);case 8:(p=e.sent)&&i.push.apply(i,v(co(p)));case 10:u++,e.next=4;break;case 13:return e.abrupt("return",i);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function co(e){for(var t,n=ws,r=[],a=0;a<e.length;a+=n)t=e.slice(a,a+n),r.push(t);for(var s=[],o=0,i=r;o<i.length;o++){var u=i[o];if(u.every((function(e){return 0===e})))break;var c=Buffer.from(u);s.push(new Js(c.readUIntBE(0,8),c.readUIntBE(8,8),c.readUIntBE(16,16),c.readUIntBE(32,16)))}return s}function po(e,t,n){return lo.apply(this,arguments)}function lo(){return lo=i(s().mark((function e(t,n,r){var a,o,i,u,c,p,l,d=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=d.length>4?d[4]:void 0,i=0,(a=d.length>3&&void 0!==d[3]?d[3]:null)&&(i=Math.ceil(a/Is)),u=[],c=0;case 6:if(!(c<i)){e.next=15;break}return p=no(n,c),e.next=10,Ps(t,r,p,o);case 10:(l=e.sent)&&u.push.apply(u,v(mo(l)));case 12:c++,e.next=6;break;case 15:return e.abrupt("return",u);case 16:case"end":return e.stop()}}),e)}))),lo.apply(this,arguments)}function fo(e,t){for(var n=null,r=0;r<e.length;r++){if(!(t>=e[r].timestamp))break;n=r}return n}function mo(e){for(var t,n=xs,r=[],a=0;a<e.length;a+=n)t=e.slice(a,a+n),r.push(t);for(var s=[],o=0,i=r;o<i.length;o++){var u=i[o];if(u.every((function(e){return 0===e})))break;var c=Buffer.from(u);s.push(new zs(c.readUIntBE(0,8),c.readUIntBE(8,8),c.readUIntBE(16,16),c.readUIntBE(32,16)))}return s}for(var ho,go=[],Ao=0;Ao<256;++Ao)go.push((Ao+256).toString(16).slice(1));var xo=new Uint8Array(16);function Io(){if(!ho&&!(ho="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ho(xo)}var wo={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function vo(e,t,n){if(wo.randomUUID&&!t&&!e)return wo.randomUUID();var r=(e=e||{}).random||(e.rng||Io)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=r[a];return t}return function(e,t=0){return(go[e[t+0]]+go[e[t+1]]+go[e[t+2]]+go[e[t+3]]+"-"+go[e[t+4]]+go[e[t+5]]+"-"+go[e[t+6]]+go[e[t+7]]+"-"+go[e[t+8]]+go[e[t+9]]+"-"+go[e[t+10]]+go[e[t+11]]+go[e[t+12]]+go[e[t+13]]+go[e[t+14]]+go[e[t+15]]).toLowerCase()}(r)}function yo(t){var n=t.sender,r=t.index,a=t.suggestedParams,s=t.boxes,o=void 0===s?[]:s,i=t.extraAppArgs,u=void 0===i?[]:i,c=t.foreignApps,p=void 0===c?[]:c,l=Math.max(0,8-p.length-o.length),d=Array(l).fill({appIndex:0,name:ve("")}),f=[].concat(v(o),v(d));return e.makeApplicationNoOpTxnFromObject({from:n,suggestedParams:a,appIndex:r,appArgs:[ve("increase_budget")].concat(v(u)),foreignApps:p,boxes:f,note:ve(vo())})}function bo(e){return To.apply(this,arguments)}function To(){return(To=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,w,v,y,b,k,_,E,S,P,D,O,N,L;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.accountState,a=n.lockEndTime,o=n.lockedAmount,i=n.network,u=n.sender,c=n.vaultAppGlobalState,p=n.slopeChangeAtLockEndTime,l=n.client,d=n.appCallNote,!(o<gs)){t.next=3;break}throw new Error("Insufficient lock amount");case 3:if(a%ms==0){t.next=5;break}throw new Error("Invalid lock end time");case 5:f=is[i],m=Zs(u),h=eo(c.lastTotalPowerBoxIndex),g=eo(c.lastTotalPowerBoxIndex+1),A=[{appIndex:f,name:m},{appIndex:f,name:h},{appIndex:f,name:g}],r?(x=no(u,r.lastAccountPowerBoxIndex),A.push({appIndex:f,name:x}),r.freeAccountPowerSpaceCount||(I=no(u,r.lastAccountPowerBoxIndex+1),A.push({appIndex:f,name:I}))):(w=no(u,0),A.push({appIndex:f,name:w})),v=oo(a),A.push({appIndex:f,name:v}),y=Ss(c.lastTotalPowerTimestamp,Date.now()/1e3),b=y.length,k=T(y);try{for(k.s();!(_=k.n()).done;)(E=_.value)%ms==0&&(S=oo(E),A.push({appIndex:f,name:S}))}catch(e){k.e(e)}finally{k.f()}return P=0,r?r.freeAccountPowerSpaceCount||(P+=ks):(P+=bs,P+=ks),b>c.freeTotalPowerSpaceCount&&(P+=_s),p||(P+=Ts),t.next=23,l.getTransactionParams().do();case 23:return D=t.sent,O=[e.makeAssetTransferTxnWithSuggestedParamsFromObject({amount:o,assetIndex:os[i],from:u,suggestedParams:D,to:e.getApplicationAddress(f)}),e.makeApplicationNoOpTxnFromObject({appIndex:f,from:u,suggestedParams:D,appArgs:[ve("create_lock"),Gs(a)],boxes:A.slice(0,8),note:d}),yo({sender:u,suggestedParams:D,index:f,boxes:A.slice(8)})],P&&(N=e.makePaymentTxnWithSuggestedParamsFromObject({amount:P,from:u,suggestedParams:D,to:e.getApplicationAddress(f)}),O.unshift(N)),L=e.assignGroupID(O),t.abrupt("return",L);case 28:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ko(e){return _o.apply(this,arguments)}function _o(){return(_o=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,w,v,y,b,k,_,E,S;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.accountState,a=n.lockedAmount,o=n.network,i=n.sender,u=n.vaultAppGlobalState,c=n.client,p=n.appCallNote,!(a<gs)){t.next=3;break}throw new Error("Insufficient lock amount");case 3:l=Zs(i),d=no(i,r.lastAccountPowerBoxIndex),f=eo(u.lastTotalPowerBoxIndex),m=eo(u.lastTotalPowerBoxIndex+1),h=oo(r.lockEndTime),g=[{appIndex:is[o],name:l},{appIndex:is[o],name:d},{appIndex:is[o],name:f},{appIndex:is[o],name:m},{appIndex:is[o],name:h}],A=Ss(u.lastTotalPowerTimestamp,Date.now()/1e3),x=A.length,I=T(A);try{for(I.s();!(w=I.n()).done;)(v=w.value)%ms==0&&(h=oo(v),g.push({appIndex:is[o],name:h}))}catch(e){I.e(e)}finally{I.f()}return y=0,x>u.freeTotalPowerSpaceCount&&(y+=_s),r.freeAccountPowerSpaceCount||(b=no(i,r.lastAccountPowerBoxIndex+1),g.push({appIndex:is[o],name:b}),y+=ks),t.next=18,c.getTransactionParams().do();case 18:return k=t.sent,_=[e.makeAssetTransferTxnWithSuggestedParamsFromObject({assetIndex:os[o],from:i,to:e.getApplicationAddress(is[o]),amount:a,suggestedParams:k}),e.makeApplicationNoOpTxnFromObject({appIndex:is[o],from:i,suggestedParams:k,appArgs:[ve("increase_lock_amount")],boxes:g,note:p}),yo({sender:i,suggestedParams:k,index:is[o]})],y&&(E=e.makePaymentTxnWithSuggestedParamsFromObject({from:i,suggestedParams:k,to:e.getApplicationAddress(is[o]),amount:y}),_.unshift(E)),S=e.assignGroupID(_),t.abrupt("return",S);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Eo(e){return So.apply(this,arguments)}function So(){return(So=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,w,v,y,b,k,_,E,S,P,D,O;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.accountState,a=n.client,o=n.network,i=n.newLockEndTime,u=n.slopeChangeAtNewLockEndTime,c=n.sender,p=n.vaultAppGlobalState,l=n.appCallNote,!(i%ms)){t.next=3;break}throw new Error("Invalid lock end time");case 3:if(!(i<=r.lockEndTime)){t.next=5;break}throw new Error("New lock end time must be greater than current lock end time");case 5:d=Zs(c),f=no(c,r.lastAccountPowerBoxIndex),m=eo(p.lastTotalPowerBoxIndex),h=eo(p.lastTotalPowerBoxIndex+1),g=oo(r.lockEndTime),A=oo(i),x=[{appIndex:is[o],name:d},{appIndex:is[o],name:f},{appIndex:is[o],name:m},{appIndex:is[o],name:h},{appIndex:is[o],name:g},{appIndex:is[o],name:A}],r.freeAccountPowerSpaceCount||(I=no(c,r.lastAccountPowerBoxIndex+1),x.push({appIndex:is[o],name:I})),w=Ss(p.lastTotalPowerTimestamp,Math.floor(Date.now()/1e3)),v=w.length,y=T(w);try{for(y.s();!(b=y.n()).done;)(k=b.value)%ms==0&&(_=oo(k),x.push({appIndex:is[o],name:_}))}catch(e){y.e(e)}finally{y.f()}return E=0,u||(E+=Ts),r.freeAccountPowerSpaceCount||(E+=ks),v>p.freeTotalPowerSpaceCount&&(E+=_s),t.next=23,a.getTransactionParams().do();case 23:return S=t.sent,P=[e.makeApplicationNoOpTxnFromObject({appIndex:is[o],from:c,suggestedParams:S,appArgs:[ve("extend_lock_end_time"),Gs(i)],boxes:x.slice(0,8),note:l}),yo({sender:c,suggestedParams:S,index:is[o],boxes:x.slice(8)})],E&&(D=e.makePaymentTxnWithSuggestedParamsFromObject({from:c,suggestedParams:S,to:e.getApplicationAddress(is[o]),amount:E}),P.unshift(D)),O=e.assignGroupID(P),t.abrupt("return",O);case 28:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Po(e){return Do.apply(this,arguments)}function Do(){return(Do=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g,A;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.accountState,a=n.network,o=n.sender,i=n.client,u=n.appCallNote,c=Zs(o),p=no(o,r.lastAccountPowerBoxIndex),l=no(o,r.lastAccountPowerBoxIndex+1),d=[{appIndex:is[a],name:c},{appIndex:is[a],name:p},{appIndex:is[a],name:l}],t.next=7,i.getTransactionParams().do();case 7:return f=t.sent,(m=e.makeApplicationNoOpTxnFromObject({appIndex:is[a],from:o,suggestedParams:f,appArgs:[ve("withdraw")],foreignAssets:[os[a]],boxes:d,note:u})).fee*=2,h=[m],r.freeAccountPowerSpaceCount||(g=e.makePaymentTxnWithSuggestedParamsFromObject({from:o,suggestedParams:f,to:e.getApplicationAddress(is[a]),amount:ks}),h.unshift(g)),A=e.assignGroupID(h),t.abrupt("return",A);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Oo=8,No=ve("p"),Lo=ve("a"),Bo=ve("v"),Co=28500,Fo=12500,Ro=ve("p"),Mo=ve("a"),Uo=24,jo=111300,Vo=ds+fs*(41+Uo),Xo=function(e){return e[e.Against=0]="Against",e[e.For=1]="For",e[e.Abstain=2]="Abstain",e}(Xo||{}),Go=new Uint8Array(34),qo="AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY5HFKQ",Qo=function(){function e(t,n,r,a,s,o,i,c,p,l,d,f,m,h,g,A,x){u(this,e),this.index=t,this.creationTimestamp=n,this.votingStartTimestamp=r,this.votingEndTimestamp=a,this.snapshotTotalVotingPower=s,this.voteCount=o,this.quorumNumerator=i,this.againstVotingPower=c,this.forVotingPower=p,this.abstainVotingPower=l,this.isApproved=d,this.isCancelled=f,this.isExecuted=m,this.isQuorumReached=h,this.proposerAddress=g,this.executionHash=A,this.executorAddress=x}return p(e,[{key:"snapshotTimestamp",get:function(){return this.creationTimestamp}}]),e}(),Wo=p((function e(t,n,r,a,s,o,i,c,p,l){u(this,e),this.vaultAppId=t,this.proposalIndexCounter=n,this.votingDelay=r,this.votingDuration=a,this.proposalThreshold=s,this.proposalThresholdNumerator=o,this.quorumThreshold=i,this.approvalRequirement=c,this.manager=p,this.proposalManager=l}));function zo(e){return Ms(Ro,ve(e))}function Jo(t){var n=Buffer.from(t);return new Qo(n.readUIntBE(0,8),n.readUIntBE(8,8),n.readUIntBE(16,8),n.readUIntBE(24,8),n.readUIntBE(32,8),n.readUIntBE(40,8),n.readUIntBE(48,8),n.readUIntBE(56,8),n.readUIntBE(64,8),n.readUIntBE(72,8),Boolean(n.readUIntBE(80,1)),Boolean(n.readUIntBE(81,1)),Boolean(n.readUIntBE(82,1)),Boolean(n.readUIntBE(83,1)),e.encodeAddress(n.subarray(84,116)),t.slice(116,150).toString(),e.encodeAddress(n.subarray(150,182)))}function Ko(){return(Ko=i(s().mark((function e(t,n,r){var a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=zo(r),e.next=3,Ps(t,n,a);case 3:if(o=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return e.abrupt("return",Jo(o));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Yo=p((function e(t,n,r,a,s,o,i){u(this,e),this.index=t,this.creationTimestamp=n,this.votingStartTimestamp=r,this.votingEndTimestamp=a,this.votingPower=s,this.voteCount=o,this.isCancelled=i}));function Ho(e){return new Yo(Qs(e.slice(0,8)),Qs(e.slice(8,16)),Qs(e.slice(16,24)),Qs(e.slice(24,32)),Qs(e.slice(32,40)),Qs(e.slice(40,48)),Boolean(Qs(e.slice(48,49))))}function $o(){return($o=i(s().mark((function e(t,n,r){var a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=zo(r),e.next=3,Ps(t,n,a);case 3:if(o=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return e.abrupt("return",Ho(o));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zo(t){var n=t.stakingVotingAppId,r=t.vaultAppId,a=t.sender,s=t.proposalId,o=t.proposal,i=t.votes,u=t.assetIds,c=t.accountPowerIndex,p=t.appBoxNames,l=t.suggestedParams,d=t.appCallNote,f=void 0===d?null:d;if(i.length!==u.length)throw new Error("The number of votes must be equal to the number of asset ids");if(u.length>Oo)throw new Error("You cannot cast vote for more than ".concat(Oo," different pools"));if(100!==i.reduce((function(e,t){return e+t}),0))throw new Error("The sum of the votes must equal 100%");var m,h=Ms.apply(void 0,v(i.map((function(e){return Gs(e)})))),g=Ms.apply(void 0,v(u.map((function(e){return Gs(e)})))),A=function(e){return Ms(No,ve(e))}(s),x=function(t,n){return Ms(Lo,e.decodeAddress(t).publicKey,Gs(n))}(a,Math.floor(o.index/8192)),I=!p.some((function(e){return qs(e,x)})),w=Zs(a),y=Math.floor(c/Is),b=no(a,y),k=no(a,y+1),_=0,E=[],S=T(u);try{var P=function(){var e=m.value,t=function(e,t){return Ms(Bo,Gs(e),Gs(t))}(o.index,e);E.push({appIndex:n,name:t}),p.some((function(e){return qs(e,t)}))||(_+=1)};for(S.s();!(m=S.n()).done;)P()}catch(e){S.e(e)}finally{S.f()}var D=[{appIndex:n,name:A},{appIndex:n,name:x}].concat(E,[{appIndex:r,name:w},{appIndex:r,name:b},{appIndex:r,name:k}]),O=[e.makeApplicationNoOpTxnFromObject({from:a,suggestedParams:l,appIndex:n,appArgs:[ve("cast_vote"),ve(s),h,g,Gs(c)],foreignApps:[r],boxes:D.slice(0,7),note:f?ve(f):void 0})];O[0].fee*=2,D.length>=7&&O.push(yo({sender:a,suggestedParams:l,index:r,foreignApps:[n],boxes:D.slice(7,14)})),D.length>=14&&O.push(yo({sender:a,suggestedParams:l,index:r,foreignApps:[n],boxes:D.slice(14)}));var N=Number(I)*Co+_*Fo;return N&&(O=[e.makePaymentTxnWithSuggestedParamsFromObject({from:a,suggestedParams:l,to:e.getApplicationAddress(n),amount:N})].concat(v(O))),e.assignGroupID(O)}var ei=ve("rp"),ti=1012,ni=ve("c"),ri=42,ai=ds+fs*(41+ti),si=p((function e(t,n,r,a,s,o,i){u(this,e),this.tinyAssetId=t,this.vaultAppId=n,this.rewardHistoryCount=r,this.firstPeriodTimestamp=a,this.rewardPeriodCount=s,this.manager=o,this.rewardsManager=i})),oi=p((function e(t){u(this,e),this.value=t}));function ii(t,n){var r=e.decodeAddress(t).publicKey,a=Gs(n),s=new Uint8Array(ni.length+r.length+a.length);return s.set(ni,0),s.set(r,ni.length),s.set(a,ni.length+r.length),s}function ui(e,t,n,r){return ci.apply(this,arguments)}function ci(){return(ci=i(s().mark((function e(t,n,r,a){var o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=ii(r,a),e.next=3,Ps(t,n,o);case 3:if(i=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return e.abrupt("return",new oi(i));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pi(t){for(var n=t.rewardsAppId,r=t.vaultAppId,a=t.tinyAssetId,s=t.sender,o=t.periodIndexStart,i=t.periodCount,u=t.accountPowerIndexes,c=t.suggestedParams,p=t.createRewardClaimSheet,l=t.appCallNote,d=[],f=[],m=[],h=[],g=function(){var e,t,r=Math.floor(A/ri),a=(e=Gs(r),(t=new Uint8Array(ei.length+e.length)).set(ei,0),t.set(e,ei.length),t);f.find((function(e){return e.name.toString()===a.toString()}))||f.push({appIndex:n,name:a});var o=Math.floor(A/(8*ti)),i=ii(s,o);m.find((function(e){return e.name.toString()===i.toString()}))||m.push({appIndex:n,name:i})},A=o;A<o+i;A++)g();var x,I=T(u);try{var w=function(){var e=x.value,t=Math.floor(e/Is),n=no(s,t),a={appIndex:r,name:n};h.find((function(e){return e.name.toString()===n.toString()}))||h.push(a),n=no(s,t+1),a={appIndex:r,name:n},h.find((function(e){return e.name.toString()===n.toString()}))||h.push(a)};for(I.s();!(x=I.n()).done;)w()}catch(e){I.e(e)}finally{I.f()}if((d=[{appIndex:r,name:Zs(s)}].concat(m,f,h)).length>=11)throw new Error("Boxes' length cannot be larger than 10");var y=d.slice(0,6),b=[e.makeApplicationNoOpTxnFromObject({from:s,suggestedParams:c,appIndex:n,appArgs:[ve("claim_rewards"),Gs(o),Gs(i),Ms.apply(void 0,v(u.map((function(e){return Gs(e)}))))],foreignApps:[r],foreignAssets:[a],boxes:y,note:l?ve(l):void 0})];b[0].fee=b[0].fee*(i+2);var k=0,_=92+865*i,E=700+700*i;if(_>E&&(k=Math.floor((_-E)/666)+1),k||d.length>6){var S=d.slice(6),P=yo({sender:s,suggestedParams:c,extraAppArgs:[Gs(Math.max(k-1,0))],index:n,foreignApps:[r],boxes:S});P.fee*=Math.max(k,1),b.unshift(P)}if(p){var D=e.makePaymentTxnWithSuggestedParamsFromObject({from:s,to:e.getApplicationAddress(n),amount:ai,suggestedParams:c});b.unshift(D)}return e.assignGroupID(b)}function li(t){var n=t.proposalId,r=t.proposalVotingAppId,a=t.sender,s=t.vaultAppId,o=t.vaultAppGlobalState,i=t.executionHash,u=t.executor,c=t.suggestedParams,p=t.appCallNote,l=zo(n),d=Zs(a),f=eo(o.lastTotalPowerBoxIndex),m=[e.makePaymentTxnWithSuggestedParamsFromObject({from:a,to:e.getApplicationAddress(r),amount:jo,suggestedParams:c}),e.makeApplicationNoOpTxnFromObject({from:a,suggestedParams:c,appIndex:r,appArgs:[ve("create_proposal"),ve(n),i?ve(i):Go,null!=u?u:e.decodeAddress(qo).publicKey],foreignApps:[s],boxes:[{appIndex:r,name:l},{appIndex:s,name:d},{appIndex:s,name:f}],note:p?ve(p):void 0})];return m[1].fee*=3,e.assignGroupID(m)}function di(t){var n=t.accountPowerIndex,r=t.createAttendanceSheetBox,a=t.proposal,s=t.proposalId,o=t.proposalVotingAppId,i=t.sender,u=t.suggestedParams,c=t.vaultAppId,p=t.vote,l=t.appCallNote;if(![Xo.Abstain,Xo.Against,Xo.For].includes(p))throw new Error("Invalid vote");var d,f,m=Math.floor(n/Is),h=Math.floor(a.index/(8*Uo)),g=[{appIndex:o,name:zo(s)},{appIndex:o,name:(d=i,f=h,Ms(Mo,e.decodeAddress(d).publicKey,Gs(f)))},{appIndex:c,name:Zs(i)},{appIndex:c,name:no(i,m)},{appIndex:c,name:no(i,m+1)}],A=[e.makeApplicationNoOpTxnFromObject({from:i,suggestedParams:u,appIndex:o,appArgs:[ve("cast_vote"),ve(s),Gs(p),Gs(n)],foreignApps:[c],boxes:g,note:l?ve(l):void 0})];if(A[0].fee*=2,r){var x=e.makePaymentTxnWithSuggestedParamsFromObject({from:i,suggestedParams:u,to:e.getApplicationAddress(o),amount:Vo});A.unshift(x)}return e.assignGroupID(A)}var fi=function(){function t(e,n,r){u(this,t),this.algodClient=e,this.userAddress=n,this.network=r}var n,r,a,o,c,l,d,f,m,h,g,A,x,I,w,y;return p(t,[{key:"getTinyPower",value:(y=i(s().mark((function e(){var t,n,r,a,o,i,u,c,p=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:Math.floor(Date.now()/1e3),n=p.length>1?p[1]:void 0,e.next=4,this.fetchAccountState();case 4:if(r=e.sent){e.next=7;break}return e.abrupt("return",0);case 7:return e.next=9,po(this.algodClient,this.userAddress,is[this.network],r.powerCount,n);case 9:if(a=e.sent,null!==(o=fo(a,t))){e.next=13;break}return e.abrupt("return",0);case 13:return i=a[o],u=t-i.timestamp,c=Math.max(i.bias-Ls(i.slope,u),0),e.abrupt("return",c);case 17:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"getTotalTinyPower",value:(w=i(s().mark((function e(){var t,n,r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,w,v=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.length>0&&void 0!==v[0]?v[0]:Math.floor(Date.now()/1e3),n=v.length>1?v[1]:void 0,e.next=4,this.fetchVaultAppGlobalState();case 4:if(r=e.sent){e.next=7;break}return e.abrupt("return",0);case 7:return e.next=9,io(this.algodClient,is[this.network],r.totalPowerCount,n);case 9:if(a=e.sent,o=fo(a,t)){e.next=13;break}return e.abrupt("return",0);case 13:i=a[o],u=Math.floor(i.timestamp/ms),c=Math.floor(t/ms)-u,p=Array.from({length:c},(function(e,t){return(u+t)*ms})),l=p.map((function(e,t){return[0===t?i.timestamp:p[t-1],e]})),d=i.slope,f=i.bias,m=T(l),e.prev=20,m.s();case 22:if((h=m.n()).done){e.next=35;break}return g=h.value,A=g[1]-g[0],x=Ls(d,A),f=Math.max(f-x,0),e.next=29,ro(this.algodClient,is[this.network],g[1]);case 29:I=e.sent,w=(null==I?void 0:I.slopeDelta)||0,d=Math.max(d-w,0),0!==f&&0!==d||(f=0,d=0);case 33:e.next=22;break;case 35:e.next=40;break;case 37:e.prev=37,e.t0=e.catch(20),m.e(e.t0);case 40:return e.prev=40,m.f(),e.finish(40);case 43:return e.abrupt("return",f);case 44:case"end":return e.stop()}}),e,this,[[20,37,40,43]])}))),function(){return w.apply(this,arguments)})},{key:"getCumulativeTinyPower",value:(I=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:Math.floor(Date.now()/1e3),e.next=3,this.fetchAccountState();case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",0);case 6:return e.next=8,po(this.algodClient,this.userAddress,is[this.network],r.powerCount,t);case 8:if(a=e.sent,null!==(o=fo(a,n))){e.next=12;break}return e.abrupt("return",0);case 12:return i=a[o],u=n-i.timestamp,c=Bs(i.bias,i.slope,u),p=i.cumulativePower-c,e.abrupt("return",p);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"fetchVaultAppGlobalState",value:(x=i(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Cs(this.algodClient,is[this.network]);case 3:return t=e.sent,e.abrupt("return",new Ys(t.tiny_asset_id,t.total_locked_amount,t.total_power_count,t.last_total_power_timestamp));case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return x.apply(this,arguments)})},{key:"generateCreateLockTransactions",value:(A=i(s().mark((function e(t){var n,r,a,o,i,u,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.lockedAmount,r=t.lockEndTime,a=t.userAddress,o=a||this.userAddress,e.next=4,this.fetchAccountState();case 4:return i=e.sent,e.next=7,this.fetchVaultAppGlobalState();case 7:if(u=e.sent){e.next=10;break}throw new Error("There was an error while fetching vault app global state");case 10:return e.next=12,ro(this.algodClient,is[this.network],r);case 12:return c=e.sent,e.abrupt("return",bo({client:this.algodClient,lockedAmount:n,lockEndTime:r,vaultAppGlobalState:u,slopeChangeAtLockEndTime:c,sender:o,network:this.network,accountState:i}));case 14:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"generateIncreaseLockAmountTransactions",value:(g=i(s().mark((function e(t){var n,r,a,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.lockedAmount,r=t.userAddress,a=r||this.userAddress,e.next=4,this.fetchAccountState();case 4:return o=e.sent,e.next=7,this.fetchVaultAppGlobalState();case 7:if(i=e.sent){e.next=10;break}throw new Error("There was an error while fetching vault app global state");case 10:if(o){e.next=12;break}throw new Error("There was an error while fetcing the account state");case 12:return e.abrupt("return",ko({accountState:o,client:this.algodClient,lockedAmount:n,network:this.network,sender:a,vaultAppGlobalState:i}));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"generateExtendLockTimeTransactions",value:(h=i(s().mark((function e(t){var n,r,a,o,i,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.newLockEndTime,r=t.userAddress,a=r||this.userAddress,e.next=4,this.fetchAccountState();case 4:return o=e.sent,e.next=7,this.fetchVaultAppGlobalState();case 7:if(i=e.sent){e.next=10;break}throw new Error("There was an error while fetching vault app global state");case 10:if(o){e.next=12;break}throw new Error("There was an error while fetcing the account state");case 12:return e.next=14,ro(this.algodClient,is[this.network],n);case 14:return u=e.sent,e.abrupt("return",Eo({accountState:o,client:this.algodClient,network:this.network,newLockEndTime:n,sender:a,vaultAppGlobalState:i,slopeChangeAtNewLockEndTime:null==u?void 0:u.slopeDelta}));case 16:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"generateIncreaseLockAmountAndExtendLockEndTimeTransactions",value:(m=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.lockAmount,r=t.lockEndTime,a=t.userAddress,o=a||this.userAddress,e.next=4,this.fetchAccountState();case 4:return i=e.sent,e.next=7,this.fetchVaultAppGlobalState();case 7:if(u=e.sent,c=[],p=[],u){e.next=12;break}throw new Error("There was an error while fetching vault app global state");case 12:if(i){e.next=14;break}throw new Error("There was an error while fetcing the account state");case 14:return e.next=16,ko({accountState:i,client:this.algodClient,lockedAmount:n,network:this.network,sender:o,vaultAppGlobalState:u});case 16:return c=e.sent,i.powerCount+=1,u.totalPowerCount+=1,e.next=21,ro(this.algodClient,is[this.network],r);case 21:return l=e.sent,e.next=24,Eo({accountState:i,client:this.algodClient,network:this.network,newLockEndTime:r,sender:o,vaultAppGlobalState:u,slopeChangeAtNewLockEndTime:null==l?void 0:l.slopeDelta});case 24:return p=e.sent,d=[].concat(v(c),v(p)),e.abrupt("return",Boolean(c.length)&&Boolean(p.length)?js(c,p):d);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"generateWithdrawTransactions",value:(f=i(s().mark((function e(t,n){var r,a,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t||this.userAddress,e.next=3,this.fetchAccountState();case 3:if(a=e.sent){e.next=6;break}throw new Error("There was an error while fetcing the account state");case 6:return e.next=8,Po({accountState:a,network:this.network,sender:r,client:this.algodClient});case 8:if(o=e.sent,!n){e.next=14;break}return e.next=12,J({client:this.algodClient,initiatorAddr:r,assetID:os[this.network]});case 12:i=e.sent,o=js([i[0].txn],o);case 14:return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"fetchAccountState",value:function(){return function(e,t,n){return Hs.apply(this,arguments)}(this.algodClient,is[this.network],this.userAddress)}},{key:"fetchStakingDistributionProposal",value:function(e){return function(e,t,n){return $o.apply(this,arguments)}(this.algodClient,us[this.network],e)}},{key:"generateCastVoteForStakingDistributionProposalTransactions",value:(d=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d,f,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.proposalId,r=t.votes,a=t.assetIds,o=t.userAddress,i=t.suggestedParams,u=null!=o?o:this.userAddress,c=i,e.next=5,this.fetchStakingDistributionProposal(n);case 5:if(p=e.sent){e.next=8;break}throw new Error("There was an error while fetching staking distribution proposal");case 8:if(c){e.next=12;break}return e.next=11,this.algodClient.getTransactionParams().do();case 11:c=e.sent;case 12:return e.next=14,this.fetchAccountState();case 14:return l=e.sent,e.next=17,Vs(this.algodClient,us[this.network]);case 17:return d=e.sent,e.next=20,po(this.algodClient,u,is[this.network],null==l?void 0:l.powerCount);case 20:if(f=e.sent,null!==(m=fo(f,p.creationTimestamp))){e.next=24;break}throw new Error("It is required to have an account power at the staking distribution proposal creation timestamp");case 24:return e.abrupt("return",Zo({stakingVotingAppId:us[this.network],vaultAppId:is[this.network],sender:u,proposalId:n,proposal:p,votes:r,assetIds:a,accountPowerIndex:m,appBoxNames:d,suggestedParams:c,appCallNote:null}));case 25:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"fetchRewardsAppGlobalState",value:(l=i(s().mark((function t(){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Cs(this.algodClient,cs[this.network]);case 3:return n=t.sent,t.abrupt("return",new si(n.tiny_asset_id,n.vault_app_id,n.reward_history_count,n.first_period_timestamp,n.reward_period_count,e.encodeAddress(n.manager),e.encodeAddress(n.rewards_manager)));case 7:return t.prev=7,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return",null);case 11:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(){return l.apply(this,arguments)})},{key:"generateClaimRewardTransactions",value:(c=i(s().mark((function e(t){var n,r,a,o,i,u,c,p,l,d,f,m,h,g,A,x,I,w,v,y,b,T;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.periodIndexStart,r=t.periodCount,a=t.userAddress,o=t.suggestedParams,i=t.shouldOptIntoTINY,u=null!=a?a:this.userAddress,c=o){e.next=7;break}return e.next=6,this.algodClient.getTransactionParams().do();case 6:c=e.sent;case 7:return e.next=9,this.fetchAccountState();case 9:return p=e.sent,e.next=12,this.fetchRewardsAppGlobalState();case 12:if(l=e.sent){e.next=15;break}throw new Error("There was an error while fetching rewards app global state");case 15:if(!(n+r>l.rewardPeriodCount)){e.next=17;break}throw new Error("The reward period index to be claimed cannot be larger than the latest reward period index");case 17:return e.next=19,po(this.algodClient,u,is[this.network],null==p?void 0:p.powerCount);case 19:for(d=e.sent,f=l.firstPeriodTimestamp+n*ss,m=l.firstPeriodTimestamp+(n+r)*ss,h=[],g=f;g<m+1;g+=ss)h.push(null!==(A=fo(d,g))&&void 0!==A?A:0);x=!1,(I=new Set).add(Math.floor(n/(8*ti))),I.add(Math.floor((n+r)/(8*ti))),w=0,v=Array.from(I);case 29:if(!(w<v.length)){e.next=40;break}return y=v[w],e.next=33,ui(this.algodClient,cs[this.network],this.userAddress,y);case 33:if(e.sent){e.next=37;break}return x=!0,e.abrupt("break",40);case 37:w++,e.next=29;break;case 40:if(b=pi({rewardsAppId:cs[this.network],vaultAppId:is[this.network],tinyAssetId:os[this.network],sender:this.userAddress,periodIndexStart:n,periodCount:r,accountPowerIndexes:h,createRewardClaimSheet:x,suggestedParams:c}),!i){e.next=46;break}return e.next=44,J({client:this.algodClient,initiatorAddr:u,assetID:os[this.network]});case 44:T=e.sent,b=js([T[0].txn],b);case 46:return e.abrupt("return",b);case 47:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"fetchProposal",value:function(e){return function(e,t,n){return Ko.apply(this,arguments)}(this.algodClient,ps[this.network],e)}},{key:"uploadProposalMetadata",value:function(e,t){var n={proposal_id:e,metadata:t};return fetch("".concat(M[this.network].v1,"/governance/proposals/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch((function(){return Promise.reject(new Error("Network error. Try again later."))})).then((function(e){return e.ok?Promise.resolve(e):Promise.reject(e)})).catch(function(){var e=i(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,"function"!=typeof t.json){e.next=6;break}return e.next=4,t.json();case 4:r=e.sent,n=r;case 6:return e.abrupt("return",Promise.reject(n));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"generateCreateProposalTransactions",value:(o=i(s().mark((function t(n){var r,a,o,i,u,c,p,l;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.proposalId,a=n.userAddress,o=n.suggestedParams,i=n.executionHash,u=n.executor,!i||34===i.length){t.next=3;break}throw new Error("Invalid execution hash");case 3:return t.next=5,this.fetchVaultAppGlobalState();case 5:if(c=t.sent){t.next=8;break}throw new Error("There was an error while fetching vault app global state");case 8:if(p=null!=a?a:this.userAddress,l=o){t.next=14;break}return t.next=13,this.algodClient.getTransactionParams().do();case 13:l=t.sent;case 14:if(t.t0=li,t.t1=r,t.t2=ps[this.network],t.t3=p,t.t4=l,t.t5=c,t.t6=is[this.network],t.t7=i,!u){t.next=26;break}t.t8=e.decodeAddress(u).publicKey,t.next=31;break;case 26:return t.t9=Uint8Array,t.next=29,this.fetchProposalVotingAppGlobalState();case 29:t.t10=t.sent.proposalManager,t.t8=new t.t9(t.t10);case 31:return t.t11=t.t8,t.t12={proposalId:t.t1,proposalVotingAppId:t.t2,sender:t.t3,suggestedParams:t.t4,vaultAppGlobalState:t.t5,vaultAppId:t.t6,executionHash:t.t7,executor:t.t11},t.abrupt("return",(0,t.t0)(t.t12));case 34:case"end":return t.stop()}}),t,this)}))),function(e){return o.apply(this,arguments)})},{key:"generateCastVoteTransactions",value:(a=i(s().mark((function t(n){var r,a,o,i,u,c,p,l,d,f,m,h,g;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.proposalId,a=n.suggestedParams,o=n.vote,i=n.userAddress,u=null!=i?i:this.userAddress,c=a){t.next=7;break}return t.next=6,this.algodClient.getTransactionParams().do();case 6:c=t.sent;case 7:return t.next=9,this.fetchProposal(r);case 9:return p=t.sent,t.next=12,this.fetchAccountState();case 12:if(l=t.sent,p){t.next=15;break}throw new Error("Proposal not found");case 15:if(l){t.next=17;break}throw new Error("Account state not found");case 17:if(p.isApproved){t.next=19;break}throw new Error("Proposal not approved");case 19:if(p.votingStartTimestamp){t.next=21;break}throw new Error("Voting start timestamp is not valid");case 21:if(!(p.votingStartTimestamp>=Math.floor(Date.now()/1e3)||p.votingEndTimestamp<=Math.floor(Date.now()/1e3))){t.next=23;break}throw new Error("Voting period is not active");case 23:return t.next=25,po(this.algodClient,u,is[this.network],l.powerCount);case 25:if(d=t.sent,null!==(f=fo(d,p.creationTimestamp))){t.next=29;break}throw new Error("Account power index not found");case 29:return m=Math.floor(p.index/(8*Uo)),s=u,A=m,h=Ms(ve("a"),e.decodeAddress(s).publicKey,Gs(A)),t.next=33,Os(this.algodClient,ps[this.network],h);case 33:return g=!t.sent,t.abrupt("return",di({proposalVotingAppId:ps[this.network],vaultAppId:is[this.network],sender:u,proposalId:r,proposal:p,vote:o,accountPowerIndex:f,createAttendanceSheetBox:g,suggestedParams:c}));case 35:case"end":return t.stop()}var s,A}),t,this)}))),function(e){return a.apply(this,arguments)})},{key:"fetchProposalVotingAppGlobalState",value:(r=i(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Cs(this.algodClient,ls[this.network]);case 2:return t=e.sent,e.abrupt("return",new Wo(t.vault_app_id,t.proposal_index_counter,t.voting_delay,t.voting_duration,t.proposal_threshold,t.proposal_threshold_numerator,t.quorum_threshold,t.approval_requirement,t.manager,t.proposal_manager));case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getRequiredTinyPowerToCreateProposal",value:(n=i(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchProposalVotingAppGlobalState();case 2:if(t=e.sent,n=t.proposalThreshold,!t.proposalThresholdNumerator){e.next=9;break}return e.next=7,this.getTotalTinyPower();case 7:r=e.sent,n=Math.max(n,Math.floor(r*t.proposalThresholdNumerator/100)+1);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),t}();exports.ACCOUNT_POWER_BOX_COST=ks,exports.ACCOUNT_STATE_BOX_COST=bs,exports.ALGO_ASSET=V,exports.ALGO_ASSET_ID=j,exports.ASSET_OPT_IN_PROCESS_TXN_COUNT=1,exports.AccountState=Ws,exports.AddLiquidity=Zn,exports.BASE_MINIMUM_BALANCE=P,exports.Bootstrap=kn,exports.CONTRACT_VERSION=U,exports.LendingPool=pa,exports.MINIMUM_ADD_LIQUIDITY_AMOUNT=F,exports.MINIMUM_BALANCE_REQUIRED_PER_APP=O,exports.MINIMUM_BALANCE_REQUIRED_PER_ASSET=D,exports.MINIMUM_BALANCE_REQUIRED_PER_BYTE_SCHEMA=B,exports.MINIMUM_BALANCE_REQUIRED_PER_INT_SCHEMA_VALUE=C,exports.MIN_LOCK_AMOUNT=gs,exports.OPT_IN_VALIDATOR_APP_PROCESS_TXN_COUNT=1,exports.OPT_OUT_VALIDATOR_APP_PROCESS_TXN_COUNT=1,exports.POOL_TOKEN_UNIT_NAME=X,exports.PROPOSAL_BOX_COST=jo,exports.PoolStatus=Ot,exports.ProposalVote=Xo,exports.REDEEM_PROCESS_TXN_COUNT=3,exports.RemoveLiquidity=Er,exports.SLOPE_CHANGE_BOX_COST=Ts,exports.Swap=Qr,exports.SwapQuoteError=E,exports.SwapQuoteErrorType=_,exports.SwapQuoteType=et,exports.SwapType=Oe,exports.TINY_ASSET_ID=os,exports.TOTAL_POWER_BOX_COST=_s,exports.TinymanGovernanceClient=fi,exports.V1_1AddLiquidityTxnIndices=_n,exports.V1_1_ADD_LIQUIDITY_PROCESS_TXN_COUNT=5,exports.V1_1_REMOVE_LIQUIDITY_TXN_COUNT=tr,exports.V2AddLiquidityTxnIndices=Pn,exports.V2AddLiquidityType=Sn,exports.V2_REMOVE_LIQUIDITY_APP_CALL_INNER_TXN_COUNT=nr,exports.applySlippageToAmount=le,exports.calculateAccountMinimumRequiredBalance=kt,exports.calculatePriceImpact=it,exports.calculateSwapRate=ot,exports.calculateTinyPower=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.floor(Date.now()/1e3),a=(n=e,Math.floor(n*As/hs)),s=t-r;return s<0?0:Ls(a,s)},exports.combineAndRegroupSignerTxns=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var s=n.flat(),o=s.map((function(t){var n=t.txn;return n.group=void 0,e.decodeUnsignedTransaction(e.encodeUnsignedTransaction(n))})),i=e.assignGroupID(o);return s.map((function(e,t){return a(a({},e),{},{txn:i[t]})}))},exports.combineAndRegroupTxns=js,exports.convertFromBaseUnits=de,exports.convertToBaseUnits=function(e,t){return fe({decimalPlaces:0},Math.pow(10,Number(e))*Number(t))},exports.fetchFolksLendingPool=function(e,t){return ca.apply(this,arguments)},exports.generateCidFromProposalMetadata=function(e){return function(e){return Us.apply(this,arguments)}(function(e){return JSON.stringify(e,Object.keys(e).sort(),0)}(e))},exports.generateOptIntoAssetTxns=J,exports.generateOptIntoValidatorTxns=function(e){return _e.apply(this,arguments)},exports.generateOptOutOfValidatorTxns=function(e){return Ee.apply(this,arguments)},exports.generateProposalMetadata=function(e){var t=e.category,n=e.description,r=e.discussionUrl,a=e.pollUrl,s=e.title;return{category:t.trim(),description:n.trim(),discussion_url:r.trim(),poll_url:a.trim(),title:s.trim()}},exports.generateRedeemTxns=function(e){return Yr.apply(this,arguments)},exports.generateSwapRouterAssetOptInTransaction=We,exports.generateSwapRouterTxns=Je,exports.getAccountExcess=function(e){return Pt.apply(this,arguments)},exports.getAccountExcessWithinPool=Et,exports.getAccountInformation=bt,exports.getAddLiquidityTotalFee=function(t){switch(t.version){case U.V1_1:return En;case U.V2:return n=t.type,(Dn[n]+On[n])*e.ALGORAND_MIN_TX_FEE;default:throw new Error("Provided contract version was not valid.")}var n},exports.getAssetInAndAssetOutFromSwapQuote=function(e){return{assetIn:ut(e),assetOut:ct(e)}},exports.getAssetInAndOutFromSwapRoute=Qe,exports.getAssetInFromSwapQuote=ut,exports.getAssetInFromSwapRoute=qe,exports.getAssetOutFromSwapQuote=ct,exports.getAssetOutFromSwapRoute=Ge,exports.getBestQuote=dt,exports.getMinRequiredBalanceToOptIn=function(e){var t,n=e.currentMinumumBalanceForAccount,r=e.suggestedTransactionFee;if("app-opt-in"===e.type){var a=yt(e.contractVersion);t=O+a.schema.numLocalByteSlices*B+a.schema.numLocalInts*C}else t=D;return t+(n||0)+(r||0)},exports.getStakingAppID=function(e){return"testnet"===e?51948952:649588853},exports.getStartTimestampOfWeek=Es,exports.getSwapAppCallFeeAmount=st,exports.getSwapQuoteContractVersion=pt,exports.getSwapQuotePriceImpact=function(e){return e.type===et.Router?Number(e.data.price_impact):e.data.quote.priceImpact},exports.getSwapQuoteRate=lt,exports.getSwapRoute=$e,exports.getSwapRouteRate=Ve,exports.getSwapRouterAppID=Xe,exports.getSwapRouterAppOptInRequiredAssetIDs=Ye,exports.getSwapTotalFee=function(e){switch(e.version){case U.V1_1:return tt;case U.V2:return nt(e.type);default:throw new Error("Provided contract version was not valid.")}},exports.getTxnGroupID=Ie,exports.getV2MinSwapAssetInAmount=rt,exports.getV2SwapTotalFee=nt,exports.getValidatorAppID=ke,exports.hasSufficientMinimumBalance=function(e){return e.amount>=e.minimum_required_balance},exports.isAccountOptedIntoApp=function(e){var t=e.appID;return e.accountAppsLocalState.some((function(e){return e.id===t}))},exports.isSwapAssetInAmountLow=at,exports.isSwapQuoteErrorCausedByAmount=ft,exports.poolUtils=Kt,exports.prepareCommitTransactions=function(e){return da.apply(this,arguments)},exports.redeemAllExcessAsset=function(e){return Kr.apply(this,arguments)},exports.redeemExcessAsset=function(e){return Wr.apply(this,arguments)},exports.sendAndWaitRawTransaction=ge,exports.sumUpTxnFees=xe,exports.tinymanContract_v1_1=xt,exports.tinymanContract_v2=vt,exports.tinymanJSSDKConfig=be;
