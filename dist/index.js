"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("algosdk"),e=require("base64-js");function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r,a=n(t);function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){f(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
<<<<<<< HEAD
u=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function i(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{i({},"")}catch(t){i=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,s=Object.create(a.prototype),o=new _(r||[]);return s._invoke=function(t,e,n){var r="suspendedStart";return function(a,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw s;return E()}for(n.method=a,n.arg=s;;){var o=n.delegate;if(o){var u=y(o,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var i=p(t,e,n);if("normal"===i.type){if(r=n.done?"completed":"suspendedYield",i.arg===l)continue;return{value:i.arg,done:n.done}}"throw"===i.type&&(r="completed",n.method="throw",n.arg=i.arg)}}}(t,n,o),s}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function d(){}function f(){}function m(){}var g={};i(g,a,(function(){return this}));var I=Object.getPrototypeOf,x=I&&I(I(S([])));x&&x!==e&&n.call(x,a)&&(g=x);var A=m.prototype=d.prototype=Object.create(g);function h(t){["next","throw","return"].forEach((function(e){i(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(a,s,o,u){var i=p(t[a],t,s);if("throw"!==i.type){var c=i.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,o,u)}),(function(t){r("throw",t,o,u)})):e.resolve(l).then((function(t){c.value=t,o(c)}),(function(t){return r("throw",t,o,u)}))}u(i.arg)}var a;this._invoke=function(t,n){function s(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(s,s):s()}}function y(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,y(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=p(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function v(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function w(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(v,this),this.reset(!0)}function S(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,s=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return s.next=s}}return{next:E}}function E(){return{value:void 0,done:!0}}return f.prototype=m,i(A,"constructor",m),i(m,"constructor",f),f.displayName=i(m,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,i(t,o,"GeneratorFunction")),t.prototype=Object.create(A),t},t.awrap=function(t){return{__await:t}},h(T.prototype),i(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,n,r,a,s){void 0===s&&(s=Promise);var o=new T(c(e,n,r,a),s);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},h(A),i(A,o,"Generator"),i(A,a,(function(){return this})),i(A,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=S,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return o.type="throw",o.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var u=n.call(s,"catchLoc"),i=n.call(s,"finallyLoc");if(u&&i){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!i)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var s=a;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,l):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),w(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;w(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function i(t,e,n,r,a,s,o){try{var u=t[s](o),i=u.value}catch(t){return void n(t)}u.done?e(i):Promise.resolve(i).then(r,a)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var s=t.apply(e,n);function o(t){i(s,r,a,o,u,"next",t)}function u(t){i(s,r,a,o,u,"throw",t)}o(void 0)}))}}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function m(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&I(t,e)}function g(t){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},g(t)}function I(t,e){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},I(t,e)}function x(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function A(t,e,n){return A=x()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&I(a,n.prototype),a},A.apply(null,arguments)}function h(t){var e="function"==typeof Map?new Map:void 0;return h=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return A(t,arguments,g(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),I(r,t)},h(t)}function T(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return T(t)}function v(t){var e=x();return function(){var n,r=g(t);if(e){var a=g(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return y(this,n)}}function w(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,a,s=[],o=!0,u=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(s.push(r.value),!e||s.length!==e);o=!0);}catch(t){u=!0,a=t}finally{try{o||null==n.return||n.return()}finally{if(u)throw a}}return s}(t,e)||S(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t){return function(t){if(Array.isArray(t))return E(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||S(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){if(t){if("string"==typeof t)return E(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(t,e):void 0}}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function b(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=S(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){u=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw s}}}}exports.SwapQuoteErrorType=void 0,(r=exports.SwapQuoteErrorType||(exports.SwapQuoteErrorType={})).SwapRouterStaleDataError="SwapRouterStaleDataError",r.SwapRouterNoRouteError="SwapRouterNoRouteError",r.SwapRouterLowSwapAmountError="SwapRouterLowSwapAmountError",r.SwapRouterInsufficientReservesError="SwapRouterInsufficientReservesError",r.SwapRouterPoolHasNoLiquidityError="SwapRouterPoolHasNoLiquidityError",r.NoAvailablePoolError="NoAvailablePoolError",r.OutputAmountExceedsAvailableLiquidityError="OutputAmountExceedsAvailableLiquidityError",r.UnknownError="UnknownError",r.LowSwapAmountError="LowSwapAmountError",r.AssetDoesNotBelongToPoolError="AssetDoesNotBelongToPoolError",r.InvalidSwapTypeError="InvalidSwapTypeError";var D=function(t){m(n,h(Error));var e=v(n);function n(t,r){var a;return p(this,n),(a=e.call(this,r)).type=t,a.message=r,Error.captureStackTrace&&Error.captureStackTrace(T(a),n),a}return d(n)}(),O=Uint8Array.from([1]),N={V1_1:"v1_1",V2:"v2"},P={id:"".concat(0),name:"Algorand",unit_name:"ALGO",decimals:6,url:"https://algorand.org",is_liquidity_token:!1,total_amount:"6615503326932151"},k={V1:"TM1POOL",V1_1:"TMPOOL11",V2:"TMPOOL2"},L="- would result negative",R="logic eval error:",F="exceeds schema integer count",B=/transaction \w+:/,M=function(t){m(n,h(Error));var e=v(n);function n(t,r){var a;p(this,n);for(var s=arguments.length,o=new Array(s>2?s-2:0),u=2;u<s;u++)o[u-2]=arguments[u];var i=(a=e.call.apply(e,[this].concat(o))).extractMessageFromAlgoSDKError(t);return a.data=t,a.type=a.getErrorType(i),a.setMessage(a.getErrorMessage(i,a.type,r)),a}return d(n,[{key:"setMessage",value:function(t){this.message=t}},{key:"getErrorType",value:function(t){var e="Unknown";return t.includes(L)?e="SlippageTolerance":t.includes(F)?e="ExceedingExcessAmountCount":t.includes(R)?e="LogicError":t.match(B)&&(e="TransactionError"),e}},{key:"getErrorMessage",value:function(t,e,n){var r;switch(e){case"SlippageTolerance":r="The process failed due to too much slippage in the price. Please adjust the slippage tolerance and try again.";break;case"ExceedingExcessAmountCount":r="The process failed due to the number of excess amounts accumulated for your account in the Tinyman app.";break;case"LogicError":r=t.split(R)[1];break;case"TransactionError":r=t.split(B)[1];break;case"Unknown":t&&(r=t)}return r||(r=n||"We encountered an unexpected error, try again later."),r.trim()}},{key:"extractMessageFromAlgoSDKError",value:function(t){var e,n,r,a="";return null!=t&&null!==(e=t.response)&&void 0!==e&&null!==(n=e.body)&&void 0!==n&&n.message?a=t.response.body.message:null!=t&&null!==(r=t.response)&&void 0!==r&&r.text?a=t.response.text:"string"==typeof(null==t?void 0:t.message)&&(a=this.isMessageObjectString(null==t?void 0:t.message)?JSON.parse(t.message||"{message: ''}").message:t.message),"string"!=typeof a&&(a=String(a)),a}},{key:"isMessageObjectString",value:function(t){return"string"==typeof t&&t.includes("{message:")}}]),n}();function Q(){return(Q=c(u().mark((function t(e){var n,r,s,o,i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.assetID,s=e.initiatorAddr,t.prev=1,t.next=4,n.getTransactionParams().do();case 4:return o=t.sent,i=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:s,to:s,assetIndex:r,amount:0,suggestedParams:o}),t.abrupt("return",[{txn:i,signers:[s]}]);case 9:throw t.prev=9,t.t0=t.catch(1),new M(t.t0,"We encountered something unexpected while opting into this asset. Try again later.");case 12:case"end":return t.stop()}}),t,null,[[1,9]])})))).apply(this,arguments)}function V(t,e){var n=Number(t.id),r=Number(e.id);return n>r?[o(o({},t),{},{id:n}),o(o({},e),{},{id:r})]:[o(o({},e),{},{id:r}),o(o({},t),{},{id:n})]}function C(t,e){var n=[t,e];return[Math.max.apply(Math,n),Math.min.apply(Math,n)]}function j(t){return 0===Number(t)}function X(t){return Number(t.id)}function q(t){var e,n=t.stateArray,r=void 0===n?[]:n,a=t.shouldDecodeKeys,s=void 0!==a&&a,o={},u=b(r);try{for(u.s();!(e=u.n()).done;){var i=e.value,c=i.key,p=void 0;if(1==i.value.type)p=i.value.bytes;else{if(2!=i.value.type)throw new Error("Unexpected state type: ".concat(i.value.type));p=i.value.uint}o[s?atob(c):c]=p}}catch(t){u.e(t)}finally{u.f()}return o}function U(t){var e,n=t.reduce((function(t,e){return t+e.length}),0),r=new Uint8Array(n),a=0,s=b(t);try{for(s.s();!(e=s.n()).done;){var o=e.value;r.set(o,a),a+=o.length}}catch(t){s.e(t)}finally{s.f()}return r}var G=100000n,W=100000n,z=100000n,J=25000n+25000n,Y=25000n+3500n;function K(t){var e=t["apps-total-schema"],n=0n,r=0n;e&&(e["num-byte-slice"]&&(n=e["num-byte-slice"]),e["num-uint"]&&(r=e["num-uint"]));var a=t["apps-local-state"]||[],s=t["created-apps"]||[],o=t.assets||[];return G+W*BigInt(o.length)+z*BigInt(s.length+a.length)+Y*r+J*n}function H(t){return new Promise((function(e){setTimeout((function(){e(null)}),t)}))}function Z(t,e){return $.apply(this,arguments)}function $(){return($=c(u().mark((function t(e,n){var r;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,H(1e3);case 3:return r=null,t.prev=4,t.next=7,e.pendingTransactionInformation(n).do();case 7:r=t.sent,t.next=12;break;case 10:t.prev=10,t.t0=t.catch(4);case 12:if(!r){t.next=17;break}if(!r["confirmed-round"]){t.next=15;break}return t.abrupt("return",r);case 15:if(!r["pool-error"]){t.next=17;break}throw new Error("Transaction Rejected: ".concat(r["pool-error"]));case 17:t.next=0;break;case 19:case"end":return t.stop()}}),t,null,[[4,10]])})))).apply(this,arguments)}function tt(t,e,n){if(e>1||e<0)throw new Error("Invalid slippage value. Must be between 0 and 1, got ".concat(e));var r;try{var a="negative"===t?1-e:1+e;r=BigInt(Math.floor(Number(n)*a))}catch(t){throw new Error(t.message)}return r}function et(t,e){var n=Number(t);return nt({decimalPlaces:n},Math.pow(10,-n)*Number(e))}function nt(t,e){var n=t.decimalPlaces,r=void 0===n?0:n;if(r>0){var a=w(at(e),2),s=a[0],o=a[1],u=w(at(Math.round(Number(rt(s,o+r)))),2),i=u[0],c=u[1];return Number(rt(i,c-r))}return Math.round(e)}function rt(t,e){return t+(e<0?"e".concat(e):"e+".concat(e))}function at(t){if(t.toString().includes("e")){var e=t.toString().split("e");return[parseFloat(e[0]),parseFloat(e[1])]}return[t,0]}function st(t,e){return ot.apply(this,arguments)}function ot(){return(ot=c(u().mark((function t(e,n){var r,a,s,o,i,c,p,l;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,r=[],a=b(n),t.prev=3,a.s();case 5:if((s=a.n()).done){t.next=18;break}return o=s.value,t.next=9,e.sendRawTransaction(o).do();case 9:return i=t.sent,c=i.txId,t.next=13,Z(e,c);case 13:p=t.sent,l=p["confirmed-round"],r.push({confirmedRound:l,txnID:c});case 16:t.next=5;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(3),a.e(t.t0);case 23:return t.prev=23,a.f(),t.finish(23);case 26:return t.abrupt("return",r);case 29:throw t.prev=29,t.t1=t.catch(0),new M(t.t1,"We encountered an error while processing this transaction. Try again later.");case 32:case"end":return t.stop()}}),t,null,[[0,29],[3,20,23,26]])})))).apply(this,arguments)}function ut(t){return t.reduce((function(t,e){return t+e.txn.fee}),0)}function it(t){return(e=t[0].txn.group)?Buffer.from(e).toString("base64"):"";var e}function ct(t){for(var e=[];;){var n=127&t;if(!(t>>=7)){e.push(n);break}e.push(128|n)}return e}function pt(t){return(new TextEncoder).encode(t)}function lt(t){return Boolean(t)&&void 0!==t.fallback_message}var dt,ft=new(function(){function t(){p(this,t),this.clientName="tinyman-js-sdk"}return d(t,[{key:"getClientName",value:function(){return this.clientName}},{key:"setClientName",value:function(t){this.clientName=t}},{key:"getAppCallTxnNoteWithClientName",value:function(t){return pt("tinyman/".concat(t===N.V1_1?"v1":t,':j{"origin":"').concat(this.clientName,'"}'))}}]),t}()),mt=(f(dt={},N.V1_1,{testnet:62368684,mainnet:552635992}),f(dt,N.V2,{testnet:148607e3,mainnet:1002541853}),dt);function gt(t,e){var n=mt[e][t];if(!n)throw new Error("No Validator App exists for ".concat(t," network with ").concat(e," contract version"));return n}function It(){return(It=c(u().mark((function t(e){var n,r,s,o,i,c;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,s=e.contractVersion,o=e.initiatorAddr,t.next=3,n.getTransactionParams().do();case 3:return i=t.sent,c=a.default.makeApplicationOptInTxnFromObject({from:o,appIndex:gt(r,s),note:ft.getAppCallTxnNoteWithClientName(s),suggestedParams:i}),t.abrupt("return",[{txn:c,signers:[o]}]);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var xt;function At(){return(At=c(u().mark((function t(e){var n,r,s,o,i,c;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,s=e.contractVersion,o=e.initiatorAddr,t.next=3,n.getTransactionParams().do();case 3:return i=t.sent,c=a.default.makeApplicationClearStateTxnFromObject({from:o,appIndex:gt(r,s),note:ft.getAppCallTxnNoteWithClientName(s),suggestedParams:i}),t.abrupt("return",[{txn:c,signers:[o]}]);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}exports.SwapType=void 0,(xt=exports.SwapType||(exports.SwapType={})).FixedInput="fixed-input",xt.FixedOutput="fixed-output";var ht,Tt,yt;!function(t){t[t.INPUT_TXN=0]="INPUT_TXN",t[t.APP_CALL_TXN=1]="APP_CALL_TXN"}(yt||(yt={}));var vt,wt,_t=(f(ht={},exports.SwapType.FixedInput,1),f(ht,exports.SwapType.FixedOutput,2),ht),St=pt("swap"),Et=(f(Tt={},exports.SwapType.FixedInput,pt("fixed-input")),f(Tt,exports.SwapType.FixedOutput,pt("fixed-output")),Tt),bt={ASSET_OPT_IN:pt("asset_opt_in")},Dt={testnet:159521633,mainnet:0},Ot=(f(vt={},exports.SwapType.FixedInput,7),f(vt,exports.SwapType.FixedOutput,8),vt),Nt={mainnet:{base:"https://mainnet.analytics.tinyman.org/api",v1:"https://mainnet.analytics.tinyman.org/api/v1"},testnet:{base:"https://testnet.analytics.tinyman.org/api",v1:"https://testnet.analytics.tinyman.org/api/v1"}};function Pt(t){var e=Ft(t),n=e.assetIn,r=e.assetOut;return et(r.asset.decimals,Number(r.amount))/et(n.asset.decimals,Number(n.amount))}function kt(t){if(!Dt[t])throw new Error("Unknown network or network not supported: ".concat(t));return Dt[t]}function Lt(t){return t[t.length-1].quote.amount_out}function Rt(t){return t[0].quote.amount_in}function Ft(t){return{assetIn:Rt(t),assetOut:Lt(t)}}function Bt(t){return Mt.apply(this,arguments)}function Mt(){return(Mt=c(u().mark((function e(n){var r,s,o,i,c,p,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.routerAppID,o=n.assetIDs,i=n.accountAddress,e.next=3,r.getTransactionParams().do();case 3:return c=e.sent,p=a.default.makeApplicationNoOpTxnFromObject({from:i,appIndex:s,appArgs:[bt.ASSET_OPT_IN],foreignAssets:o,suggestedParams:c}),l=o.length,p.fee=t.ALGORAND_MIN_TX_FEE*(l+1),e.abrupt("return",p);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qt(t){return Vt.apply(this,arguments)}function Vt(){return(Vt=c(u().mark((function e(n){var r,s,o,i,c,p,l,d,f,m,g,I,x,A,h,T,y,v,w,_,S,E,b,D;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.initiatorAddr,s=n.client,o=n.network,i=n.swapType,c=n.route,e.next=3,s.getTransactionParams().do();case 3:return p=e.sent,l=[X(c[0].quote.amount_in.asset),X(c[0].quote.amount_out.asset),X(c[1].quote.amount_out.asset)],d=l[0],f=l[1],m=l[2],g=[Number(Rt(c).amount),Number(Lt(c).amount)],I=g[0],x=g[1],A=[c[0].pool.address,c[1].pool.address],h=A[0],T=A[1],y=j(d),v=kt(o),w=y?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:r,to:t.getApplicationAddress(v),amount:I,suggestedParams:p}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:r,to:t.getApplicationAddress(v),amount:I,assetIndex:d,suggestedParams:p}),(_=a.default.makeApplicationNoOpTxnFromObject({from:r,appIndex:v,appArgs:[St,Et[i],a.default.encodeUint64(x)],foreignApps:[gt(o,N.V2)],foreignAssets:[d,f,m],accounts:[h,T],suggestedParams:p})).fee=t.ALGORAND_MIN_TX_FEE*(Ot[i]+1),S=[w,_],e.next=15,Ct({client:s,routerAppID:v,assetIDs:[d,f,m]});case 15:if(!((E=e.sent).length>0)){e.next=21;break}return e.next=19,Bt({client:s,accountAddress:r,assetIDs:E,routerAppID:v});case 19:b=e.sent,S.unshift(b);case 21:return D=a.default.assignGroupID(S),e.abrupt("return",D.map((function(t){return{txn:t,signers:[r]}})));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ct(t){return jt.apply(this,arguments)}function jt(){return(jt=c(u().mark((function e(n){var r,a,s,o,i,c,p;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,a=n.routerAppID,s=n.assetIDs,o=t.getApplicationAddress(a),e.next=4,r.accountInformation(o).do();case 4:return i=e.sent,c=i.assets.map((function(t){return t["asset-id"]})),p=s.filter((function(t){return 0!==t&&!c.includes(t)})),e.abrupt("return",p);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xt(t){return qt.apply(this,arguments)}function qt(){return(qt=c(u().mark((function t(e){var n,r,a,s,o,i,c,p;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.amount,r=e.assetInID,a=e.assetOutID,s=e.swapType,o=e.network,i={asset_in_id:String(r),asset_out_id:String(a),swap_type:s,amount:String(n)},t.next=4,fetch("".concat(Nt[o].v1,"/swap-router/quotes/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).catch((function(){throw new Error("Network error")}));case 4:return c=t.sent,t.next=7,c.json();case 7:if(p=t.sent,c.ok){t.next=14;break}if(!lt(p)){t.next=13;break}throw new D(p.type,p.fallback_message);case 13:throw new D(exports.SwapQuoteErrorType.UnknownError,"Unknown error");case 14:return t.abrupt("return",p);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ut(t){var e=t.assetIn,n=t.assetOut;return et(n.decimals,Number(n.amount))/et(e.decimals,Number(e.amount))}function Gt(t){var e=t.inputSupply,n=t.outputSupply,r=t.assetIn,a=t.assetOut,s=Ut({assetIn:r,assetOut:a}),o=et(a.decimals,Number(n))/et(r.decimals,Number(e));return nt({decimalPlaces:5},Math.abs(s/o-1))}function Wt(t){if(t.type===exports.SwapQuoteType.Router){var e=Rt(t.data.route);return{id:X(e.asset),amount:Number(e.amount)}}return{id:t.data.quote.assetInID,amount:t.data.quote.assetInAmount}}function zt(t){if(t.type===exports.SwapQuoteType.Router){var e=Lt(t.data.route);return{id:X(e.asset),amount:Number(e.amount)}}return{id:t.data.quote.assetOutID,amount:t.data.quote.assetOutAmount}}function Jt(t){return t.type===exports.SwapQuoteType.Direct?t.data.pool.contractVersion:N.V2}exports.SwapQuoteType=void 0,(wt=exports.SwapQuoteType||(exports.SwapQuoteType={})).Direct="direct",wt.Router="router";var Yt={type:"logicsig",logic:{bytecode:"BCAIAQCBgICAgICAgPABgICAgICAgIDwAQMEBQYlJA1EMQkyAxJEMRUyAxJEMSAyAxJEMgQiDUQzAQAxABJEMwEQIQcSRDMBGIGCgICAgICAgPABEkQzARkiEjMBGyEEEhA3ARoAgAlib290c3RyYXASEEAAXDMBGSMSRDMBG4ECEjcBGgCABHN3YXASEEACOzMBGyISRDcBGgCABG1pbnQSQAE7NwEaAIAEYnVybhJAAZg3ARoAgAZyZWRlZW0SQAJbNwEaAIAEZmVlcxJAAnkAIQYhBSQjEk0yBBJENwEaARclEjcBGgIXJBIQRDMCADEAEkQzAhAhBBJEMwIhIxJEMwIiIxwSRDMCIyEHEkQzAiQjEkQzAiWACFRNUE9PTDExEkQzAiZRAA+AD1RpbnltYW5Qb29sMS4xIBJEMwIngBNodHRwczovL3RpbnltYW4ub3JnEkQzAikyAxJEMwIqMgMSRDMCKzIDEkQzAiwyAxJEMwMAMQASRDMDECEFEkQzAxElEkQzAxQxABJEMwMSIxJEJCMTQAAQMwEBMwIBCDMDAQg1AUIBsTMEADEAEkQzBBAhBRJEMwQRJBJEMwQUMQASRDMEEiMSRDMBATMCAQgzAwEIMwQBCDUBQgF8MgQhBhJENwEcATEAE0Q3ARwBMwQUEkQzAgAxABNEMwIUMQASRDMDADMCABJEMwIRJRJEMwMUMwMHMwMQIhJNMQASRDMDESMzAxAiEk0kEkQzBAAxABJEMwQUMwIAEkQzAQEzBAEINQFCAREyBCEGEkQ3ARwBMQATRDcBHAEzAhQSRDMDFDMDBzMDECISTTcBHAESRDMCADEAEkQzAhQzBAASRDMCESUSRDMDADEAEkQzAxQzAwczAxAiEk0zBAASRDMDESMzAxAiEk0kEkQzBAAxABNEMwQUMQASRDMBATMCAQgzAwEINQFCAJAyBCEFEkQ3ARwBMQATRDMCADcBHAESRDMCADEAE0QzAwAxABJEMwIUMwIHMwIQIhJNMQASRDMDFDMDBzMDECISTTMCABJEMwEBMwMBCDUBQgA+MgQhBBJENwEcATEAE0QzAhQzAgczAhAiEk03ARwBEkQzAQEzAgEINQFCABIyBCEEEkQzAQEzAgEINQFCAAAzAAAxABNEMwAHMQASRDMACDQBD0M=",address:"ABUKAXTANWR6K6ZYV75DWJEPVWWOU6SFUVRI6QHO44E4SIDLHBTD2CZ64A",size:881,variables:[{name:"TMPL_ASSET_ID_1",type:"int",index:15,length:10},{name:"TMPL_ASSET_ID_2",type:"int",index:5,length:10},{name:"TMPL_VALIDATOR_APP_ID",type:"int",index:74,length:10}],source:"https://github.com/tinymanorg/tinyman-contracts-v1/tree/dc9ab40c58b85c15d58f63a1507e18be76720dbb/contracts/pool_logicsig.teal.tmpl"},name:"pool_logicsig"},Kt={type:"app",global_state_schema:{num_uints:0,num_byte_slices:0},local_state_schema:{num_uints:16,num_byte_slices:0},name:"validator_app"},Ht=d((function t(e){p(this,t),this.schema={numLocalInts:e.local_state_schema.num_uints,numLocalByteSlices:e.local_state_schema.num_byte_slices,numGlobalInts:e.global_state_schema.num_uints,numGlobalByteSlices:e.global_state_schema.num_byte_slices}})),Zt=new(function(n){m(a,Ht);var r=v(a);function a(t,e){var n;return p(this,a),(n=r.call(this,t)).poolLogicSigContractTemplate=e.logic.bytecode,n.templateVariables=e.logic.variables,n}return d(a,[{key:"generateLogicSigAccountForPool",value:function(n){if(n.asset1ID===n.asset2ID)throw new Error("Assets are the same");var r=gt(n.network,N.V1_1),a=w(C(n.asset1ID,n.asset2ID),2),s=a[0],o=a[1],u=Array.from(e.toByteArray(this.poolLogicSigContractTemplate)),i={asset_id_1:s,asset_id_2:o,validator_app_id:r},c=0;this.templateVariables.sort((function(t,e){return t.index-e.index}));for(var p=0;p<this.templateVariables.length;p++){var l=this.templateVariables[p],d=i[l.name.split("TMPL_")[1].toLowerCase()],f=l.index-c,m=f+l.length,g=ct(d);c+=l.length-g.length,u=u.slice(0,f).concat(g).concat(u.slice(m))}var I=new Uint8Array(u);return new t.LogicSigAccount(I)}}]),a}())(Kt,Yt),$t={type:"logicsig",logic:{bytecode:"BoAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgQBbNQA0ADEYEkQxGYEBEkSBAUM="},name:"pool_logicsig"},te={type:"app",global_state_schema:{num_uints:0,num_byte_slices:3},local_state_schema:{num_uints:12,num_byte_slices:2},name:"validator_app"},ee=new(function(e){m(r,Ht);var n=v(r);function r(t,e){var a;return p(this,r),(a=n.call(this,t)).poolLogicSigContractTemplate=e.logic.bytecode,a}return d(r,[{key:"generateLogicSigAccountForPool",value:function(e){if(e.asset1ID===e.asset2ID)throw new Error("Assets are the same");var n=gt(e.network,N.V2),r=w(C(e.asset1ID,e.asset2ID),2),a=r[0],s=r[1],o={bytes:Array.from(Buffer.from(this.poolLogicSigContractTemplate,"base64")),validatorAppId:Array.from(t.encodeUint64(n)),asset1ID:Array.from(t.encodeUint64(a)),asset2ID:Array.from(t.encodeUint64(s))},u=[].concat(_(o.bytes.slice(0,3)),_(o.validatorAppId.slice(0,8)),_(o.asset1ID.slice(0,8)),_(o.asset2ID.slice(0,8)),_(o.bytes.slice(27)));return new t.LogicSigAccount(new Uint8Array(u))}}]),r}())(te,$t);function ne(t){return function(t){return t===N.V2}(t)?ee:Zt}function re(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.IntDecoding.DEFAULT;return new Promise(function(){var t=c(u().mark((function t(a,s){var i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.accountInformation(n).setIntDecoding(r).do();case 3:i=t.sent,a(o(o({},i),{},{minimum_required_balance:se(i)})),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),s(new Error(t.t0.message||"Failed to fetch account information"));case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,n){return t.apply(this,arguments)}}())}function ae(t,e){var n=t["apps-local-state"].find((function(t){return t.id===e}));return n?q({stateArray:n["key-value"],shouldDecodeKeys:!0}):null}function se(t){var e=t["apps-total-schema"];return 1e5+1e5*(t.assets||[]).length+1e5*(t["created-apps"]||[]).length+1e5*(t["apps-local-state"]||[]).length+5e4*Number(e&&e["num-byte-slice"]||0)+28500*Number(e&&e["num-uint"]||0)+1e5*(t["apps-total-extra-pages"]||0)}var oe,ue,ie=pt("e");function ce(t){return pe.apply(this,arguments)}function pe(){return(pe=c(u().mark((function n(r){var s,o,i,c,p,l,d,f,m,g,I,x,A,h,T,y,v,w,_,S,E;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=r.client,o=r.pool,i=r.accountAddr,n.next=3,s.accountInformation(i).setIntDecoding(t.IntDecoding.BIGINT).do();case 3:c=n.sent,p=c["apps-local-state"]||[],l=0n,d=0n,f=0n,m=o.account.address(),g=b(p),n.prev=10,g.s();case 12:if((I=g.n()).done){n.next=31;break}if((x=I.value).id==o.validatorAppID){n.next=16;break}return n.abrupt("continue",29);case 16:if(A=x["key-value"]){n.next=19;break}return n.abrupt("break",31);case 19:h=q({stateArray:A}),T=e.fromByteArray(U([a.default.decodeAddress(m).publicKey,ie,a.default.encodeUint64(o.asset1ID)])),y=e.fromByteArray(U([a.default.decodeAddress(m).publicKey,ie,a.default.encodeUint64(o.asset2ID)])),v=e.fromByteArray(U([a.default.decodeAddress(m).publicKey,ie,a.default.encodeUint64(o.poolTokenID)])),w=h[T],_=h[y],S=h[v],"bigint"==typeof w&&(l=w),"bigint"==typeof _&&(d=_),"bigint"==typeof S&&(f=S);case 29:n.next=12;break;case 31:n.next=36;break;case 33:n.prev=33,n.t0=n.catch(10),g.e(n.t0);case 36:return n.prev=36,g.f(),n.finish(36);case 39:if(!((E={excessAsset1:l,excessAsset2:d,excessPoolTokens:f}).excessAsset1<0n||E.excessAsset2<0n||E.excessPoolTokens<0n)){n.next=42;break}throw new Error("Invalid account excess: ".concat(E));case 42:return n.abrupt("return",E);case 43:case"end":return n.stop()}}),n,null,[[10,33,36,39]])})))).apply(this,arguments)}function le(){return(le=c(u().mark((function n(r){var s,o,i,c,p,l,d,f,m,g,I,x,A,h,T;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=r.client,o=r.accountAddr,i=r.validatorAppID,n.next=3,s.accountInformation(o).setIntDecoding(t.IntDecoding.BIGINT).do();case 3:if(c=n.sent,p=c["apps-local-state"]||[],l=p.find((function(t){return t.id==i})),d=[],l&&l["key-value"])for(f=q({stateArray:l["key-value"]}),m=0,g=Object.entries(f);m<g.length;m++)I=g[m],x=w(I,2),A=x[0],h=x[1],41===(T=e.toByteArray(A)).length&&101===T[32]&&d.push({poolAddress:a.default.encodeAddress(T.slice(0,32)),assetID:a.default.decodeUint64(T.slice(33,41),"safe"),amount:parseInt(h)});return n.abrupt("return",d);case 9:case"end":return n.stop()}}),n)})))).apply(this,arguments)}exports.PoolStatus=void 0,(oe=exports.PoolStatus||(exports.PoolStatus={})).NOT_CREATED="not created",oe.BOOTSTRAP="bootstrap",oe.READY="ready",oe.ERROR="error";var de=(f(ue={},N.V1_1,{asset1:"a1",asset2:"a2"}),f(ue,N.V2,{asset1:"asset_1_id",asset2:"asset_2_id",poolTokenID:"pool_token_asset_id",issuedPoolTokens:"issued_pool_tokens",asset1Reserves:"asset_1_reserves",asset2Reserves:"asset_2_reserves",asset1ProtocolFees:"asset_1_protocol_fees",asset2ProtocolFees:"asset_2_protocol_fees",totalFeeShare:"total_fee_share",protocolFeeRatio:"protocol_fee_ratio",cumulativePriceUpdateTimeStamp:"cumulative_price_update_timestamp"}),ue),fe=pt("o"),me=0xffffffffffffffffn;function ge(t){return Ie.apply(this,arguments)}function Ie(){return(Ie=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l,d,f,m,g,I;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.client,a=e.network,s=e.asset1ID,o=e.asset2ID,i=ne(N.V1_1),c=i.generateLogicSigAccountForPool(e),p=gt(a,N.V1_1),l=c.address(),d=C(s,o),t.next=8,re(r,l);case 8:return f=t.sent,m=ae(f,p),g=null===(n=f["created-assets"][0])||void 0===n?void 0:n.index,I={account:c,validatorAppID:p,asset1ID:d[0],asset2ID:d[1],status:m||g?exports.PoolStatus.READY:exports.PoolStatus.NOT_CREATED,contractVersion:N.V1_1,poolTokenID:g},m&&(I.asset1ID=m[de.v1_1.asset1],I.asset2ID=m[de.v1_1.asset2]),t.abrupt("return",I);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function xe(){return(xe=c(u().mark((function n(r,s){var o,i,c,p,l,d,f,m,g,I,x,A,h,T,y,v,w,_,S,E,D,O,N,P,k,L;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,re(r,s.account.address(),t.IntDecoding.BIGINT);case 2:o=n.sent,i=o["apps-local-state"]||[],c=0n,p=0n,l=0n,d=b(i),n.prev=8,d.s();case 10:if((f=d.n()).done){n.next=29;break}if((m=f.value).id==s.validatorAppID){n.next=14;break}return n.abrupt("continue",27);case 14:if(g=m["key-value"]){n.next=17;break}return n.abrupt("break",29);case 17:I=q({stateArray:g}),x=e.fromByteArray(U([fe,a.default.encodeUint64(s.asset1ID)])),A=e.fromByteArray(U([fe,a.default.encodeUint64(s.asset2ID)])),h=e.fromByteArray(U([fe,a.default.encodeUint64(s.poolTokenID)])),T=I[x],y=I[A],v=I[h],"bigint"==typeof T&&(c=T),"bigint"==typeof y&&(p=y),"bigint"==typeof v&&(l=v);case 27:n.next=10;break;case 29:n.next=34;break;case 31:n.prev=31,n.t0=n.catch(8),d.e(n.t0);case 34:return n.prev=34,d.f(),n.finish(34);case 37:w=0n,_=0n,S=0n,E=b(o.assets);try{for(E.s();!(D=E.n()).done;)O=D.value,N=O["asset-id"],P=O.amount,N==s.asset1ID?w=BigInt(P):N==s.asset2ID?_=BigInt(P):N==s.poolTokenID&&(S=BigInt(P))}catch(t){E.e(t)}finally{E.f()}if(0===s.asset2ID&&(k=K(o),(_=BigInt(o.amount)-k)<0n&&(_=0n)),!((L={asset1:w-c,asset2:_-p,issuedLiquidity:me-S+l,round:o.round}).asset1<0n||L.asset2<0n)){n.next=46;break}throw new Error("The pool reserves are below zero. The manager of one of the assets has used clawback to remove assets from this pool. Do not interact with the pool.");case 46:if(!(L.issuedLiquidity<0n||L.issuedLiquidity>me)){n.next=48;break}throw new Error("Issued liquidity value is out of the expected range ([0n, ".concat(me,"]): ").concat(L.issuedLiquidity));case 48:return n.abrupt("return",L);case 49:case"end":return n.stop()}}),n,null,[[8,31,34,37]])})))).apply(this,arguments)}function Ae(){return Ae=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l,d=arguments;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.client,r=e.address,a=e.network,!(s=d.length>1&&void 0!==d[1]?d[1]:{})[r]){t.next=4;break}return t.abrupt("return",s[r]);case 4:return t.next=6,re(n,r);case 6:return o=t.sent,i=ae(o,gt(a,N.V1_1)),c=null,i&&(l=o["created-assets"][0],p=l.index,c={asset1ID:i[de[N.V1_1].asset1],asset2ID:i[de[N.V1_1].asset2],poolTokenID:p},s[r]=c),t.abrupt("return",c);case 11:case"end":return t.stop()}}),t)}))),Ae.apply(this,arguments)}var he=Object.freeze({__proto__:null,getPoolInfo:ge,getPoolReserves:function(t,e){return xe.apply(this,arguments)},getPoolAssets:function(t){return Ae.apply(this,arguments)}});function Te(t){return ye.apply(this,arguments)}function ye(){return(ye=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l,d,f,m;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,a=e.asset1ID,s=e.asset2ID,o=ne(N.V2),i=o.generateLogicSigAccountForPool(e),c=gt(r,N.V2),p=i.address(),l=C(a,s),t.next=8,re(n,p);case 8:return d=t.sent,f=ae(d,c),m={account:i,validatorAppID:c,asset1ID:l[0],asset2ID:l[1],status:f?exports.PoolStatus.READY:exports.PoolStatus.NOT_CREATED,contractVersion:N.V2},f&&(m.asset1ProtocolFees=BigInt(f[de.v2.asset1ProtocolFees]),m.asset2ProtocolFees=BigInt(f[de.v2.asset2ProtocolFees]),m.asset1Reserves=BigInt(f[de.v2.asset1Reserves]),m.asset2Reserves=BigInt(f[de.v2.asset2Reserves]),m.issuedPoolTokens=BigInt(f[de.v2.issuedPoolTokens]),m.cumulativePriceUpdateTimeStamp=Number(f[de.v2.cumulativePriceUpdateTimeStamp]),m.protocolFeeRatio=Number(f[de.v2.protocolFeeRatio]),m.totalFeeShare=BigInt(f[de.v2.totalFeeShare]),m.poolTokenID=Number(f[de.v2.poolTokenID]),m.asset1ID=Number(f[de.v2.asset1]),m.asset2ID=Number(f[de.v2.asset2])),t.abrupt("return",m);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ve(){return(ve=c(u().mark((function t(e,n){var r,a,s;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,re(e,n.account.address());case 2:return r=t.sent,a=ae(r,n.validatorAppID),s={asset1:0n,asset2:0n,issuedLiquidity:0n,round:r.round},a&&(s.asset1=BigInt(a[de.v2.asset1Reserves]),s.asset2=BigInt(a[de.v2.asset2Reserves]),s.issuedLiquidity=BigInt(a[de.v2.issuedPoolTokens])),t.abrupt("return",s);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function we(){return(we=c(u().mark((function t(e){var n,r,a,s,o,i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.address,a=e.network,t.next=3,re(n,r);case 3:return s=t.sent,o=ae(s,gt(a,N.V2)),i=null,o&&(i={asset1ID:o[de[N.V2].asset1],asset2ID:o[de[N.V2].asset2],poolTokenID:o[de[N.V2].poolTokenID]}),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var _e=Object.freeze({__proto__:null,getPoolInfo:Te,getPoolReserves:function(t,e){return ve.apply(this,arguments)},getPoolAssets:function(t){return we.apply(this,arguments)}});function Se(t){return Boolean(t&&!(t.asset1+t.asset2))}var Ee,be,De=Object.freeze({__proto__:null,getPoolShare:function(t,e){var n=Number(e)/Number(t);return Number.isFinite(n)||(n=0),n},getPoolPairRatio:function(t,e){var n=Se(e),r=null;return e&&!n&&e.asset1&&e.asset2&&"number"==typeof t.asset2&&"number"==typeof t.asset1&&(r=et(t.asset1,e.asset1)/et(t.asset2,e.asset2)),r},isPoolEmpty:Se,isPoolNotCreated:function(t){return(null==t?void 0:t.status)===exports.PoolStatus.NOT_CREATED},isPoolReady:function(t){return(null==t?void 0:t.status)===exports.PoolStatus.READY},getPoolsForPair:function(t){return Promise.all([ge(t),Te(t)])}}),Oe=o((f(Ee={},N.V1_1,o(o({},he),De)),f(Ee,N.V2,o(o({},_e),De)),Ee),De);!function(t){t[t.FUNDING_TXN=0]="FUNDING_TXN",t[t.VALIDATOR_APP_CALL=1]="VALIDATOR_APP_CALL",t[t.POOL_TOKEN_CREATE=2]="POOL_TOKEN_CREATE",t[t.ASSET1_OPT_IN=3]="ASSET1_OPT_IN",t[t.ASSET2_OPT_IN=4]="ASSET2_OPT_IN"}(be||(be={}));var Ne=96e4,Pe=859e3;function ke(){return(ke=c(u().mark((function t(e){var n,r,s,o,i,c,p,l,d,f,m,g,I,x,A,h,T,y,v,_,S,E,b,D,O;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,s=e.asset_1,o=e.asset_2,i=e.initiatorAddr,t.next=3,n.getTransactionParams().do();case 3:return c=t.sent,p=V(s,o),l=w(p,2),d=l[0],f=d.id,m=d.unit_name,g=l[1],I=g.id,x=g.unit_name,A=j(I),h=gt(r,N.V1_1),T=Zt.generateLogicSigAccountForPool({network:r,asset1ID:f,asset2ID:I}),y=T.address(),v=a.default.makeApplicationOptInTxnFromObject({from:y,appIndex:h,note:ft.getAppCallTxnNoteWithClientName(N.V1_1),appArgs:[pt("bootstrap"),a.default.encodeUint64(f),a.default.encodeUint64(I)],foreignAssets:A?[f]:[I],suggestedParams:c}),_=a.default.makeAssetCreateTxnWithSuggestedParamsFromObject({from:y,total:0xffffffffffffffffn,decimals:6,defaultFrozen:!1,unitName:k.V1_1,assetName:"TinymanPool1.1 ".concat(m,"-").concat(x),assetURL:"https://tinyman.org",suggestedParams:c}),S=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:y,to:y,assetIndex:f,amount:0,suggestedParams:c}),E=a.default.makePaymentTxnWithSuggestedParamsFromObject({from:i,to:y,amount:Le(A),suggestedParams:c}),(b=[])[be.FUNDING_TXN]=E,b[be.VALIDATOR_APP_CALL]=v,b[be.POOL_TOKEN_CREATE]=_,b[be.ASSET1_OPT_IN]=S,A||(b[be.ASSET2_OPT_IN]=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:y,to:y,assetIndex:I,amount:0,suggestedParams:c})),D=a.default.assignGroupID(b),O=[{txn:D[be.FUNDING_TXN],signers:[i]},{txn:D[be.VALIDATOR_APP_CALL],signers:[y]},{txn:D[be.POOL_TOKEN_CREATE],signers:[y]},{txn:D[be.ASSET1_OPT_IN],signers:[y]}],D[be.ASSET2_OPT_IN]&&O.push({txn:D[be.ASSET2_OPT_IN],signers:[y]}),t.abrupt("return",O);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Le(t){return t?Ne:Pe}function Re(){return(Re=c(u().mark((function t(e){var n,r,s,o,i,c,p,l,d,f,m,g,I,x,A;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.txGroup,r=e.network,s=e.initiatorSigner,o=e.asset1ID,i=e.asset2ID,t.next=3,s([n]);case 3:return c=t.sent,p=w(c,1),l=p[0],d=C(o,i),f=w(d,2),m=f[0],g=f[1],I=Zt.generateLogicSigAccountForPool({network:r,asset1ID:m,asset2ID:g}),x=[],A=n.map((function(t,e){if(e===be.FUNDING_TXN)return x.push(t.txn.txID().toString()),l;var n=a.default.signLogicSigTransactionObject(t.txn,I),r=n.txID,s=n.blob;return x.push(r),s})),t.abrupt("return",{signedTxns:A,txnIDs:x});case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Fe(t){return Be.apply(this,arguments)}function Be(){return(Be=c(u().mark((function t(e){var n,r,a,s,o;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.signedTxns,a=e.txnIDs,t.prev=1,t.next=4,n.sendRawTransaction(r).do();case 4:return t.next=6,Z(n,a[be.POOL_TOKEN_CREATE]);case 6:if(s=t.sent,"number"==typeof(o=s["asset-index"])){t.next=10;break}throw new Error("Generated ID is not valid: got ".concat(o));case 10:return t.abrupt("return",{poolTokenID:o});case 13:throw t.prev=13,t.t0=t.catch(1),new M(t.t0,"We encountered something unexpected while bootstraping the pool. Try again later.");case 16:case"end":return t.stop()}}),t,null,[[1,13]])})))).apply(this,arguments)}function Me(){return(Me=c(u().mark((function t(e){var n,r,a,s,o,i,c;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,a=e.pool,s=a.asset1ID,o=a.asset2ID,i=e.signedTxns,c=e.txnIDs,t.next=3,Fe({client:n,signedTxns:i,txnIDs:c});case 3:return t.abrupt("return",Oe.v1_1.getPoolInfo({client:n,network:r,asset1ID:s,asset2ID:o}));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Qe,Ve={generateTxns:function(t){return ke.apply(this,arguments)},signTxns:function(t){return Re.apply(this,arguments)},execute:function(t){return Me.apply(this,arguments)},getBootstrapFundingTxnAmount:Le};!function(t){t[t.FUNDING_TXN=0]="FUNDING_TXN",t[t.VALIDATOR_APP_CALL=1]="VALIDATOR_APP_CALL"}(Qe||(Qe={}));var Ce=5,je=6;function Xe(t,e){return qe.apply(this,arguments)}function qe(){return(qe=c(u().mark((function e(n,r){var a,s,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(s=null===(a=r.find((function(t){return"appl"===t.txn.type})))||void 0===a?void 0:a.txn.txID())){e.next=7;break}return e.next=4,t.waitForConfirmation(n,s,1e3);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=void 0;case 8:return o=e.t0,e.abrupt("return",o);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ue(t,e){return Ge.apply(this,arguments)}function Ge(){return(Ge=c(u().mark((function t(e,n){var r;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Xe(e,n);case 2:return r=t.sent,t.abrupt("return",null==r?void 0:r["inner-txns"]);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function We(t,e){return ze.apply(this,arguments)}function ze(){return(ze=c(u().mark((function e(n,r){var a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(n,r);case 2:return a=e.sent,e.abrupt("return",null==a?void 0:a.reduce((function(e,n){var r=e,a=n.txn.txn;return a.type===t.TransactionType.axfer?r.push({id:a.xaid,amount:a.aamt}):a.type===t.TransactionType.pay&&r.push({id:0,amount:a.amt}),r}),[]));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Je(){return(Je=c(u().mark((function e(n){var r,s,o,i,c,p,l,d,f,m,g,I,x,A,h,T,y,v,_,S;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.network,o=n.asset_1,i=n.asset_2,c=n.initiatorAddr,e.next=3,r.getTransactionParams().do();case 3:return p=e.sent,l=gt(s,N.V2),d=t.getApplicationAddress(l),f=V(o,i),m=w(f,2),g=m[0].id,I=m[1].id,e.next=9,Oe.v2.getPoolInfo({client:r,network:s,asset1ID:g,asset2ID:I});case 9:if(e.sent.status!==exports.PoolStatus.READY){e.next=12;break}throw new Error("Pool for ".concat(o.unit_name,"-").concat(i.unit_name," already exists"));case 12:return x=ee.generateLogicSigAccountForPool({network:s,asset1ID:g,asset2ID:I}),A=x.address(),h=j(I),(T=a.default.makeApplicationOptInTxnFromObject({from:A,appIndex:l,appArgs:[pt("bootstrap")],note:ft.getAppCallTxnNoteWithClientName(N.V2),foreignAssets:[g,I],rekeyTo:d,suggestedParams:p})).fee=Ke(h),y=a.default.makePaymentTxnWithSuggestedParamsFromObject({from:c,to:A,amount:Ye(h),suggestedParams:p}),(v=[])[Qe.FUNDING_TXN]=y,v[Qe.VALIDATOR_APP_CALL]=T,_=a.default.assignGroupID(v),(S=[])[Qe.FUNDING_TXN]={txn:_[Qe.FUNDING_TXN],signers:[c]},S[Qe.VALIDATOR_APP_CALL]={txn:_[Qe.VALIDATOR_APP_CALL],signers:[A]},e.abrupt("return",S);case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ye(t){return function(t,e){var n=ne(t).schema,r=4e5+28500*n.numLocalInts+5e4*n.numLocalByteSlices;return e||(r+=1e5),r}(N.V2,t)+Ke(t)+1e5}function Ke(e){return((e?Ce:je)+1)*t.ALGORAND_MIN_TX_FEE}function He(){return(He=c(u().mark((function t(e){var n,r,s,o,i,c,p,l,d,f,m,g,I,x,A;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.txGroup,r=e.network,s=e.initiatorSigner,o=e.asset1ID,i=e.asset2ID,t.next=3,s([n]);case 3:return c=t.sent,p=w(c,1),l=p[0],d=C(o,i),f=w(d,2),m=f[0],g=f[1],I=ee.generateLogicSigAccountForPool({network:r,asset1ID:m,asset2ID:g}),x=[],A=n.map((function(t,e){if(e===Qe.FUNDING_TXN)return x.push(t.txn.txID().toString()),l;var n=a.default.signLogicSigTransactionObject(t.txn,I),r=n.txID,s=n.blob;return x.push(r),s})),t.abrupt("return",{signedTxns:A,txnIDs:x});case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ze(){return(Ze=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l,d,f;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,a=e.pool,s=a.asset1ID,o=a.asset2ID,i=e.txGroup,c=e.signedTxns,t.prev=1,t.next=4,n.sendRawTransaction(c).do();case 4:return t.next=6,Xe(n,i);case 6:if(t.t1=p=t.sent,t.t0=null===t.t1,t.t0){t.next=10;break}t.t0=void 0===p;case 10:if(!t.t0){t.next=14;break}t.t2=void 0,t.next=15;break;case 14:t.t2=null===(l=p["local-state-delta"][0].delta)||void 0===l||null===(d=l.find((function(t){return t.key===btoa(de.v2.poolTokenID)})))||void 0===d?void 0:d.value.uint;case 15:if("number"==typeof(f=t.t2)){t.next=18;break}throw new Error("Generated ID is not valid: got ".concat(f));case 18:return t.abrupt("return",Oe.v2.getPoolInfo({client:n,network:r,asset1ID:s,asset2ID:o}));case 21:throw t.prev=21,t.t3=t.catch(1),new M(t.t3,"We encountered something unexpected while bootstraping the pool. Try again later.");case 24:case"end":return t.stop()}}),t,null,[[1,21]])})))).apply(this,arguments)}var $e,tn={generateTxns:function(t){return Je.apply(this,arguments)},signTxns:function(t){return He.apply(this,arguments)},execute:function(t){return Ze.apply(this,arguments)},getBootstrapFundingTxnAmount:Ye,getTotalCost:function(e){return t.ALGORAND_MIN_TX_FEE+Ye(e)}};var en,nn=(f($e={},N.V1_1,Ve),f($e,N.V2,tn),f($e,"generateTxns",(function(t){return t.contractVersion===N.V1_1?Ve.generateTxns(t):tn.generateTxns(t)})),f($e,"signTxns",(function(t){return t.contractVersion===N.V1_1?Ve.signTxns(t):tn.signTxns(t)})),f($e,"execute",(function(t){return t.contractVersion===N.V1_1?Ve.execute(t):tn.execute(t)})),f($e,"calculateBootstrapFundingTxnAmount",(function(t){var e=t.contractVersion,n=t.isAlgoPool;return e===N.V1_1?Ve.getBootstrapFundingTxnAmount(n):tn.getBootstrapFundingTxnAmount(n)})),$e);exports.V1_1AddLiquidityTxnIndices=void 0,(en=exports.V1_1AddLiquidityTxnIndices||(exports.V1_1AddLiquidityTxnIndices={}))[en.FEE_TXN=0]="FEE_TXN",en[en.VALIDATOR_APP_CALL_TXN=1]="VALIDATOR_APP_CALL_TXN",en[en.ASSET1_IN_TXN=2]="ASSET1_IN_TXN",en[en.ASSET2_IN_TXN=3]="ASSET2_IN_TXN",en[en.LIQUDITY_OUT_TXN=4]="LIQUDITY_OUT_TXN";var rn,an,sn,on,un=5*t.ALGORAND_MIN_TX_FEE;exports.V2AddLiquidityType=void 0,(on=exports.V2AddLiquidityType||(exports.V2AddLiquidityType={})).SINGLE="single",on.FLEXIBLE="flexible",on.INITIAL="initial";var cn,pn=(f(rn={},exports.V2AddLiquidityType.FLEXIBLE,{ASSET1_IN_TXN:0,ASSET2_IN_TXN:1,VALIDATOR_APP_CALL_TXN:2}),f(rn,exports.V2AddLiquidityType.SINGLE,{ASSET_IN_TXN:0,VALIDATOR_APP_CALL_TXN:1}),f(rn,exports.V2AddLiquidityType.INITIAL,{ASSET1_IN_TXN:0,ASSET2_IN_TXN:1,VALIDATOR_APP_CALL_TXN:2}),rn),ln=(f(an={},exports.V2AddLiquidityType.INITIAL,1),f(an,exports.V2AddLiquidityType.SINGLE,2),f(an,exports.V2AddLiquidityType.FLEXIBLE,2),an),dn=(f(sn={},exports.V2AddLiquidityType.INITIAL,3),f(sn,exports.V2AddLiquidityType.FLEXIBLE,3),f(sn,exports.V2AddLiquidityType.SINGLE,2),sn);function fn(t){var e,n,r,a=t.reserves,s=t.totalFeeShare,o=t.asset1,u=t.asset2,i=a.asset1*a.asset2,c=a.asset1+BigInt(o.amount),p=a.asset2+BigInt(u.amount),l=c*p,d=BigInt(parseInt(String(Math.sqrt(Number(l*a.issuedLiquidity*a.issuedLiquidity/i))))),f=d-a.issuedLiquidity,m=f*c/d,g=f*p/d,I=BigInt(o.amount)-m,x=BigInt(u.amount)-g;if(I>x){var A=I;r=gn(A,s),e={id:o.id,amount:A+r,decimals:o.decimals,reserves:a.asset1},n={id:u.id,amount:BigInt(Math.abs(Math.min(Number(x),0))),decimals:u.decimals,reserves:a.asset2},f-=r*d/(c*BigInt(2))}else{var h=x;r=gn(h,s),e={id:u.id,amount:h+r,decimals:u.decimals,reserves:a.asset2},n={id:o.id,amount:BigInt(Math.abs(Math.min(Number(I),0))),decimals:o.decimals,reserves:a.asset1},f-=r*d/(p*BigInt(2))}return{poolTokenOutAmount:f,internalSwapQuote:{assetIn:e,assetOut:n,swapFees:r,priceImpact:Gt({inputSupply:e.reserves,outputSupply:n.reserves,assetIn:e,assetOut:n})}}}function mn(t,e){if(!t.amount||!e.amount)throw new Error("Both assets are required for the initial add liquidity");return BigInt(Math.floor(Math.abs(Math.sqrt(Number(t.amount)*Number(e.amount))-1e3)))}function gn(t,e){return t*BigInt(e)/(BigInt(1e4)-BigInt(e))}function In(e){return(ln[e]+1)*t.ALGORAND_MIN_TX_FEE}var xn=pt("add_liquidity"),An=(f(cn={},N.V1_1,[pt("mint")]),f(cn,N.V2,{INITIAL_LIQUIDITY:[pt("add_initial_liquidity")],SINGLE_ASSET_MODE:[xn,pt("single")],FLEXIBLE_MODE:[xn,pt("flexible")]}),cn);function hn(){return(hn=c(u().mark((function t(e){var n,r,s,o,i,c,p,l,d,f,m,g,I,x,A,h;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,s=e.poolAddress,o=e.asset1In,i=e.asset2In,c=e.poolTokenOut,p=e.slippage,l=e.initiatorAddr,d=tt("negative",p,c.amount),t.next=4,n.getTransactionParams().do();case 4:return f=t.sent,m=a.default.makeApplicationNoOpTxnFromObject({from:s,appIndex:gt(r,N.V1_1),appArgs:An.v1_1,accounts:[l],note:ft.getAppCallTxnNoteWithClientName(N.V1_1),foreignAssets:0==i.id?[o.id,c.id]:[o.id,i.id,c.id],suggestedParams:f}),g=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:s,assetIndex:o.id,amount:o.amount,suggestedParams:f}),I=0===i.id?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:s,amount:i.amount,suggestedParams:f}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:s,assetIndex:i.id,amount:i.amount,suggestedParams:f}),x=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:s,to:l,assetIndex:c.id,amount:d,suggestedParams:f}),A=a.default.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:s,amount:m.fee+x.fee,note:O,suggestedParams:f}),h=a.default.assignGroupID([A,m,g,I,x]),t.abrupt("return",[{txn:h[0],signers:[l]},{txn:h[1],signers:[s]},{txn:h[2],signers:[l]},{txn:h[3],signers:[l]},{txn:h[4],signers:[s]}]);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Tn(){return(Tn=c(u().mark((function t(e){var n,r,s,o,i,c,p,l,d,f;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.pool,r=e.txGroup,s=e.initiatorSigner,o=n.account,t.next=4,s([r]);case 4:return i=t.sent,c=w(i,3),p=c[0],l=c[1],d=c[2],f=r.map((function(t,e){return e===exports.V1_1AddLiquidityTxnIndices.FEE_TXN?p:e===exports.V1_1AddLiquidityTxnIndices.ASSET1_IN_TXN?l:e===exports.V1_1AddLiquidityTxnIndices.ASSET2_IN_TXN?d:a.default.signLogicSigTransactionObject(t.txn,o).blob})),t.abrupt("return",f);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function yn(){return(yn=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l,d,f,m,g,I,x,A,h;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,a=e.txGroup,s=e.signedTxns,o=e.initiatorAddr,t.prev=1,i=BigInt(a[exports.V1_1AddLiquidityTxnIndices.LIQUDITY_OUT_TXN].txn.amount),t.next=5,ce({client:n,pool:r,accountAddr:o});case 5:return c=t.sent,t.next=8,st(n,[s]);case 8:return p=t.sent,l=w(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,g=ut(a),I=it(a),t.next=17,ce({client:n,pool:r,accountAddr:o});case 17:return x=t.sent,(A=x.excessPoolTokens-c.excessPoolTokens)<0n&&(A=0n),t.abrupt("return",{round:f,fees:g,poolTokenID:r.poolTokenID,poolTokenOut:i+A,excessAmount:{excessAmountForAddingLiquidity:A,totalExcessAmount:x.excessPoolTokens},txnID:m,groupID:I});case 23:throw t.prev=23,t.t0=t.catch(1),"SlippageTolerance"===(h=new M(t.t0,"We encountered something unexpected while adding liquidity. Try again later.")).type&&h.setMessage("Adding liquidity failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),h;case 28:case"end":return t.stop()}}),t,null,[[1,23]])})))).apply(this,arguments)}var vn=Object.freeze({__proto__:null,getQuote:function(t){var e=t.pool,n=t.reserves,r=t.asset1In,a=t.asset2In;if(0n===n.issuedLiquidity){var s=BigInt(Math.floor(Math.sqrt(Number(r)*Number(a))));if(s<=BigInt(1e3))throw new Error("Initial liquidity amount is too small. The amount must be greater than ".concat(1e3,", this quote is for ").concat(s,"."));return{round:n.round,asset1ID:e.asset1ID,asset1In:BigInt(r),asset2ID:e.asset2ID,asset2In:BigInt(a),poolTokenID:e.poolTokenID,poolTokenOut:s-BigInt(1e3),share:1}}var o=BigInt(r)*n.issuedLiquidity/n.asset1,u=BigInt(a)*n.issuedLiquidity/n.asset2,i=o<u?o:u;return{round:n.round,asset1ID:e.asset1ID,asset1In:BigInt(r),asset2ID:e.asset2ID,asset2In:BigInt(a),poolTokenID:e.poolTokenID,poolTokenOut:i,share:Oe.getPoolShare(n.issuedLiquidity+i,i)}},generateTxns:function(t){return hn.apply(this,arguments)},signTxns:function(t){return Tn.apply(this,arguments)},execute:function(t){return yn.apply(this,arguments)}});function wn(t){var e=t.txGroup;return(0,t.initiatorSigner)([e])}function _n(t){return Sn.apply(this,arguments)}function Sn(){return(Sn=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l,d,f,m;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,a=e.txGroup,s=e.signedTxns,t.prev=1,t.next=4,st(n,[s]);case 4:return o=t.sent,i=w(o,1),c=i[0],p=c.confirmedRound,l=c.txnID,t.prev=9,t.next=12,We(n,a);case 12:if(t.t1=f=t.sent,t.t0=null===t.t1,t.t0){t.next=16;break}t.t0=void 0===f;case 16:if(!t.t0){t.next=20;break}t.t2=void 0,t.next=21;break;case 20:t.t2=f.find((function(t){return t.id===r.poolTokenID}));case 21:d=t.t2,t.next=26;break;case 24:t.prev=24,t.t3=t.catch(9);case 26:return t.abrupt("return",{round:p,assetOut:d,fees:ut(a),poolTokenID:r.poolTokenID,txnID:l,groupID:it(a)});case 29:throw t.prev=29,t.t4=t.catch(1),"SlippageTolerance"===(m=new M(t.t4,"We encountered something unexpected while adding liquidity. Try again later.")).type&&m.setMessage("Adding liquidity failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),m;case 34:case"end":return t.stop()}}),t,null,[[1,29],[9,24]])})))).apply(this,arguments)}function En(){return(En=c(u().mark((function e(n){var r,s,o,i,c,p,l,d,f,m,g,I,x,A,h,T,y,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.network,o=n.poolAddress,i=n.asset1In,c=n.asset2In,p=n.poolTokenOut,l=n.initiatorAddr,d=n.minPoolTokenAssetAmount,e.next=3,r.getTransactionParams().do();case 3:return f=e.sent,m=V(i,c),g=w(m,2),I=g[0],x=g[1],A=j(x.id),h=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:o,assetIndex:I.id,amount:I.amount,suggestedParams:f}),T=A?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:o,amount:x.amount,suggestedParams:f}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:o,assetIndex:x.id,amount:x.amount,suggestedParams:f}),(y=a.default.makeApplicationNoOpTxnFromObject({from:l,appIndex:gt(s,N.V2),note:ft.getAppCallTxnNoteWithClientName(N.V2),appArgs:[].concat(_(An.v2.FLEXIBLE_MODE),[t.encodeUint64(d)]),accounts:[o],foreignAssets:[p.id],suggestedParams:f})).fee=In(exports.V2AddLiquidityType.FLEXIBLE),v=a.default.assignGroupID([h,T,y]),e.abrupt("return",[{txn:v[0],signers:[l]},{txn:v[1],signers:[l]},{txn:v[2],signers:[l]}]);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var bn=Object.freeze({__proto__:null,getQuote:function(t){var e=t.pool,n=t.slippage,r=void 0===n?.05:n,a=t.asset1,s=t.asset2;if(0n===e.issuedPoolTokens)throw new Error("Pool has no liquidity at the moment. To be able to do Flexible Swap, you should first add initial liquidity.");if(e.status!==exports.PoolStatus.READY)throw new Error("Pool is not ready");if(!e.poolTokenID)throw new Error("Pool token ID is not available");var o={asset1:e.asset1Reserves||0n,asset2:e.asset2Reserves||0n,issuedLiquidity:e.issuedPoolTokens||0n},u=fn({reserves:o,totalFeeShare:e.totalFeeShare,asset1:{id:e.asset1ID,amount:a.amount,decimals:a.decimals},asset2:{id:e.asset2ID,amount:s.amount,decimals:s.decimals}}),i=u.poolTokenOutAmount,c=u.internalSwapQuote,p=i-BigInt(Math.ceil(Number(i)*r));return{asset1In:{id:e.asset1ID,amount:BigInt(a.amount)},asset2In:{id:e.asset2ID,amount:BigInt(s.amount)},poolTokenOut:{id:e.poolTokenID,amount:i},share:Oe.getPoolShare(o.issuedLiquidity+i,i),slippage:r,internalSwapQuote:c,minPoolTokenAssetAmountWithSlippage:p}},generateTxns:function(t){return En.apply(this,arguments)},signTxns:wn,execute:_n});function Dn(){return(Dn=c(u().mark((function e(n){var r,s,o,i,c,p,l,d,f,m,g,I;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.network,o=n.poolAddress,i=n.assetIn,c=n.poolTokenId,p=n.initiatorAddr,l=n.minPoolTokenAssetAmount,e.next=3,r.getTransactionParams().do();case 3:return d=e.sent,f=j(i.id),m=f?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:p,to:o,amount:i.amount,suggestedParams:d}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:o,assetIndex:i.id,amount:i.amount,suggestedParams:d}),(g=a.default.makeApplicationNoOpTxnFromObject({from:p,appIndex:gt(s,N.V2),note:ft.getAppCallTxnNoteWithClientName(N.V2),appArgs:[].concat(_(An.v2.SINGLE_ASSET_MODE),[t.encodeUint64(l)]),accounts:[o],foreignAssets:[c],suggestedParams:d})).fee=In(exports.V2AddLiquidityType.SINGLE),I=a.default.assignGroupID([m,g]),e.abrupt("return",[{txn:I[0],signers:[p]},{txn:I[1],signers:[p]}]);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var On=Object.freeze({__proto__:null,getQuote:function(t){var e=t.pool,n=t.assetIn,r=t.slippage,a=void 0===r?.05:r,s=t.decimals;if(0n===e.issuedPoolTokens)throw new Error("Pool has no liquidity");if(e.status!==exports.PoolStatus.READY)throw new Error("Pool is not ready");if(!e.poolTokenID)throw new Error("Pool token ID is not available");var o=n.id===e.asset1ID,u=n.id===e.asset2ID;if(!o&&!u)throw new Error("Provided input asset id didn't match any asset of the pool");var i={id:e.asset1ID,amount:o?n.amount:0,decimals:s.asset1},c={id:e.asset2ID,amount:u?n.amount:0,decimals:s.asset2},p={asset1:e.asset1Reserves||0n,asset2:e.asset2Reserves||0n,issuedLiquidity:e.issuedPoolTokens||0n},l=fn({reserves:p,totalFeeShare:e.totalFeeShare||0,asset1:i,asset2:c}),d=l.poolTokenOutAmount,f=l.internalSwapQuote,m=d-BigInt(Math.ceil(Number(d)*a));return{assetIn:{id:o?e.asset1ID:e.asset2ID,amount:BigInt(n.amount)},poolTokenOut:{id:e.poolTokenID,amount:d},share:Oe.getPoolShare(p.issuedLiquidity+d,d),slippage:a,internalSwapQuote:f,minPoolTokenAssetAmountWithSlippage:m}},generateTxns:function(t){return Dn.apply(this,arguments)},signTxns:wn,execute:_n});function Nn(){return(Nn=c(u().mark((function t(e){var n,r,s,o,i,c,p,l,d,f,m,g,I;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,s=e.network,o=e.poolAddress,i=e.asset1In,c=e.asset2In,p=e.poolTokenId,l=e.initiatorAddr,d=j(r.asset2ID),t.next=4,n.getTransactionParams().do();case 4:return f=t.sent,m=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:o,assetIndex:r.asset1ID,amount:i.amount,suggestedParams:f}),g=d?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:o,amount:c.amount,suggestedParams:f}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:o,assetIndex:r.asset2ID,amount:c.amount,suggestedParams:f}),(I=a.default.makeApplicationNoOpTxnFromObject({from:l,appIndex:gt(s,N.V2),appArgs:An.v2.INITIAL_LIQUIDITY,note:ft.getAppCallTxnNoteWithClientName(N.V2),accounts:[o],foreignAssets:[p],suggestedParams:f})).fee=In(exports.V2AddLiquidityType.INITIAL),t.abrupt("return",a.default.assignGroupID([m,g,I]).map((function(t){return{txn:t,signers:[l]}})));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Pn,kn,Ln=Object.freeze({__proto__:null,getQuote:function(t){var e=t.pool,n=t.asset1,r=t.asset2,a=t.slippage,s=void 0===a?.05:a;if(0n!==e.issuedPoolTokens)throw new Error("Pool already has liquidity");var o=BigInt(Math.floor(Math.sqrt(Number(n.amount)*Number(r.amount))));if(o<=BigInt(1e3))throw new Error("Initial liquidity amount is too small. Liquidity amount must be greater than ".concat(1e3,", this quote is for ").concat(o,"."));return{asset1In:{id:e.asset1ID,amount:BigInt(n.amount)},asset2In:{id:e.asset2ID,amount:BigInt(r.amount)},poolTokenOut:{id:e.poolTokenID,amount:mn(n,r)},slippage:s}},generateTxns:function(t){return Nn.apply(this,arguments)},signTxns:wn,execute:_n}),Rn=Object.freeze({__proto__:null,flexible:bn,withSingleAsset:On,initial:Ln}),Fn=(f(Pn={},N.V1_1,vn),f(Pn,N.V2,Rn),Pn);!function(t){t[t.FEE_TXN=0]="FEE_TXN",t[t.VALIDATOR_APP_CALL_TXN=1]="VALIDATOR_APP_CALL_TXN",t[t.ASSET1_OUT_TXN=2]="ASSET1_OUT_TXN",t[t.ASSET2_OUT_TXN=3]="ASSET2_OUT_TXN",t[t.POOL_TOKEN_IN_TXN=4]="POOL_TOKEN_IN_TXN"}(kn||(kn={}));var Bn,Mn=Object.values(kn).length,Qn=pt("remove_liquidity");function Vn(){return(Vn=c(u().mark((function t(e){var n,r,s,o,i,c,p,l,d,f,m,g,I,x,A,h,T,y,v,w;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,s=e.poolTokenIn,o=e.asset1Out,i=e.asset2Out,c=e.slippage,p=e.initiatorAddr,t.next=3,n.getTransactionParams().do();case 3:return l=t.sent,d=r.account.address(),f=j(r.asset2ID),m=a.default.makeApplicationNoOpTxnFromObject({from:d,appIndex:r.validatorAppID,appArgs:[pt("burn")],note:ft.getAppCallTxnNoteWithClientName(N.V1_1),accounts:[p],foreignAssets:f?[r.asset1ID,r.poolTokenID]:[r.asset1ID,r.asset2ID,r.poolTokenID],suggestedParams:l}),g=tt("negative",c,o),I=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:d,to:p,assetIndex:r.asset1ID,amount:g,suggestedParams:l}),x=tt("negative",c,i),A=f?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:d,to:p,amount:x,suggestedParams:l}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:d,to:p,assetIndex:r.asset2ID,amount:x,suggestedParams:l}),h=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:d,assetIndex:r.poolTokenID,amount:s,suggestedParams:l}),T=m.fee+I.fee+A.fee,y=a.default.makePaymentTxnWithSuggestedParamsFromObject({from:p,to:d,amount:T,note:O,suggestedParams:l}),(v=[])[kn.FEE_TXN]=y,v[kn.VALIDATOR_APP_CALL_TXN]=m,v[kn.ASSET1_OUT_TXN]=I,v[kn.ASSET2_OUT_TXN]=A,v[kn.POOL_TOKEN_IN_TXN]=h,w=a.default.assignGroupID(v),t.abrupt("return",[{txn:w[kn.FEE_TXN],signers:[p]},{txn:w[kn.VALIDATOR_APP_CALL_TXN],signers:[d]},{txn:w[kn.ASSET1_OUT_TXN],signers:[d]},{txn:w[kn.ASSET2_OUT_TXN],signers:[d]},{txn:w[kn.POOL_TOKEN_IN_TXN],signers:[p]}]);case 22:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Cn(){return(Cn=c(u().mark((function t(e){var n,r,s,o,i,c,p,l,d;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.pool,r=e.txGroup,s=e.initiatorSigner,t.next=3,s([r]);case 3:return o=t.sent,i=w(o,2),c=i[0],p=i[1],l=n.account,d=r.map((function(t,e){return e===kn.FEE_TXN?c:e===kn.POOL_TOKEN_IN_TXN?p:a.default.signLogicSigTransactionObject(t.txn,l).blob})),t.abrupt("return",d);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function jn(){return(jn=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l,d,f,m,g,I,x,A,h,T;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,a=e.txGroup,s=e.signedTxns,o=e.initiatorAddr,t.prev=1,i=a[kn.ASSET1_OUT_TXN].txn.amount,c=a[kn.ASSET2_OUT_TXN].txn.amount,p=a[kn.POOL_TOKEN_IN_TXN].txn.amount,t.next=7,ce({client:n,pool:r,accountAddr:o});case 7:return l=t.sent,t.next=10,st(n,[s]);case 10:return d=t.sent,f=w(d,1),m=f[0],g=m.confirmedRound,I=m.txnID,t.next=17,ce({client:n,pool:r,accountAddr:o});case 17:return x=t.sent,(A=x.excessAsset1-l.excessAsset1)<0n&&(A=0n),(h=x.excessAsset2-l.excessAsset2)<0n&&(h=0n),t.abrupt("return",{round:g,fees:ut(a),asset1ID:r.asset1ID,asset1Out:BigInt(i)+A,asset2ID:r.asset2ID,asset2Out:BigInt(c)+h,poolTokenID:r.poolTokenID,poolTokenIn:BigInt(p),excessAmounts:[{assetID:r.asset1ID,excessAmountForBurning:A,totalExcessAmount:x.excessAsset1},{assetID:r.asset2ID,excessAmountForBurning:h,totalExcessAmount:x.excessAsset2}],txnID:I,groupID:it(a)});case 25:throw t.prev=25,t.t0=t.catch(1),"SlippageTolerance"===(T=new M(t.t0,"We encountered something unexpected while burning liquidity. Try again later.")).type&&T.setMessage("The burn failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),T;case 30:case"end":return t.stop()}}),t,null,[[1,25]])})))).apply(this,arguments)}!function(t){t[t.ASSET_TRANSFER_TXN=0]="ASSET_TRANSFER_TXN",t[t.APP_CALL_TXN=1]="APP_CALL_TXN"}(Bn||(Bn={}));var Xn,qn={generateTxns:function(t){return Vn.apply(this,arguments)},getQuote:function(t){var e=t.pool,n=t.reserves,r=t.poolTokenIn,a=BigInt(r),s=n.issuedLiquidity&&a*n.asset1/n.issuedLiquidity,o=n.issuedLiquidity&&a*n.asset2/n.issuedLiquidity;return{round:n.round,poolTokenID:e.poolTokenID,poolTokenIn:a,asset1ID:e.asset1ID,asset1Out:s,asset2ID:e.asset2ID,asset2Out:o}},signTxns:function(t){return Cn.apply(this,arguments)},execute:function(t){return jn.apply(this,arguments)}},Un=3n,Gn=1000n;function Wn(){return(Wn=c(u().mark((function t(e){var n,r,s,o,i,c,p,l;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.pool,r=e.txGroup,s=e.initiatorSigner,t.next=3,s([r]);case 3:return o=t.sent,i=w(o,2),c=i[0],p=i[1],l=r.map((function(t,e){return e===Xn.FEE_TXN_INDEX?c:e===Xn.ASSET_IN_TXN_INDEX?p:a.default.signLogicSigTransactionObject(t.txn,n.account.lsig).blob})),t.abrupt("return",l);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function zn(){return(zn=c(u().mark((function t(e){var n,r,s,o,i,c,p,l,d,f,m,g,I,x,A,h,T,y,v,w;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.client,r=e.quote,s=e.swapType,o=e.slippage,i=e.initiatorAddr,c=r.pool,p=r.quote,l=p.assetInID,d=p.assetOutID,f=c.account.address(),(m=[c.asset1ID,c.asset2ID]).includes(l)&&m.includes(d)&&l!==d){t.next=7;break}throw new M({pool:c,quote:r},"Input asset (#".concat(l,") and output asset (#").concat(d,") provided to generate transactions do not belong to the pool ").concat(f,"."));case 7:return t.next=9,n.getTransactionParams().do();case 9:return g=t.sent,I=[pt("swap"),s===exports.SwapType.FixedInput?pt("fi"):pt("fo")],x=a.default.makeApplicationNoOpTxnFromObject({from:f,appIndex:c.validatorAppID,appArgs:I,accounts:[i],note:ft.getAppCallTxnNoteWithClientName(N.V1_1),foreignAssets:0==c.asset2ID?[c.asset1ID,c.poolTokenID]:[c.asset1ID,c.asset2ID,c.poolTokenID],suggestedParams:g}),A=s===exports.SwapType.FixedOutput?tt("positive",o,p.assetInAmount):p.assetInAmount,h=0===l?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:i,to:f,amount:A,suggestedParams:g}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:i,to:f,assetIndex:l,amount:A,suggestedParams:g}),T=s===exports.SwapType.FixedInput?tt("negative",o,p.assetOutAmount):p.assetOutAmount,y=0===d?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:f,to:i,amount:T,suggestedParams:g}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:f,to:i,assetIndex:d,amount:T,suggestedParams:g}),v=a.default.makePaymentTxnWithSuggestedParamsFromObject({from:i,to:f,amount:x.fee+y.fee,note:O,suggestedParams:g}),w=a.default.assignGroupID([v,x,h,y]),t.abrupt("return",[{txn:w[0],signers:[i]},{txn:w[1],signers:[f]},{txn:w[2],signers:[i]},{txn:w[3],signers:[f]}]);case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Jn(t){var e=t.pool,n=t.reserves,r=t.assetIn,a=t.decimals;if(e.status!==exports.PoolStatus.READY)throw new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"Trying to swap on a non-existent pool");var s,u,i,c=BigInt(r.amount);if(r.id===e.asset1ID)s=e.asset2ID,u=n.asset1,i=n.asset2;else{if(r.id!==e.asset2ID)throw new D(exports.SwapQuoteErrorType.AssetDoesNotBelongToPoolError,"Input asset (#".concat(r.id,") doesn't belong to the pool ").concat(e.account.address(),"."));s=e.asset1ID,u=n.asset2,i=n.asset1}var p=c*Un/Gn,l=i-u*i/(u+(c-p));if(l>i)throw new D(exports.SwapQuoteErrorType.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");var d={assetIn:{amount:c,decimals:a.assetIn},assetOut:{amount:l,decimals:a.assetOut}},f={round:n.round,assetInID:r.id,assetInAmount:c,assetOutID:s,assetOutAmount:l,swapFee:Number(p),rate:Ut(d),priceImpact:Gt(o({inputSupply:u,outputSupply:i},d))};return{type:exports.SwapQuoteType.Direct,data:{pool:e,quote:f}}}function Yn(t){return Kn.apply(this,arguments)}function Kn(){return(Kn=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l,d,f,m,g,I,x,A;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,a=e.signedTxns,s=e.assetIn,o=e.assetOut,i=e.initiatorAddr,t.next=3,ce({client:n,pool:r,accountAddr:i});case 3:return c=t.sent,t.next=6,st(n,[a]);case 6:return p=t.sent,l=w(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,t.next=13,ce({client:n,pool:r,accountAddr:i});case 13:return g=t.sent,o.id===r.asset1ID?(I=c.excessAsset1,x=g.excessAsset1):(I=c.excessAsset2,x=g.excessAsset2),(A=x-I)<0n&&(A=0n),t.abrupt("return",{round:f,assetInID:s.id,assetInAmount:BigInt(s.amount),assetOutID:o.id,assetOutAmount:BigInt(o.amount)+A,excessAmount:{assetID:o.id,excessAmountForSwap:A,totalExcessAmount:x},txnID:m});case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Hn(t){var e=t.pool,n=t.reserves,r=t.assetOut,a=t.decimals;if(e.status!==exports.PoolStatus.READY)throw new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"Trying to swap on a non-existent pool");var s,o,u,i=BigInt(r.amount);if(r.id===e.asset1ID)s=e.asset2ID,o=n.asset2,u=n.asset1;else{if(r.id!==e.asset2ID)throw new D(exports.SwapQuoteErrorType.AssetDoesNotBelongToPoolError,"Output asset (#".concat(r.id,") doesn't belong to the pool ").concat(e.account.address(),"."));s=e.asset1ID,o=n.asset1,u=n.asset2}if(i>u)throw new D(exports.SwapQuoteErrorType.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");var c=o*u/(u-i)-o,p=c*Gn/(Gn-Un),l=p-c,d=et(a.assetOut,Number(i))/et(a.assetIn,Number(p)),f=et(a.assetOut,Number(u))/et(a.assetIn,Number(o)),m=nt({decimalPlaces:5},Math.abs(d/f-1)),g={round:n.round,assetInID:s,assetInAmount:p,assetOutID:r.id,assetOutAmount:i,swapFee:Number(l),rate:d,priceImpact:m};return{type:exports.SwapQuoteType.Direct,data:{pool:e,quote:g}}}function Zn(t){return $n.apply(this,arguments)}function $n(){return($n=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l,d,f,m,g,I,x,A;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,a=e.signedTxns,s=e.assetIn,o=e.assetOut,i=e.initiatorAddr,t.next=3,ce({client:n,pool:r,accountAddr:i});case 3:return c=t.sent,t.next=6,st(n,[a]);case 6:return p=t.sent,l=w(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,t.next=13,ce({client:n,pool:r,accountAddr:i});case 13:return g=t.sent,s.id===r.asset1ID?(I=c.excessAsset1,x=g.excessAsset1):(I=c.excessAsset2,x=g.excessAsset2),(A=x-I)<0n&&(A=0n),t.abrupt("return",{round:f,assetInID:s.id,assetInAmount:BigInt(s.amount)-A,assetOutID:o.id,assetOutAmount:BigInt(o.amount),excessAmount:{assetID:s.id,excessAmountForSwap:A,totalExcessAmount:x},txnID:m});case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function tr(){return(tr=c(u().mark((function t(e){var n,r,a,s,i,c,p,l,d,f;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.client,r=e.pool,a=e.swapType,s=e.txGroup,i=e.signedTxns,c=e.initiatorAddr,r.status===exports.PoolStatus.READY){t.next=3;break}throw new M({pool:r,swapType:a,txGroup:s},"Trying to swap on a non-existent pool");case 3:if(t.prev=3,p={id:s[Xn.ASSET_IN_TXN_INDEX].txn.assetIndex||0,amount:s[Xn.ASSET_IN_TXN_INDEX].txn.amount},l={id:s[Xn.ASSET_OUT_TXN_INDEX].txn.assetIndex||0,amount:s[Xn.ASSET_OUT_TXN_INDEX].txn.amount},a!==exports.SwapType.FixedInput){t.next=12;break}return t.next=9,Yn({client:n,pool:r,signedTxns:i,assetIn:p,assetOut:l,initiatorAddr:c});case 9:d=t.sent,t.next=15;break;case 12:return t.next=14,Zn({client:n,pool:r,signedTxns:i,assetIn:p,assetOut:l,initiatorAddr:c});case 14:d=t.sent;case 15:return t.abrupt("return",o(o({},d),{},{groupID:it(s),fees:ut(s)}));case 18:throw t.prev=18,t.t0=t.catch(3),"SlippageTolerance"===(f=new M(t.t0,"We encountered something unexpected while swapping. Try again later.")).type&&f.setMessage("The swap failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),f;case 23:case"end":return t.stop()}}),t,null,[[3,18]])})))).apply(this,arguments)}!function(t){t[t.FEE_TXN_INDEX=0]="FEE_TXN_INDEX",t[t.VALIDATOR_APP_CALL_TXN_INDEX=1]="VALIDATOR_APP_CALL_TXN_INDEX",t[t.ASSET_IN_TXN_INDEX=2]="ASSET_IN_TXN_INDEX",t[t.ASSET_OUT_TXN_INDEX=3]="ASSET_OUT_TXN_INDEX"}(Xn||(Xn={}));var er={getQuote:function(t,e,n,r,a){return t===exports.SwapType.FixedInput?Jn({pool:e,reserves:n,assetIn:r,decimals:a}):Hn({pool:e,reserves:n,assetOut:r,decimals:a})},getFixedInputSwapQuote:Jn,getFixedOutputSwapQuote:Hn,generateTxns:function(t){return zn.apply(this,arguments)},signTxns:function(t){return Wn.apply(this,arguments)},execute:function(t){return tr.apply(this,arguments)},executeFixedOutputSwap:Zn},nr=4*t.ALGORAND_MIN_TX_FEE;function rr(e){return(_t[e]+2)*t.ALGORAND_MIN_TX_FEE}function ar(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.003;return Math.ceil(1/t)}function sr(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.003;return t<ar(e)}function or(t){return t instanceof D&&[exports.SwapQuoteErrorType.SwapRouterInsufficientReservesError,exports.SwapQuoteErrorType.SwapRouterLowSwapAmountError,exports.SwapQuoteErrorType.OutputAmountExceedsAvailableLiquidityError,exports.SwapQuoteErrorType.LowSwapAmountError].includes(t.type)}function ur(t){return Promise.allSettled(t).then((function(t){if(t.every((function(t){return"rejected"===t.status}))){var e=w(t.map((function(t){return t.reason})),2),n=e[0],r=e[1];if(or(n)&&!or(r))throw n;throw r}return t.filter((function(t){return"fulfilled"===t.status&&void 0!==t.value})).map((function(t){return t.value}))}))}function ir(){return(ir=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l,d,f;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.amount,a=e.assetIn,s=e.assetOut,o=e.isSwapRouterEnabled,i=e.pools,c=[],(p=i.find((function(t){return t.info.contractVersion===N.V1_1})))?(l={pool:p.info,assetIn:{amount:r,id:Number(a.id)},decimals:{assetIn:a.decimals,assetOut:s.decimals},reserves:p.reserves},c.push(new Promise((function(t,e){try{t(er.getFixedInputSwapQuote(l))}catch(t){e(t)}})))):c.push(Promise.reject(new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"Trying to swap from non-existent pool"))),d=i.find((function(t){return t.info.contractVersion===N.V2})),c.push(_r.getFixedInputSwapQuote({amount:r,assetInID:X(a),assetOutID:X(s),pool:null!==(n=null==d?void 0:d.info)&&void 0!==n?n:null,decimals:{assetIn:a.decimals,assetOut:s.decimals},isSwapRouterEnabled:o,network:e.network})),t.next=8,ur(c);case 8:return f=t.sent,t.abrupt("return",lr(f));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function cr(){return(cr=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l,d,f;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.amount,a=e.assetIn,s=e.assetOut,o=e.pools,i=e.isSwapRouterEnabled,c=[],(p=o.find((function(t){return t.info.contractVersion===N.V1_1})))?(l={pool:p.info,assetOut:{amount:r,id:Number(s.id)},decimals:{assetIn:a.decimals,assetOut:s.decimals},reserves:p.reserves},c.push(new Promise((function(t,e){try{t(er.getFixedOutputSwapQuote(l))}catch(t){e(t)}})))):c.push(Promise.reject(new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"Trying to swap from non-existent pool"))),d=o.find((function(t){return t.info.contractVersion===N.V2})),c.push(_r.getFixedOutputSwapQuote({amount:r,assetInID:X(a),assetOutID:X(s),pool:null!==(n=null==d?void 0:d.info)&&void 0!==n?n:null,decimals:{assetIn:a.decimals,assetOut:s.decimals},isSwapRouterEnabled:i,network:e.network})),t.next=8,ur(c);case 8:return f=t.sent,t.abrupt("return",lr(f));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function pr(t){return t.type===exports.SwapQuoteType.Direct?t.data.quote.rate:Pt(t.data.route)}function lr(t){for(var e=t[0],n=pr(e),r=1;r<t.length;r++){var a=t[r],s=pr(a);s>n&&(e=a,n=s)}return e}function dr(){return(dr=c(u().mark((function t(e){var n,r,s,i,c,p,l,d,f,m,g,I,x,A,h,T,y,v,w,_;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.quote.type!==exports.SwapQuoteType.Router){t.next=2;break}return t.abrupt("return",Qt(o(o({},e),{},{route:e.quote.data.route})));case 2:if(n=e.client,r=e.initiatorAddr,s=e.slippage,i=e.swapType,c=e.quote,p=c.data,l=p.pool,d=p.quote,f=d.assetInID,m=d.assetOutID,g=l.account.address(),(I=[l.asset1ID,l.asset2ID]).includes(f)&&I.includes(m)&&f!==m){t.next=9;break}throw new M({pool:l,quote:c},"Input asset (#".concat(f,") and output asset (#").concat(m,") provided to generate transactions do not belong to the pool ").concat(g,"."));case 9:return t.next=11,n.getTransactionParams().do();case 11:return x=t.sent,A=j(f),h=i===exports.SwapType.FixedInput?d.assetInAmount:tt("positive",s,d.assetInAmount),T=i===exports.SwapType.FixedOutput?d.assetOutAmount:tt("negative",s,d.assetOutAmount),y=A?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:r,to:g,amount:h,suggestedParams:x}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:r,to:g,amount:h,assetIndex:f,suggestedParams:x}),(v=a.default.makeApplicationNoOpTxnFromObject({from:r,appIndex:l.validatorAppID,appArgs:[St,Et[i],a.default.encodeUint64(T)],note:ft.getAppCallTxnNoteWithClientName(N.V2),accounts:[g],foreignAssets:[l.asset1ID,l.asset2ID],suggestedParams:x})).fee=fr(i),(w=[])[yt.INPUT_TXN]=y,w[yt.APP_CALL_TXN]=v,_=a.default.assignGroupID(w),t.abrupt("return",[{txn:_[yt.INPUT_TXN],signers:[r]},{txn:_[yt.APP_CALL_TXN],signers:[r]}]);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function fr(e){return(_t[e]+1)*t.ALGORAND_MIN_TX_FEE}function mr(){return(mr=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l,d,f,m,g,I,x,A,h;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.client,o=e.quote,i=e.txGroup,c=e.signedTxns,t.next=3,st(s,[c]);case 3:return p=t.sent,l=w(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,g=zt(o).id,t.prev=9,t.next=12,We(s,i);case 12:I=t.sent,t.next=17;break;case 15:t.prev=15,t.t0=t.catch(9);case 17:return x=Wt(o),A=null===(n=I)||void 0===n||null===(r=n.find((function(t){return t.id===x.id})))||void 0===r?void 0:r.amount,h=null===(a=I)||void 0===a?void 0:a.find((function(t){return t.id===g})),t.abrupt("return",{round:f,assetIn:{amount:BigInt(x.amount)-BigInt(A||0),id:x.id},assetOut:h,quote:o,txnID:m});case 21:case"end":return t.stop()}}),t,null,[[9,15]])})))).apply(this,arguments)}function gr(){return(gr=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.type,r=e.amount,a=e.assetInID,s=e.assetOutID,o=e.decimals,i=e.network,c=e.isSwapRouterEnabled,p=e.pool,n!==exports.SwapType.FixedInput){t.next=7;break}return t.next=4,hr({assetInID:a,assetOutID:s,amount:r,decimals:o,isSwapRouterEnabled:c,network:i,pool:p});case 4:l=t.sent,t.next=10;break;case 7:return t.next=9,yr({amount:r,assetInID:a,assetOutID:s,decimals:o,isSwapRouterEnabled:c,network:i,pool:p});case 9:l=t.sent;case 10:return t.abrupt("return",l);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ir(t){return Promise.allSettled(t).then((function(t){if(t.every((function(t){return"rejected"===t.status}))){var e=t[0].reason;if(2===t.length){var n=t[1].reason;if(or(e)&&!or(n))throw e;throw n}throw e}return t.filter((function(t){return"fulfilled"===t.status&&void 0!==t.value})).map((function(t){return t.value}))}))}function xr(t){var e=t.amount,n=t.assetInID,r=t.assetOutID,a=t.decimals,s=t.pool;if(!Oe.isPoolReady(s))throw new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"There is not an available pool for this swap. However, you can enable swap router and try to perform this swap with multiple pools.");var o,u,i=BigInt(e),c=s.totalFeeShare;if(n===s.asset1ID)o=s.asset1Reserves,u=s.asset2Reserves;else{if(n!==s.asset2ID)throw new D(exports.SwapQuoteErrorType.AssetDoesNotBelongToPoolError,"Input asset (#".concat(n,") doesn't belong to the pool ").concat(s.account.address(),"."));o=s.asset2Reserves,u=s.asset1Reserves}var p=wr({inputSupply:o,outputSupply:u,swapInputAmount:i,totalFeeShare:c,decimals:a}),l=p.swapOutputAmount,d=p.totalFeeAmount,f=p.priceImpact;if(l>u)throw new D(exports.SwapQuoteErrorType.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");if(sr(Number(e)))throw new D(exports.SwapQuoteErrorType.LowSwapAmountError,"Swap amount is too low.");return{assetInID:n,assetInAmount:i,assetOutID:r,assetOutAmount:l,swapFee:Number(d),rate:et(a.assetOut,Number(l))/et(a.assetIn,Number(i)),priceImpact:f}}function Ar(t){var e=t.amount,n=t.assetInID,r=t.assetOutID,a=t.decimals,s=t.pool;if(!s||!Oe.isPoolReady(s))throw new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"There is not an available pool for this swap. However, you can enable swap router and try to perform this swap with multiple pools.");var o,u,i=BigInt(e),c=s.totalFeeShare;if(r===s.asset1ID)o=s.asset2Reserves,u=s.asset1Reserves;else{if(r!==s.asset2ID)throw new D(exports.SwapQuoteErrorType.AssetDoesNotBelongToPoolError,"Output asset (#".concat(r,") doesn't belong to the pool ").concat(s.account.address(),"."));o=s.asset1Reserves,u=s.asset2Reserves}var p=function(t){var e=t.inputSupply,n=t.outputSupply,r=t.swapOutputAmount,a=t.totalFeeShare,s=t.decimals,o=function(t){var e=t.inputSupply,n=t.outputSupply,r=t.outputAmount,a=BigInt(e*n/(n-r))-e;return a+=BigInt(1)}({inputSupply:e,outputSupply:n,outputAmount:r}),u=function(t){var e=t.swapAmount,n=t.totalFeeShare,r=Math.floor(Number(e*BigInt(1e4)/(BigInt(1e4)-BigInt(n))));return BigInt(r)-e}({swapAmount:o,totalFeeShare:a}),i=o+u,c=Gt({inputSupply:e,outputSupply:n,assetIn:{amount:i,decimals:s.assetIn},assetOut:{amount:r,decimals:s.assetOut}});return{swapInputAmount:i,totalFeeAmount:u,priceImpact:c}}({inputSupply:o,outputSupply:u,swapOutputAmount:i,totalFeeShare:c,decimals:a}),l=p.swapInputAmount,d=p.totalFeeAmount,f=p.priceImpact;if(i>u)throw new D(exports.SwapQuoteErrorType.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");if(sr(Number(l)))throw new D(exports.SwapQuoteErrorType.LowSwapAmountError,"Swap amount is too low.");return{type:exports.SwapQuoteType.Direct,data:{pool:s,quote:{assetInID:n,assetInAmount:l,assetOutID:r,assetOutAmount:i,swapFee:Number(d),rate:et(a.assetOut,Number(i))/et(a.assetIn,Number(l)),priceImpact:f}}}}function hr(t){return Tr.apply(this,arguments)}function Tr(){return(Tr=c(u().mark((function t(e){var n,r,a,s,o,i,p,l,d;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.amount,r=e.assetInID,a=e.assetOutID,s=e.decimals,o=e.isSwapRouterEnabled,i=e.network,p=e.pool,l=[],p?l.push(new Promise((function(t,e){try{var o=xr({amount:n,assetInID:r,assetOutID:a,decimals:s,pool:p});t({type:exports.SwapQuoteType.Direct,data:{pool:p,quote:o}})}catch(t){e(t)}}))):l.push(Promise.reject(new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"There is not an available pool for this swap. However, you can enable swap router and try to perform this swap with multiple pools."))),o&&l.push(c(u().mark((function t(){var e;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Xt({amount:n,assetInID:r,assetOutID:a,swapType:exports.SwapType.FixedInput,network:i});case 2:if(!((e=t.sent).route.length<2)){t.next=5;break}throw new D(exports.SwapQuoteErrorType.SwapRouterNoRouteError,"Swap router couldn't find a route for this swap.");case 5:return t.abrupt("return",{type:exports.SwapQuoteType.Router,data:e});case 6:case"end":return t.stop()}}),t)})))()),t.next=6,Ir(l);case 6:return d=t.sent,t.abrupt("return",lr(d));case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function yr(t){return vr.apply(this,arguments)}function vr(){return(vr=c(u().mark((function t(e){var n,r,a,s,o,i,p,l,d;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.amount,r=e.assetInID,a=e.assetOutID,s=e.decimals,o=e.isSwapRouterEnabled,i=e.network,p=e.pool,l=[new Promise((function(t,e){try{t(Ar({amount:n,assetInID:r,assetOutID:a,decimals:s,pool:p}))}catch(t){e(t)}}))],o&&l.push(c(u().mark((function t(){var e;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Xt({amount:n,assetInID:r,assetOutID:a,swapType:exports.SwapType.FixedOutput,network:i});case 2:return e=t.sent,t.abrupt("return",{type:exports.SwapQuoteType.Router,data:e});case 4:case"end":return t.stop()}}),t)})))()),t.next=5,Ir(l);case 5:return d=t.sent,t.abrupt("return",lr(d));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function wr(t){var e=t.inputSupply,n=t.outputSupply,r=t.swapInputAmount,a=t.totalFeeShare,s=t.decimals,o=BigInt(function(t){var e=t.inputAmount,n=t.totalFeeShare;return Math.floor(Number(e*BigInt(n))/1e4)}({inputAmount:r,totalFeeShare:a})),u=function(t){var e=t.inputSupply,n=t.outputSupply,r=t.swapAmount,a=n-BigInt(e*n/(e+BigInt(r)));return a-=BigInt(1)}({inputSupply:e,outputSupply:n,swapAmount:r-o});return{swapOutputAmount:u,totalFeeAmount:o,priceImpact:Gt({inputSupply:e,outputSupply:n,assetIn:{amount:r,decimals:s.assetIn},assetOut:{amount:u,decimals:s.assetOut}})}}var _r={getQuote:function(t){return gr.apply(this,arguments)},getFixedInputSwapQuote:hr,getFixedInputDirectSwapQuote:xr,getFixedOutputDirectSwapQuote:Ar,getFixedOutputSwapQuote:yr,generateTxns:function(t){return dr.apply(this,arguments)},signTxns:function(t){var e=t.txGroup;return(0,t.initiatorSigner)([e])},execute:function(t){return mr.apply(this,arguments)},calculateFixedInputSwap:wr};function Sr(t,e){var n,r,a=BigInt(t),s=e.issuedLiquidity;return s>a+BigInt(1e3)?(n=a*e.asset1/s,r=a*e.asset2/s):(n=e.asset1,r=e.asset2),{asset1OutputAmount:n,asset2OutputAmount:r}}function Er(){return(Er=c(u().mark((function e(n){var r,s,o,i,c,p,l,d,f,m,g,I,x,A;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.pool,o=n.poolTokenIn,i=n.initiatorAddr,c=n.minAsset1Amount,p=n.minAsset2Amount,l=n.slippage,e.next=3,r.getTransactionParams().do();case 3:if(d=e.sent,f=s.account.address(),m=s.poolTokenID){e.next=8;break}throw new Error("Pool token asset ID is missing");case 8:return g=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:i,to:f,assetIndex:m,amount:o,suggestedParams:d}),(I=a.default.makeApplicationNoOpTxnFromObject({from:i,appIndex:s.validatorAppID,note:ft.getAppCallTxnNoteWithClientName(N.V2),appArgs:[Qn,a.default.encodeUint64(tt("negative",l,c)),a.default.encodeUint64(tt("negative",l,p))],accounts:[f],foreignAssets:[s.asset1ID,s.asset2ID],suggestedParams:d})).fee=3*t.ALGORAND_MIN_TX_FEE,(x=[])[Bn.ASSET_TRANSFER_TXN]=g,x[Bn.APP_CALL_TXN]=I,A=a.default.assignGroupID(x),e.abrupt("return",[{txn:A[Bn.ASSET_TRANSFER_TXN],signers:[i]},{txn:A[Bn.APP_CALL_TXN],signers:[i]}]);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function br(){return(br=c(u().mark((function e(n){var r,s,o,i,c,p,l,d,f,m,g,I,x,A,h,T,y,v,w;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.pool,o=n.initiatorAddr,i=n.poolTokenIn,c=n.outputAssetId,p=n.minOutputAssetAmount,l=n.slippage,e.next=3,r.getTransactionParams().do();case 3:if(d=e.sent,f=s.asset1ID,m=s.asset2ID,g=s.account.address(),I=s.poolTokenID){e.next=9;break}throw new Error("Pool token asset ID is missing");case 9:if(x=0,A=0,h=tt("negative",l,p),c!==f){e.next=17;break}x=h,A=0,e.next=23;break;case 17:if(c!==m){e.next=22;break}x=0,A=h,e.next=23;break;case 22:throw new Error("Invalid output asset id. It doesn't match with pool assets");case 23:return T=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:o,to:g,assetIndex:I,amount:i,suggestedParams:d}),(y=a.default.makeApplicationNoOpTxnFromObject({from:o,appIndex:s.validatorAppID,note:ft.getAppCallTxnNoteWithClientName(N.V2),appArgs:[Qn,a.default.encodeUint64(x),a.default.encodeUint64(A)],accounts:[g],foreignAssets:[c],suggestedParams:d})).fee=3*t.ALGORAND_MIN_TX_FEE,(v=[])[Bn.ASSET_TRANSFER_TXN]=T,v[Bn.APP_CALL_TXN]=y,w=a.default.assignGroupID(v),e.abrupt("return",[{txn:w[Bn.ASSET_TRANSFER_TXN],signers:[o]},{txn:w[Bn.APP_CALL_TXN],signers:[o]}]);case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dr(){return(Dr=c(u().mark((function t(e){var n,r,a,s,o,i,c;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.txGroup,a=e.signedTxns,t.next=3,st(n,[a]);case 3:return s=t.sent,o=w(s,1),i=o[0].txnID,t.prev=6,t.next=9,We(n,r);case 9:c=t.sent,t.next=14;break;case 12:t.prev=12,t.t0=t.catch(6);case 14:return t.abrupt("return",{outputAssets:c,txnID:i});case 15:case"end":return t.stop()}}),t,null,[[6,12]])})))).apply(this,arguments)}var Or,Nr,Pr={getQuote:function(t){var e=t.pool,n=t.reserves,r=t.poolTokenIn,a=BigInt(r),s=Sr(a,n),o=s.asset1OutputAmount,u=s.asset2OutputAmount;return{round:n.round,asset1Out:{assetId:e.asset1ID,amount:o},asset2Out:{assetId:e.asset2ID,amount:u},poolTokenIn:{assetId:e.poolTokenID,amount:a}}},getSingleAssetRemoveLiquidityQuote:function(t){var e,n=t.pool,r=t.reserves,a=t.poolTokenIn,s=t.assetOutID,o=t.decimals,u=BigInt(a),i=Sr(u,r),c=i.asset1OutputAmount,p=i.asset2OutputAmount,l=n.totalFeeShare;if(s===n.asset1ID){var d=_r.calculateFixedInputSwap({inputSupply:r.asset2-p,outputSupply:r.asset1-c,swapInputAmount:p,totalFeeShare:l,decimals:o}),f=d.swapOutputAmount,m=d.totalFeeAmount,g=d.priceImpact;e={round:r.round,assetOut:{assetId:s,amount:c+f},poolTokenIn:{assetId:n.poolTokenID,amount:u},internalSwapQuote:{amountIn:{assetId:n.asset2ID,amount:p},amountOut:{assetId:n.asset1ID,amount:f},swapFees:{assetId:n.asset2ID,amount:m},priceImpact:g}}}else{if(s!==n.asset2ID)throw new Error("assetOutID must be one of the pool assets");var I=_r.calculateFixedInputSwap({inputSupply:r.asset1-c,outputSupply:r.asset2-p,swapInputAmount:c,totalFeeShare:l,decimals:o}),x=I.swapOutputAmount,A=I.totalFeeAmount,h=I.priceImpact;e={round:r.round,assetOut:{assetId:s,amount:p+x},poolTokenIn:{assetId:n.poolTokenID,amount:u},internalSwapQuote:{amountIn:{assetId:n.asset2ID,amount:p},amountOut:{assetId:n.asset1ID,amount:x},swapFees:{assetId:n.asset2ID,amount:A},priceImpact:h}}}return e},generateTxns:function(t){return Er.apply(this,arguments)},generateSingleAssetOutTxns:function(t){return br.apply(this,arguments)},signTxns:function(t){var e=t.txGroup;return(0,t.initiatorSigner)([e])},execute:function(t){return Dr.apply(this,arguments)}},kr=(f(Or={},N.V1_1,qn),f(Or,N.V2,Pr),Or),Lr=(f(Nr={},N.V1_1,er),f(Nr,N.V2,_r),f(Nr,"getQuote",(function(t){var e=t.type,n=t.pools;if(!t.isSwapRouterEnabled&&n.every((function(t){return Se(t.reserves)})))throw new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"There is not an available pool for this swap. However, you can enable swap router and try to perform this swap with multiple pools.");if(e===exports.SwapType.FixedInput)return function(t){return ir.apply(this,arguments)}(t);if(e===exports.SwapType.FixedOutput)return function(t){return cr.apply(this,arguments)}(t);throw new D(exports.SwapQuoteErrorType.InvalidSwapTypeError,"Invalid swap type")})),f(Nr,"generateTxns",(function(t){return t.quote.type===exports.SwapQuoteType.Direct&&Jt(t.quote)===N.V1_1?er.generateTxns(o(o({},t),{},{quote:t.quote.data})):_r.generateTxns(t)})),f(Nr,"signTxns",(function(t){if(t.quote.type===exports.SwapQuoteType.Direct&&Jt(t.quote)===N.V1_1){var e=t.quote.data.pool;return er.signTxns(o({pool:e},t))}return _r.signTxns(t)})),f(Nr,"execute",(function(t){return t.contractVersion===N.V1_1?er.execute(t):_r.execute(t)})),Nr);function Rr(){return(Rr=c(u().mark((function t(e){var n,r,a,s,o,i,c,p,l,d;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,a=e.txGroup,s=e.initiatorSigner,t.prev=1,t.next=4,Fr({txGroup:a,pool:r,initiatorSigner:s});case 4:return o=t.sent,t.next=7,st(n,[o]);case 7:return i=t.sent,c=w(i,1),p=c[0],l=p.txnID,d=p.confirmedRound,t.abrupt("return",{fees:ut(a),confirmedRound:d,txnID:l,groupID:it(a)});case 15:throw t.prev=15,t.t0=t.catch(1),new M(t.t0,"We encountered something unexpected while redeeming. Try again later.");case 18:case"end":return t.stop()}}),t,null,[[1,15]])})))).apply(this,arguments)}function Fr(t){return Br.apply(this,arguments)}function Br(){return(Br=c(u().mark((function t(e){var n,r,s,o,i,c,p,l;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.txGroup,r=e.pool,s=e.initiatorSigner,t.next=3,s([n]);case 3:return o=t.sent,i=w(o,1),c=i[0],p=r.account.lsig,l=n.map((function(t,e){return 0===e?c:a.default.signLogicSigTransactionObject(t.txn,p).blob})),t.abrupt("return",l);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Mr(){return Mr=c(u().mark((function t(e){var n,r,s,o,i,p;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.data,s=e.initiatorSigner,t.prev=1,o=r.map((function(t){var e=t.txGroup,n=t.pool;return{txns:e,txnFees:ut(e),groupID:it(e),lsig:n.account.lsig}})),t.next=5,s(o.map((function(t){return t.txns})));case 5:return i=t.sent,p=Promise.all(o.map((function(t,e){return new Promise(function(){var r=c(u().mark((function r(s,o){var c,p,l,d,f,m;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,c=t.txns.map((function(n,r){return 0===r?i[e]:a.default.signLogicSigTransactionObject(n.txn,t.lsig).blob})),r.next=4,st(n,[c]);case 4:p=r.sent,l=w(p,1),d=l[0],f=d.txnID,m=d.confirmedRound,s({fees:t.txnFees,groupID:t.groupID,txnID:f,confirmedRound:m}),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(0),o(r.t0);case 15:case"end":return r.stop()}}),r,null,[[0,12]])})));return function(t,e){return r.apply(this,arguments)}}())}))),t.abrupt("return",p);case 10:throw t.prev=10,t.t0=t.catch(1),new M(t.t0,"We encountered something unexpected while redeeming. Try again later.");case 13:case"end":return t.stop()}}),t,null,[[1,10]])}))),Mr.apply(this,arguments)}function Qr(){return(Qr=c(u().mark((function t(e){var n,r,s,o,i,c,p,l,d,f,m;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,s=e.assetID,o=e.assetOut,i=e.initiatorAddr,t.next=3,n.getTransactionParams().do();case 3:return c=t.sent,p=r.account.address(),l=a.default.makeApplicationNoOpTxnFromObject({from:p,appIndex:r.validatorAppID,appArgs:[pt("redeem")],note:ft.getAppCallTxnNoteWithClientName(r.contractVersion),accounts:[i],foreignAssets:0==r.asset2ID?[r.asset1ID,r.poolTokenID]:[r.asset1ID,r.asset2ID,r.poolTokenID],suggestedParams:c}),d=0===s?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:p,to:i,amount:BigInt(o),suggestedParams:c}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:i,assetIndex:s,amount:BigInt(o),suggestedParams:c}),f=a.default.makePaymentTxnWithSuggestedParamsFromObject({from:i,to:p,amount:l.fee+d.fee,note:O,suggestedParams:c}),m=a.default.assignGroupID([f,l,d]),t.abrupt("return",[{txn:m[0],signers:[i]},{txn:m[1],signers:[p]},{txn:m[2],signers:[p]}]);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Vr(e){var n=e.suggestedParams,r=e.stakingAppID,a=e.initiatorAddr,s=e.liquidityAssetID,o=e.program,u=e.amount,i=t.encodeUint64(u),c=t.encodeUint64(o.id);return t.makeApplicationNoOpTxnFromObject({appIndex:r,from:a,suggestedParams:n,foreignAssets:[s],accounts:[o.accountAddress],appArgs:[pt("commit"),i],note:U([pt("tinymanStaking/v1:b"),c,t.encodeUint64(s),i])})}function Cr(){return(Cr=c(u().mark((function e(n){var r,a,s,o,i,c,p,l,d,f,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,a=n.stakingAppID,s=n.program,o=n.requiredAssetID,i=n.liquidityAssetID,c=n.amount,p=n.initiatorAddr,e.next=3,r.getTransactionParams().do();case 3:if(l=e.sent,d=Vr({suggestedParams:l,stakingAppID:a,program:s,liquidityAssetID:i,initiatorAddr:p,amount:c}),f=[d],"number"!=typeof o){e.next=10;break}return m=t.makeApplicationNoOpTxnFromObject({appIndex:a,from:p,suggestedParams:l,foreignAssets:[o],accounts:[s.accountAddress],appArgs:[pt("log_balance")]}),f=t.assignGroupID([d,m]),e.abrupt("return",[{txn:f[0],signers:[p]},{txn:f[1],signers:[p]}]);case 10:return e.abrupt("return",[{txn:f[0],signers:[p]}]);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}exports.ALGO_ASSET=P,exports.ALGO_ASSET_ID=0,exports.ASSET_OPT_IN_PROCESS_TXN_COUNT=1,exports.AddLiquidity=Fn,exports.BASE_MINIMUM_BALANCE=1e5,exports.Bootstrap=nn,exports.CONTRACT_VERSION=N,exports.MINIMUM_ADD_LIQUIDITY_AMOUNT=1e3,exports.MINIMUM_BALANCE_REQUIRED_PER_APP=1e5,exports.MINIMUM_BALANCE_REQUIRED_PER_ASSET=1e5,exports.MINIMUM_BALANCE_REQUIRED_PER_BYTE_SCHEMA=5e4,exports.MINIMUM_BALANCE_REQUIRED_PER_INT_SCHEMA_VALUE=28500,exports.OPT_IN_VALIDATOR_APP_PROCESS_TXN_COUNT=1,exports.OPT_OUT_VALIDATOR_APP_PROCESS_TXN_COUNT=1,exports.POOL_TOKEN_UNIT_NAME=k,exports.REDEEM_PROCESS_TXN_COUNT=3,exports.RemoveLiquidity=kr,exports.Swap=Lr,exports.SwapQuoteError=D,exports.V1_1_ADD_LIQUIDITY_PROCESS_TXN_COUNT=5,exports.V1_1_REMOVE_LIQUIDITY_TXN_COUNT=Mn,exports.V2AddLiquidityTxnIndices=pn,exports.V2_REMOVE_LIQUIDITY_APP_CALL_INNER_TXN_COUNT=2,exports.applySlippageToAmount=tt,exports.calculateAccountMinimumRequiredBalance=se,exports.calculatePriceImpact=Gt,exports.calculateSwapRate=Ut,exports.combineAndRegroupSignerTxns=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=n.flat(),s=a.map((function(e){var n=e.txn;return n.group=void 0,t.decodeUnsignedTransaction(t.encodeUnsignedTransaction(n))})),u=t.assignGroupID(s);return a.map((function(t,e){return o(o({},t),{},{txn:u[e]})}))},exports.convertFromBaseUnits=et,exports.convertToBaseUnits=function(t,e){return nt({decimalPlaces:0},Math.pow(10,Number(t))*Number(e))},exports.generateOptIntoAssetTxns=function(t){return Q.apply(this,arguments)},exports.generateOptIntoValidatorTxns=function(t){return It.apply(this,arguments)},exports.generateOptOutOfValidatorTxns=function(t){return At.apply(this,arguments)},exports.generateRedeemTxns=function(t){return Qr.apply(this,arguments)},exports.generateSwapRouterAssetOptInTransaction=Bt,exports.generateSwapRouterTxns=Qt,exports.getAccountExcess=function(t){return le.apply(this,arguments)},exports.getAccountExcessWithinPool=ce,exports.getAccountInformation=re,exports.getAddLiquidityTotalFee=function(e){switch(e.version){case N.V1_1:return un;case N.V2:return n=e.type,(ln[n]+dn[n])*t.ALGORAND_MIN_TX_FEE;default:throw new Error("Provided contract version was not valid.")}var n},exports.getAssetInAndAssetOutFromSwapQuote=function(t){return{assetIn:Wt(t),assetOut:zt(t)}},exports.getAssetInAndOutFromSwapRoute=Ft,exports.getAssetInFromSwapQuote=Wt,exports.getAssetInFromSwapRoute=Rt,exports.getAssetOutFromSwapQuote=zt,exports.getAssetOutFromSwapRoute=Lt,exports.getMinRequiredBalanceToOptIn=function(t){var e,n=t.currentMinumumBalanceForAccount,r=t.suggestedTransactionFee;if("app-opt-in"===t.type){var a=ne(t.contractVersion);e=1e5+5e4*a.schema.numLocalByteSlices+28500*a.schema.numLocalInts}else e=1e5;return e+(n||0)+(r||0)},exports.getStakingAppID=function(t){return"testnet"===t?51948952:649588853},exports.getSwapQuoteContractVersion=Jt,exports.getSwapQuotePriceImpact=function(t){return t.type===exports.SwapQuoteType.Router?Number(t.data.price_impact):t.data.quote.priceImpact},exports.getSwapRoute=Xt,exports.getSwapRouteRate=Pt,exports.getSwapRouterAppID=kt,exports.getSwapRouterAppOptInRequiredAssetIDs=Ct,exports.getSwapTotalFee=function(t){switch(t.version){case N.V1_1:return nr;case N.V2:return rr(t.type);default:throw new Error("Provided contract version was not valid.")}},exports.getTxnGroupID=it,exports.getV2MinSwapAssetInAmount=ar,exports.getV2SwapTotalFee=rr,exports.getValidatorAppID=gt,exports.hasSufficientMinimumBalance=function(t){return t.amount>=t.minimum_required_balance},exports.isAccountOptedIntoApp=function(t){var e=t.appID;return t.accountAppsLocalState.some((function(t){return t.id===e}))},exports.isSwapAssetInAmountLow=sr,exports.poolUtils=Oe,exports.prepareCommitTransactions=function(t){return Cr.apply(this,arguments)},exports.redeemAllExcessAsset=function(t){return Mr.apply(this,arguments)},exports.redeemExcessAsset=function(t){return Rr.apply(this,arguments)},exports.sendAndWaitRawTransaction=st,exports.sumUpTxnFees=ut,exports.tinymanContract_v1_1=Zt,exports.tinymanContract_v2=ee,exports.tinymanJSSDKConfig=ft;
=======
u=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function i(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{i({},"")}catch(t){i=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,o=Object.create(a.prototype),s=new _(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return E()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var u=y(s,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var i=p(t,e,n);if("normal"===i.type){if(r=n.done?"completed":"suspendedYield",i.arg===l)continue;return{value:i.arg,done:n.done}}"throw"===i.type&&(r="completed",n.method="throw",n.arg=i.arg)}}}(t,n,s),o}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function d(){}function f(){}function m(){}var g={};i(g,a,(function(){return this}));var x=Object.getPrototypeOf,A=x&&x(x(S([])));A&&A!==e&&n.call(A,a)&&(g=A);var I=m.prototype=d.prototype=Object.create(g);function h(t){["next","throw","return"].forEach((function(e){i(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(a,o,s,u){var i=p(t[a],t,o);if("throw"!==i.type){var c=i.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,s,u)}),(function(t){r("throw",t,s,u)})):e.resolve(l).then((function(t){c.value=t,s(c)}),(function(t){return r("throw",t,s,u)}))}u(i.arg)}var a;this._invoke=function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}}function y(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,y(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=p(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function v(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function w(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(v,this),this.reset(!0)}function S(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return f.prototype=m,i(I,"constructor",m),i(m,"constructor",f),f.displayName=i(m,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,i(t,s,"GeneratorFunction")),t.prototype=Object.create(I),t},t.awrap=function(t){return{__await:t}},h(T.prototype),i(T.prototype,o,(function(){return this})),t.AsyncIterator=T,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var s=new T(c(e,n,r,a),o);return t.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},h(I),i(I,s,"Generator"),i(I,a,(function(){return this})),i(I,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=S,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return s.type="throw",s.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),i=n.call(o,"finallyLoc");if(u&&i){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!i)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),w(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;w(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function i(t,e,n,r,a,o,s){try{var u=t[o](s),i=u.value}catch(t){return void n(t)}u.done?e(i):Promise.resolve(i).then(r,a)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function s(t){i(o,r,a,s,u,"next",t)}function u(t){i(o,r,a,s,u,"throw",t)}s(void 0)}))}}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function m(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&x(t,e)}function g(t){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},g(t)}function x(t,e){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},x(t,e)}function A(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function I(t,e,n){return I=A()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&x(a,n.prototype),a},I.apply(null,arguments)}function h(t){var e="function"==typeof Map?new Map:void 0;return h=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return I(t,arguments,g(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),x(r,t)},h(t)}function T(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return T(t)}function v(t){var e=A();return function(){var n,r=g(t);if(e){var a=g(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return y(this,n)}}function w(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,a,o=[],s=!0,u=!1;try{for(n=n.call(t);!(s=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);s=!0);}catch(t){u=!0,a=t}finally{try{s||null==n.return||n.return()}finally{if(u)throw a}}return o}(t,e)||S(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t){return function(t){if(Array.isArray(t))return E(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||S(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){if(t){if("string"==typeof t)return E(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(t,e):void 0}}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function b(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=S(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}exports.SwapQuoteErrorType=void 0,(r=exports.SwapQuoteErrorType||(exports.SwapQuoteErrorType={})).SwapRouterStaleDataError="SwapRouterStaleDataError",r.SwapRouterNoRouteError="SwapRouterNoRouteError",r.SwapRouterLowSwapAmountError="SwapRouterLowSwapAmountError",r.SwapRouterInsufficientReservesError="SwapRouterInsufficientReservesError",r.SwapRouterPoolHasNoLiquidityError="SwapRouterPoolHasNoLiquidityError",r.NoAvailablePoolError="NoAvailablePoolError",r.OutputAmountExceedsAvailableLiquidityError="OutputAmountExceedsAvailableLiquidityError",r.UnknownError="UnknownError",r.LowSwapAmountError="LowSwapAmountError",r.AssetDoesNotBelongToPoolError="AssetDoesNotBelongToPoolError",r.InvalidSwapTypeError="InvalidSwapTypeError";var D=function(t){m(n,h(Error));var e=v(n);function n(t,r){var a;return p(this,n),(a=e.call(this,r)).type=t,a.message=r,Error.captureStackTrace&&Error.captureStackTrace(T(a),n),a}return d(n)}(),O=Uint8Array.from([1]),N={V1_1:"v1_1",V2:"v2"},P={id:"".concat(0),name:"Algorand",unit_name:"ALGO",decimals:6,url:"https://algorand.org",is_liquidity_token:!1,total_amount:"6615503326932151",clawback_address:""},k={V1:"TM1POOL",V1_1:"TMPOOL11",V2:"TMPOOL2"},L="- would result negative",R="logic eval error:",F="exceeds schema integer count",B=/transaction \w+:/,M=function(t){m(n,h(Error));var e=v(n);function n(t,r){var a;p(this,n);for(var o=arguments.length,s=new Array(o>2?o-2:0),u=2;u<o;u++)s[u-2]=arguments[u];var i=(a=e.call.apply(e,[this].concat(s))).extractMessageFromAlgoSDKError(t);return a.data=t,a.type=a.getErrorType(i),a.setMessage(a.getErrorMessage(i,a.type,r)),a}return d(n,[{key:"setMessage",value:function(t){this.message=t}},{key:"getErrorType",value:function(t){var e="Unknown";return t.includes(L)?e="SlippageTolerance":t.includes(F)?e="ExceedingExcessAmountCount":t.includes(R)?e="LogicError":t.match(B)&&(e="TransactionError"),e}},{key:"getErrorMessage",value:function(t,e,n){var r;switch(e){case"SlippageTolerance":r="The process failed due to too much slippage in the price. Please adjust the slippage tolerance and try again.";break;case"ExceedingExcessAmountCount":r="The process failed due to the number of excess amounts accumulated for your account in the Tinyman app.";break;case"LogicError":r=t.split(R)[1];break;case"TransactionError":r=t.split(B)[1];break;case"Unknown":t&&(r=t)}return r||(r=n||"We encountered an unexpected error, try again later."),r.trim()}},{key:"extractMessageFromAlgoSDKError",value:function(t){var e,n,r,a="";return null!=t&&null!==(e=t.response)&&void 0!==e&&null!==(n=e.body)&&void 0!==n&&n.message?a=t.response.body.message:null!=t&&null!==(r=t.response)&&void 0!==r&&r.text?a=t.response.text:"string"==typeof(null==t?void 0:t.message)&&(a=this.isMessageObjectString(null==t?void 0:t.message)?JSON.parse(t.message||"{message: ''}").message:t.message),"string"!=typeof a&&(a=String(a)),a}},{key:"isMessageObjectString",value:function(t){return"string"==typeof t&&t.includes("{message:")}}]),n}();function Q(){return(Q=c(u().mark((function t(e){var n,r,o,s,i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.assetID,o=e.initiatorAddr,t.prev=1,t.next=4,n.getTransactionParams().do();case 4:return s=t.sent,i=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:o,to:o,assetIndex:r,amount:0,suggestedParams:s}),t.abrupt("return",[{txn:i,signers:[o]}]);case 9:throw t.prev=9,t.t0=t.catch(1),new M(t.t0,"We encountered something unexpected while opting into this asset. Try again later.");case 12:case"end":return t.stop()}}),t,null,[[1,9]])})))).apply(this,arguments)}function V(t,e){var n=Number(t.id),r=Number(e.id);return n>r?[s(s({},t),{},{id:n}),s(s({},e),{},{id:r})]:[s(s({},e),{},{id:r}),s(s({},t),{},{id:n})]}function C(t,e){var n=[t,e];return[Math.max.apply(Math,n),Math.min.apply(Math,n)]}function j(t){return 0===Number(t)}function X(t){return Number(t.id)}function q(t){var e,n=t.stateArray,r=void 0===n?[]:n,a=t.shouldDecodeKeys,o=void 0!==a&&a,s={},u=b(r);try{for(u.s();!(e=u.n()).done;){var i=e.value,c=i.key,p=void 0;if(1==i.value.type)p=i.value.bytes;else{if(2!=i.value.type)throw new Error("Unexpected state type: ".concat(i.value.type));p=i.value.uint}s[o?atob(c):c]=p}}catch(t){u.e(t)}finally{u.f()}return s}function U(t){var e,n=t.reduce((function(t,e){return t+e.length}),0),r=new Uint8Array(n),a=0,o=b(t);try{for(o.s();!(e=o.n()).done;){var s=e.value;r.set(s,a),a+=s.length}}catch(t){o.e(t)}finally{o.f()}return r}var G=100000n,W=100000n,z=100000n,J=25000n+25000n,Y=25000n+3500n;function K(t){var e=t["apps-total-schema"],n=0n,r=0n;e&&(e["num-byte-slice"]&&(n=e["num-byte-slice"]),e["num-uint"]&&(r=e["num-uint"]));var a=t["apps-local-state"]||[],o=t["created-apps"]||[],s=t.assets||[];return G+W*BigInt(s.length)+z*BigInt(o.length+a.length)+Y*r+J*n}function H(t){return new Promise((function(e){setTimeout((function(){e(null)}),t)}))}function Z(t,e){return $.apply(this,arguments)}function $(){return($=c(u().mark((function t(e,n){var r;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,H(1e3);case 3:return r=null,t.prev=4,t.next=7,e.pendingTransactionInformation(n).do();case 7:r=t.sent,t.next=12;break;case 10:t.prev=10,t.t0=t.catch(4);case 12:if(!r){t.next=17;break}if(!r["confirmed-round"]){t.next=15;break}return t.abrupt("return",r);case 15:if(!r["pool-error"]){t.next=17;break}throw new Error("Transaction Rejected: ".concat(r["pool-error"]));case 17:t.next=0;break;case 19:case"end":return t.stop()}}),t,null,[[4,10]])})))).apply(this,arguments)}function tt(t,e,n){if(e>1||e<0)throw new Error("Invalid slippage value. Must be between 0 and 1, got ".concat(e));var r;try{var a="negative"===t?1-e:1+e;r=BigInt(Math.floor(Number(n)*a))}catch(t){throw new Error(t.message)}return r}function et(t,e){var n=Number(t);return rt({decimalPlaces:n},Math.pow(10,-n)*Number(e))}function nt(t,e){return rt({decimalPlaces:0},Math.pow(10,Number(t))*Number(e))}function rt(t,e){var n=t.decimalPlaces,r=void 0===n?0:n;if(r>0){var a=w(ot(e),2),o=a[0],s=a[1],u=w(ot(Math.round(Number(at(o,s+r)))),2),i=u[0],c=u[1];return Number(at(i,c-r))}return Math.round(e)}function at(t,e){return t+(e<0?"e".concat(e):"e+".concat(e))}function ot(t){if(t.toString().includes("e")){var e=t.toString().split("e");return[parseFloat(e[0]),parseFloat(e[1])]}return[t,0]}function st(t,e){return ut.apply(this,arguments)}function ut(){return(ut=c(u().mark((function t(e,n){var r,a,o,s,i,c,p,l;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,r=[],a=b(n),t.prev=3,a.s();case 5:if((o=a.n()).done){t.next=18;break}return s=o.value,t.next=9,e.sendRawTransaction(s).do();case 9:return i=t.sent,c=i.txId,t.next=13,Z(e,c);case 13:p=t.sent,l=p["confirmed-round"],r.push({confirmedRound:l,txnID:c});case 16:t.next=5;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(3),a.e(t.t0);case 23:return t.prev=23,a.f(),t.finish(23);case 26:return t.abrupt("return",r);case 29:throw t.prev=29,t.t1=t.catch(0),new M(t.t1,"We encountered an error while processing this transaction. Try again later.");case 32:case"end":return t.stop()}}),t,null,[[0,29],[3,20,23,26]])})))).apply(this,arguments)}function it(t){return t.reduce((function(t,e){return t+e.txn.fee}),0)}function ct(t){return(e=t[0].txn.group)?Buffer.from(e).toString("base64"):"";var e}function pt(t){for(var e=[];;){var n=127&t;if(!(t>>=7)){e.push(n);break}e.push(128|n)}return e}function lt(t){return(new TextEncoder).encode(t)}function dt(t){return Boolean(t)&&void 0!==t.fallback_message}var ft,mt=new(function(){function t(){p(this,t),this.clientName="tinyman-js-sdk"}return d(t,[{key:"getClientName",value:function(){return this.clientName}},{key:"setClientName",value:function(t){this.clientName=t}},{key:"getAppCallTxnNoteWithClientName",value:function(t){return lt("tinyman/".concat(t===N.V1_1?"v1":t,':j{"origin":"').concat(this.clientName,'"}'))}}]),t}()),gt=(f(ft={},N.V1_1,{testnet:62368684,mainnet:552635992}),f(ft,N.V2,{testnet:148607e3,mainnet:1002541853}),ft);function xt(t,e){var n=gt[e][t];if(!n)throw new Error("No Validator App exists for ".concat(t," network with ").concat(e," contract version"));return n}function At(){return(At=c(u().mark((function t(e){var n,r,o,s,i,c;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,o=e.contractVersion,s=e.initiatorAddr,t.next=3,n.getTransactionParams().do();case 3:return i=t.sent,c=a.default.makeApplicationOptInTxnFromObject({from:s,appIndex:xt(r,o),note:mt.getAppCallTxnNoteWithClientName(o),suggestedParams:i}),t.abrupt("return",[{txn:c,signers:[s]}]);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var It;function ht(){return(ht=c(u().mark((function t(e){var n,r,o,s,i,c;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,o=e.contractVersion,s=e.initiatorAddr,t.next=3,n.getTransactionParams().do();case 3:return i=t.sent,c=a.default.makeApplicationClearStateTxnFromObject({from:s,appIndex:xt(r,o),note:mt.getAppCallTxnNoteWithClientName(o),suggestedParams:i}),t.abrupt("return",[{txn:c,signers:[s]}]);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}exports.SwapType=void 0,(It=exports.SwapType||(exports.SwapType={})).FixedInput="fixed-input",It.FixedOutput="fixed-output";var Tt,yt,vt;!function(t){t[t.INPUT_TXN=0]="INPUT_TXN",t[t.APP_CALL_TXN=1]="APP_CALL_TXN"}(vt||(vt={}));var wt,_t,St=(f(Tt={},exports.SwapType.FixedInput,1),f(Tt,exports.SwapType.FixedOutput,2),Tt),Et=lt("swap"),bt=(f(yt={},exports.SwapType.FixedInput,lt("fixed-input")),f(yt,exports.SwapType.FixedOutput,lt("fixed-output")),yt),Dt={ASSET_OPT_IN:lt("asset_opt_in")},Ot={testnet:159521633,mainnet:0},Nt=(f(wt={},exports.SwapType.FixedInput,7),f(wt,exports.SwapType.FixedOutput,8),wt),Pt={mainnet:{base:"https://mainnet.analytics.tinyman.org/api",v1:"https://mainnet.analytics.tinyman.org/api/v1"},testnet:{base:"https://testnet.analytics.tinyman.org/api",v1:"https://testnet.analytics.tinyman.org/api/v1"}};function kt(t){var e=Bt(t),n=e.assetIn,r=e.assetOut;return et(r.asset.decimals,Number(r.amount))/et(n.asset.decimals,Number(n.amount))}function Lt(t){var e=Ot[t];if(!e)throw new Error("Unknown network or network not supported: ".concat(t));return e}function Rt(t){return t[t.length-1].quote.amount_out}function Ft(t){return t[0].quote.amount_in}function Bt(t){return{assetIn:Ft(t),assetOut:Rt(t)}}function Mt(t){return Qt.apply(this,arguments)}function Qt(){return(Qt=c(u().mark((function e(n){var r,o,s,i,c,p,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,o=n.routerAppID,s=n.assetIDs,i=n.initiatorAddr,e.next=3,r.getTransactionParams().do();case 3:return c=e.sent,p=a.default.makeApplicationNoOpTxnFromObject({from:i,appIndex:o,appArgs:[Dt.ASSET_OPT_IN],foreignAssets:s,suggestedParams:c}),l=s.length,p.fee=t.ALGORAND_MIN_TX_FEE*(l+1),e.abrupt("return",p);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vt(t){return Ct.apply(this,arguments)}function Ct(){return(Ct=c(u().mark((function e(n){var r,o,s,i,c,p,l,d,f,m,g,x,A,I,h,T,y,v,w,_,S,E,b,D;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.initiatorAddr,o=n.client,s=n.network,i=n.swapType,c=n.route,e.next=3,o.getTransactionParams().do();case 3:return p=e.sent,l=[X(c[0].quote.amount_in.asset),X(c[0].quote.amount_out.asset),X(c[1].quote.amount_out.asset)],d=l[0],f=l[1],m=l[2],g=[Number(Ft(c).amount),Number(Rt(c).amount)],x=g[0],A=g[1],I=[c[0].pool.address,c[1].pool.address],h=I[0],T=I[1],y=j(d),v=Lt(s),w=y?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:r,to:t.getApplicationAddress(v),amount:x,suggestedParams:p}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:r,to:t.getApplicationAddress(v),amount:x,assetIndex:d,suggestedParams:p}),(_=a.default.makeApplicationNoOpTxnFromObject({from:r,appIndex:v,appArgs:[Et,bt[i],a.default.encodeUint64(A)],foreignApps:[xt(s,N.V2)],foreignAssets:[d,f,m],accounts:[h,T],suggestedParams:p})).fee=t.ALGORAND_MIN_TX_FEE*(Nt[i]+1),S=[w,_],e.next=15,jt({client:o,network:s,assetIDs:[d,f,m]});case 15:if(!((E=e.sent).length>0)){e.next=21;break}return e.next=19,Mt({client:o,initiatorAddr:r,assetIDs:E,routerAppID:v});case 19:b=e.sent,S.unshift(b);case 21:return D=a.default.assignGroupID(S),e.abrupt("return",D.map((function(t){return{txn:t,signers:[r]}})));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jt(t){return Xt.apply(this,arguments)}function Xt(){return(Xt=c(u().mark((function e(n){var r,a,o,s,i,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,a=n.network,o=n.assetIDs,s=t.getApplicationAddress(Lt(a)),e.next=4,r.accountInformation(s).do();case 4:return i=e.sent,c=i.assets.map((function(t){return t["asset-id"]})),e.abrupt("return",o.filter((function(t){return 0!==t&&!c.includes(t)})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qt(t){return Ut.apply(this,arguments)}function Ut(){return(Ut=c(u().mark((function t(e){var n,r,a,o,s,i,c,p;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.amount,r=e.assetInID,a=e.assetOutID,o=e.swapType,s=e.network,i={asset_in_id:String(r),asset_out_id:String(a),swap_type:o,amount:String(n)},t.next=4,fetch("".concat(Pt[s].v1,"/swap-router/quotes/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).catch((function(){throw new Error("Network error")}));case 4:return c=t.sent,t.next=7,c.json();case 7:if(p=t.sent,c.ok){t.next=14;break}if(!dt(p)){t.next=13;break}throw new D(p.type,p.fallback_message);case 13:throw new D(exports.SwapQuoteErrorType.UnknownError,"There was an error while getting a quote from Swap Router");case 14:if(!(p.route.length<2)){t.next=16;break}throw new D(exports.SwapQuoteErrorType.SwapRouterNoRouteError,"Swap router couldn't find a route for this swap.");case 16:return t.abrupt("return",p);case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}exports.SwapQuoteType=void 0,(_t=exports.SwapQuoteType||(exports.SwapQuoteType={})).Direct="direct",_t.Router="router";var Gt=4*t.ALGORAND_MIN_TX_FEE;function Wt(e){return(St[e]+2)*t.ALGORAND_MIN_TX_FEE}function zt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.003;return Math.ceil(1/t)}function Jt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.003;return t<zt(e)}function Yt(e){return(St[e]+1)*t.ALGORAND_MIN_TX_FEE}function Kt(t){var e=t.assetIn,n=t.assetOut;return et(n.decimals,Number(n.amount))/et(e.decimals,Number(e.amount))}function Ht(t){var e=t.inputSupply,n=t.outputSupply,r=t.assetIn,a=t.assetOut,o=Kt({assetIn:r,assetOut:a}),s=et(a.decimals,Number(n))/et(r.decimals,Number(e));return rt({decimalPlaces:5},Math.abs(o/s-1))}function Zt(t){if(t.type===exports.SwapQuoteType.Router){var e=Ft(t.data.route);return{id:X(e.asset),amount:Number(e.amount)}}return{id:t.data.quote.assetInID,amount:t.data.quote.assetInAmount}}function $t(t){if(t.type===exports.SwapQuoteType.Router){var e=Rt(t.data.route);return{id:X(e.asset),amount:Number(e.amount)}}return{id:t.data.quote.assetOutID,amount:t.data.quote.assetOutAmount}}function te(t){return t.type===exports.SwapQuoteType.Direct?t.data.pool.contractVersion:N.V2}function ee(t){return t.type===exports.SwapQuoteType.Direct?t.data.quote.rate:kt(t.data.route)}function ne(t){for(var e=t[0],n=ee(e),r=1;r<t.length;r++){var a=t[r],o=ee(a);o>n&&(e=a,n=o)}return e}function re(t){return t instanceof D&&[exports.SwapQuoteErrorType.SwapRouterInsufficientReservesError,exports.SwapQuoteErrorType.SwapRouterLowSwapAmountError,exports.SwapQuoteErrorType.OutputAmountExceedsAvailableLiquidityError,exports.SwapQuoteErrorType.LowSwapAmountError].includes(t.type)}var ae={type:"logicsig",logic:{bytecode:"BCAIAQCBgICAgICAgPABgICAgICAgIDwAQMEBQYlJA1EMQkyAxJEMRUyAxJEMSAyAxJEMgQiDUQzAQAxABJEMwEQIQcSRDMBGIGCgICAgICAgPABEkQzARkiEjMBGyEEEhA3ARoAgAlib290c3RyYXASEEAAXDMBGSMSRDMBG4ECEjcBGgCABHN3YXASEEACOzMBGyISRDcBGgCABG1pbnQSQAE7NwEaAIAEYnVybhJAAZg3ARoAgAZyZWRlZW0SQAJbNwEaAIAEZmVlcxJAAnkAIQYhBSQjEk0yBBJENwEaARclEjcBGgIXJBIQRDMCADEAEkQzAhAhBBJEMwIhIxJEMwIiIxwSRDMCIyEHEkQzAiQjEkQzAiWACFRNUE9PTDExEkQzAiZRAA+AD1RpbnltYW5Qb29sMS4xIBJEMwIngBNodHRwczovL3RpbnltYW4ub3JnEkQzAikyAxJEMwIqMgMSRDMCKzIDEkQzAiwyAxJEMwMAMQASRDMDECEFEkQzAxElEkQzAxQxABJEMwMSIxJEJCMTQAAQMwEBMwIBCDMDAQg1AUIBsTMEADEAEkQzBBAhBRJEMwQRJBJEMwQUMQASRDMEEiMSRDMBATMCAQgzAwEIMwQBCDUBQgF8MgQhBhJENwEcATEAE0Q3ARwBMwQUEkQzAgAxABNEMwIUMQASRDMDADMCABJEMwIRJRJEMwMUMwMHMwMQIhJNMQASRDMDESMzAxAiEk0kEkQzBAAxABJEMwQUMwIAEkQzAQEzBAEINQFCAREyBCEGEkQ3ARwBMQATRDcBHAEzAhQSRDMDFDMDBzMDECISTTcBHAESRDMCADEAEkQzAhQzBAASRDMCESUSRDMDADEAEkQzAxQzAwczAxAiEk0zBAASRDMDESMzAxAiEk0kEkQzBAAxABNEMwQUMQASRDMBATMCAQgzAwEINQFCAJAyBCEFEkQ3ARwBMQATRDMCADcBHAESRDMCADEAE0QzAwAxABJEMwIUMwIHMwIQIhJNMQASRDMDFDMDBzMDECISTTMCABJEMwEBMwMBCDUBQgA+MgQhBBJENwEcATEAE0QzAhQzAgczAhAiEk03ARwBEkQzAQEzAgEINQFCABIyBCEEEkQzAQEzAgEINQFCAAAzAAAxABNEMwAHMQASRDMACDQBD0M=",address:"ABUKAXTANWR6K6ZYV75DWJEPVWWOU6SFUVRI6QHO44E4SIDLHBTD2CZ64A",size:881,variables:[{name:"TMPL_ASSET_ID_1",type:"int",index:15,length:10},{name:"TMPL_ASSET_ID_2",type:"int",index:5,length:10},{name:"TMPL_VALIDATOR_APP_ID",type:"int",index:74,length:10}],source:"https://github.com/tinymanorg/tinyman-contracts-v1/tree/dc9ab40c58b85c15d58f63a1507e18be76720dbb/contracts/pool_logicsig.teal.tmpl"},name:"pool_logicsig"},oe={type:"app",global_state_schema:{num_uints:0,num_byte_slices:0},local_state_schema:{num_uints:16,num_byte_slices:0},name:"validator_app"},se=d((function t(e){p(this,t),this.schema={numLocalInts:e.local_state_schema.num_uints,numLocalByteSlices:e.local_state_schema.num_byte_slices,numGlobalInts:e.global_state_schema.num_uints,numGlobalByteSlices:e.global_state_schema.num_byte_slices}})),ue=new(function(n){m(a,se);var r=v(a);function a(t,e){var n;return p(this,a),(n=r.call(this,t)).poolLogicSigContractTemplate=e.logic.bytecode,n.templateVariables=e.logic.variables,n}return d(a,[{key:"generateLogicSigAccountForPool",value:function(n){if(n.asset1ID===n.asset2ID)throw new Error("Assets are the same");var r=xt(n.network,N.V1_1),a=w(C(n.asset1ID,n.asset2ID),2),o=a[0],s=a[1],u=Array.from(e.toByteArray(this.poolLogicSigContractTemplate)),i={asset_id_1:o,asset_id_2:s,validator_app_id:r},c=0;this.templateVariables.sort((function(t,e){return t.index-e.index}));for(var p=0;p<this.templateVariables.length;p++){var l=this.templateVariables[p],d=i[l.name.split("TMPL_")[1].toLowerCase()],f=l.index-c,m=f+l.length,g=pt(d);c+=l.length-g.length,u=u.slice(0,f).concat(g).concat(u.slice(m))}var x=new Uint8Array(u);return new t.LogicSigAccount(x)}}]),a}())(oe,ae),ie={type:"logicsig",logic:{bytecode:"BoAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgQBbNQA0ADEYEkQxGYEBEkSBAUM="},name:"pool_logicsig"},ce={type:"app",global_state_schema:{num_uints:0,num_byte_slices:3},local_state_schema:{num_uints:12,num_byte_slices:2},name:"validator_app"},pe=new(function(e){m(r,se);var n=v(r);function r(t,e){var a;return p(this,r),(a=n.call(this,t)).poolLogicSigContractTemplate=e.logic.bytecode,a}return d(r,[{key:"generateLogicSigAccountForPool",value:function(e){if(e.asset1ID===e.asset2ID)throw new Error("Assets are the same");var n=xt(e.network,N.V2),r=w(C(e.asset1ID,e.asset2ID),2),a=r[0],o=r[1],s={bytes:Array.from(Buffer.from(this.poolLogicSigContractTemplate,"base64")),validatorAppId:Array.from(t.encodeUint64(n)),asset1ID:Array.from(t.encodeUint64(a)),asset2ID:Array.from(t.encodeUint64(o))},u=[].concat(_(s.bytes.slice(0,3)),_(s.validatorAppId.slice(0,8)),_(s.asset1ID.slice(0,8)),_(s.asset2ID.slice(0,8)),_(s.bytes.slice(27)));return new t.LogicSigAccount(new Uint8Array(u))}}]),r}())(ce,ie);function le(t){return function(t){return t===N.V2}(t)?pe:ue}function de(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.IntDecoding.DEFAULT;return new Promise(function(){var t=c(u().mark((function t(a,o){var i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.accountInformation(n).setIntDecoding(r).do();case 3:i=t.sent,a(s(s({},i),{},{minimum_required_balance:me(i)})),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),o(new Error(t.t0.message||"Failed to fetch account information"));case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,n){return t.apply(this,arguments)}}())}function fe(t,e){var n=t["apps-local-state"].find((function(t){return t.id===e}));return n?q({stateArray:n["key-value"],shouldDecodeKeys:!0}):null}function me(t){var e=t["apps-total-schema"];return 1e5+1e5*(t.assets||[]).length+1e5*(t["created-apps"]||[]).length+1e5*(t["apps-local-state"]||[]).length+5e4*Number(e&&e["num-byte-slice"]||0)+28500*Number(e&&e["num-uint"]||0)+1e5*(t["apps-total-extra-pages"]||0)}var ge,xe,Ae=lt("e");function Ie(t){return he.apply(this,arguments)}function he(){return(he=c(u().mark((function n(r){var o,s,i,c,p,l,d,f,m,g,x,A,I,h,T,y,v,w,_,S,E;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=r.client,s=r.pool,i=r.accountAddr,n.next=3,o.accountInformation(i).setIntDecoding(t.IntDecoding.BIGINT).do();case 3:c=n.sent,p=c["apps-local-state"]||[],l=0n,d=0n,f=0n,m=s.account.address(),g=b(p),n.prev=10,g.s();case 12:if((x=g.n()).done){n.next=31;break}if((A=x.value).id==s.validatorAppID){n.next=16;break}return n.abrupt("continue",29);case 16:if(I=A["key-value"]){n.next=19;break}return n.abrupt("break",31);case 19:h=q({stateArray:I}),T=e.fromByteArray(U([a.default.decodeAddress(m).publicKey,Ae,a.default.encodeUint64(s.asset1ID)])),y=e.fromByteArray(U([a.default.decodeAddress(m).publicKey,Ae,a.default.encodeUint64(s.asset2ID)])),v=e.fromByteArray(U([a.default.decodeAddress(m).publicKey,Ae,a.default.encodeUint64(s.poolTokenID)])),w=h[T],_=h[y],S=h[v],"bigint"==typeof w&&(l=w),"bigint"==typeof _&&(d=_),"bigint"==typeof S&&(f=S);case 29:n.next=12;break;case 31:n.next=36;break;case 33:n.prev=33,n.t0=n.catch(10),g.e(n.t0);case 36:return n.prev=36,g.f(),n.finish(36);case 39:if(!((E={excessAsset1:l,excessAsset2:d,excessPoolTokens:f}).excessAsset1<0n||E.excessAsset2<0n||E.excessPoolTokens<0n)){n.next=42;break}throw new Error("Invalid account excess: ".concat(E));case 42:return n.abrupt("return",E);case 43:case"end":return n.stop()}}),n,null,[[10,33,36,39]])})))).apply(this,arguments)}function Te(){return(Te=c(u().mark((function n(r){var o,s,i,c,p,l,d,f,m,g,x,A,I,h,T;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=r.client,s=r.accountAddr,i=r.validatorAppID,n.next=3,o.accountInformation(s).setIntDecoding(t.IntDecoding.BIGINT).do();case 3:if(c=n.sent,p=c["apps-local-state"]||[],l=p.find((function(t){return t.id==i})),d=[],l&&l["key-value"])for(f=q({stateArray:l["key-value"]}),m=0,g=Object.entries(f);m<g.length;m++)x=g[m],A=w(x,2),I=A[0],h=A[1],41===(T=e.toByteArray(I)).length&&101===T[32]&&d.push({poolAddress:a.default.encodeAddress(T.slice(0,32)),assetID:a.default.decodeUint64(T.slice(33,41),"safe"),amount:parseInt(h)});return n.abrupt("return",d);case 9:case"end":return n.stop()}}),n)})))).apply(this,arguments)}exports.PoolStatus=void 0,(ge=exports.PoolStatus||(exports.PoolStatus={})).NOT_CREATED="not created",ge.BOOTSTRAP="bootstrap",ge.READY="ready",ge.ERROR="error";var ye=(f(xe={},N.V1_1,{asset1:"a1",asset2:"a2"}),f(xe,N.V2,{asset1:"asset_1_id",asset2:"asset_2_id",poolTokenID:"pool_token_asset_id",issuedPoolTokens:"issued_pool_tokens",asset1Reserves:"asset_1_reserves",asset2Reserves:"asset_2_reserves",asset1ProtocolFees:"asset_1_protocol_fees",asset2ProtocolFees:"asset_2_protocol_fees",totalFeeShare:"total_fee_share",protocolFeeRatio:"protocol_fee_ratio",cumulativePriceUpdateTimeStamp:"cumulative_price_update_timestamp"}),xe),ve=lt("o"),we=0xffffffffffffffffn;function _e(t){return Se.apply(this,arguments)}function Se(){return(Se=c(u().mark((function t(e){var n,r,a,o,s,i,c,p,l,d,f,m,g,x;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.client,a=e.network,o=e.asset1ID,s=e.asset2ID,i=le(N.V1_1),c=i.generateLogicSigAccountForPool(e),p=xt(a,N.V1_1),l=c.address(),d=C(o,s),t.next=8,de(r,l);case 8:return f=t.sent,m=fe(f,p),g=null===(n=f["created-assets"][0])||void 0===n?void 0:n.index,x={account:c,validatorAppID:p,asset1ID:d[0],asset2ID:d[1],status:m||g?exports.PoolStatus.READY:exports.PoolStatus.NOT_CREATED,contractVersion:N.V1_1,poolTokenID:g},m&&(x.asset1ID=m[ye.v1_1.asset1],x.asset2ID=m[ye.v1_1.asset2]),t.abrupt("return",x);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ee(){return(Ee=c(u().mark((function n(r,o){var s,i,c,p,l,d,f,m,g,x,A,I,h,T,y,v,w,_,S,E,D,O,N,P,k,L;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,de(r,o.account.address(),t.IntDecoding.BIGINT);case 2:s=n.sent,i=s["apps-local-state"]||[],c=0n,p=0n,l=0n,d=b(i),n.prev=8,d.s();case 10:if((f=d.n()).done){n.next=29;break}if((m=f.value).id==o.validatorAppID){n.next=14;break}return n.abrupt("continue",27);case 14:if(g=m["key-value"]){n.next=17;break}return n.abrupt("break",29);case 17:x=q({stateArray:g}),A=e.fromByteArray(U([ve,a.default.encodeUint64(o.asset1ID)])),I=e.fromByteArray(U([ve,a.default.encodeUint64(o.asset2ID)])),h=e.fromByteArray(U([ve,a.default.encodeUint64(o.poolTokenID)])),T=x[A],y=x[I],v=x[h],"bigint"==typeof T&&(c=T),"bigint"==typeof y&&(p=y),"bigint"==typeof v&&(l=v);case 27:n.next=10;break;case 29:n.next=34;break;case 31:n.prev=31,n.t0=n.catch(8),d.e(n.t0);case 34:return n.prev=34,d.f(),n.finish(34);case 37:w=0n,_=0n,S=0n,E=b(s.assets);try{for(E.s();!(D=E.n()).done;)O=D.value,N=O["asset-id"],P=O.amount,N==o.asset1ID?w=BigInt(P):N==o.asset2ID?_=BigInt(P):N==o.poolTokenID&&(S=BigInt(P))}catch(t){E.e(t)}finally{E.f()}if(0===o.asset2ID&&(k=K(s),_=BigInt(s.amount)-k),!((L={asset1:w-c,asset2:_-p,issuedLiquidity:we-S+l,round:s.round}).asset1<0n||L.asset2<0n)){n.next=46;break}throw new Error("The pool reserves are below zero. The manager of one of the assets has used clawback to remove assets from this pool. Do not interact with the pool.");case 46:if(!(L.issuedLiquidity<0n||L.issuedLiquidity>we)){n.next=48;break}throw new Error("Issued liquidity value is out of the expected range ([0n, ".concat(we,"]): ").concat(L.issuedLiquidity));case 48:return n.abrupt("return",L);case 49:case"end":return n.stop()}}),n,null,[[8,31,34,37]])})))).apply(this,arguments)}function be(){return be=c(u().mark((function t(e){var n,r,a,o,s,i,c,p,l,d=arguments;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.client,r=e.address,a=e.network,!(o=d.length>1&&void 0!==d[1]?d[1]:{})[r]){t.next=4;break}return t.abrupt("return",o[r]);case 4:return t.next=6,de(n,r);case 6:return s=t.sent,i=fe(s,xt(a,N.V1_1)),c=null,i&&(l=s["created-assets"][0],p=l.index,c={asset1ID:i[ye[N.V1_1].asset1],asset2ID:i[ye[N.V1_1].asset2],poolTokenID:p},o[r]=c),t.abrupt("return",c);case 11:case"end":return t.stop()}}),t)}))),be.apply(this,arguments)}var De=Object.freeze({__proto__:null,getPoolInfo:_e,getPoolReserves:function(t,e){return Ee.apply(this,arguments)},getPoolAssets:function(t){return be.apply(this,arguments)}});function Oe(t){return Ne.apply(this,arguments)}function Ne(){return(Ne=c(u().mark((function t(e){var n,r,a,o,s,i,c,p,l,d,f,m;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,a=e.asset1ID,o=e.asset2ID,s=le(N.V2),i=s.generateLogicSigAccountForPool(e),c=xt(r,N.V2),p=i.address(),l=C(a,o),t.next=8,de(n,p);case 8:return d=t.sent,f=fe(d,c),m={account:i,validatorAppID:c,asset1ID:l[0],asset2ID:l[1],status:f?exports.PoolStatus.READY:exports.PoolStatus.NOT_CREATED,contractVersion:N.V2},f&&(m.asset1ProtocolFees=BigInt(f[ye.v2.asset1ProtocolFees]),m.asset2ProtocolFees=BigInt(f[ye.v2.asset2ProtocolFees]),m.asset1Reserves=BigInt(f[ye.v2.asset1Reserves]),m.asset2Reserves=BigInt(f[ye.v2.asset2Reserves]),m.issuedPoolTokens=BigInt(f[ye.v2.issuedPoolTokens]),m.cumulativePriceUpdateTimeStamp=Number(f[ye.v2.cumulativePriceUpdateTimeStamp]),m.protocolFeeRatio=Number(f[ye.v2.protocolFeeRatio]),m.totalFeeShare=BigInt(f[ye.v2.totalFeeShare]),m.poolTokenID=Number(f[ye.v2.poolTokenID]),m.asset1ID=Number(f[ye.v2.asset1]),m.asset2ID=Number(f[ye.v2.asset2])),t.abrupt("return",m);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Pe(){return(Pe=c(u().mark((function t(e,n){var r,a,o;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,de(e,n.account.address());case 2:return r=t.sent,a=fe(r,n.validatorAppID),o={asset1:0n,asset2:0n,issuedLiquidity:0n,round:r.round},a&&(o.asset1=BigInt(a[ye.v2.asset1Reserves]),o.asset2=BigInt(a[ye.v2.asset2Reserves]),o.issuedLiquidity=BigInt(a[ye.v2.issuedPoolTokens])),t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ke(){return(ke=c(u().mark((function t(e){var n,r,a,o,s,i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.address,a=e.network,t.next=3,de(n,r);case 3:return o=t.sent,s=fe(o,xt(a,N.V2)),i=null,s&&(i={asset1ID:s[ye[N.V2].asset1],asset2ID:s[ye[N.V2].asset2],poolTokenID:s[ye[N.V2].poolTokenID]}),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Le=Object.freeze({__proto__:null,getPoolInfo:Oe,getPoolReserves:function(t,e){return Pe.apply(this,arguments)},getPoolAssets:function(t){return ke.apply(this,arguments)}});function Re(t){return Boolean(t&&!(t.asset1+t.asset2))}var Fe,Be,Me=Object.freeze({__proto__:null,getPoolShare:function(t,e){var n=Number(e)/Number(t);return Number.isFinite(n)||(n=0),n},getPoolPairRatio:function(t,e){var n=Re(e),r=null;return e&&!n&&e.asset1&&e.asset2&&"number"==typeof t.asset2&&"number"==typeof t.asset1&&(r=et(t.asset1,e.asset1)/et(t.asset2,e.asset2)),r},isPoolEmpty:Re,isPoolNotCreated:function(t){return(null==t?void 0:t.status)===exports.PoolStatus.NOT_CREATED},isPoolReady:function(t){return(null==t?void 0:t.status)===exports.PoolStatus.READY},getPoolsForPair:function(t){return Promise.all([_e(t),Oe(t)])}}),Qe=s((f(Fe={},N.V1_1,s(s({},De),Me)),f(Fe,N.V2,s(s({},Le),Me)),Fe),Me);!function(t){t[t.FUNDING_TXN=0]="FUNDING_TXN",t[t.VALIDATOR_APP_CALL=1]="VALIDATOR_APP_CALL",t[t.POOL_TOKEN_CREATE=2]="POOL_TOKEN_CREATE",t[t.ASSET1_OPT_IN=3]="ASSET1_OPT_IN",t[t.ASSET2_OPT_IN=4]="ASSET2_OPT_IN"}(Be||(Be={}));var Ve=96e4,Ce=859e3;function je(){return(je=c(u().mark((function t(e){var n,r,o,s,i,c,p,l,d,f,m,g,x,A,I,h,T,y,v,_,S,E,b,D,O;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,o=e.asset_1,s=e.asset_2,i=e.initiatorAddr,t.next=3,n.getTransactionParams().do();case 3:return c=t.sent,p=V(o,s),l=w(p,2),d=l[0],f=d.id,m=d.unit_name,g=l[1],x=g.id,A=g.unit_name,I=j(x),h=xt(r,N.V1_1),T=ue.generateLogicSigAccountForPool({network:r,asset1ID:f,asset2ID:x}),y=T.address(),v=a.default.makeApplicationOptInTxnFromObject({from:y,appIndex:h,note:mt.getAppCallTxnNoteWithClientName(N.V1_1),appArgs:[lt("bootstrap"),a.default.encodeUint64(f),a.default.encodeUint64(x)],foreignAssets:I?[f]:[x],suggestedParams:c}),_=a.default.makeAssetCreateTxnWithSuggestedParamsFromObject({from:y,total:0xffffffffffffffffn,decimals:6,defaultFrozen:!1,unitName:k.V1_1,assetName:"TinymanPool1.1 ".concat(m,"-").concat(A),assetURL:"https://tinyman.org",suggestedParams:c}),S=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:y,to:y,assetIndex:f,amount:0,suggestedParams:c}),E=a.default.makePaymentTxnWithSuggestedParamsFromObject({from:i,to:y,amount:Xe(I),suggestedParams:c}),(b=[])[Be.FUNDING_TXN]=E,b[Be.VALIDATOR_APP_CALL]=v,b[Be.POOL_TOKEN_CREATE]=_,b[Be.ASSET1_OPT_IN]=S,I||(b[Be.ASSET2_OPT_IN]=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:y,to:y,assetIndex:x,amount:0,suggestedParams:c})),D=a.default.assignGroupID(b),O=[{txn:D[Be.FUNDING_TXN],signers:[i]},{txn:D[Be.VALIDATOR_APP_CALL],signers:[y]},{txn:D[Be.POOL_TOKEN_CREATE],signers:[y]},{txn:D[Be.ASSET1_OPT_IN],signers:[y]}],D[Be.ASSET2_OPT_IN]&&O.push({txn:D[Be.ASSET2_OPT_IN],signers:[y]}),t.abrupt("return",O);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Xe(t){return t?Ve:Ce}function qe(){return(qe=c(u().mark((function t(e){var n,r,o,s,i,c,p,l,d,f,m,g,x,A,I;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.txGroup,r=e.network,o=e.initiatorSigner,s=e.asset1ID,i=e.asset2ID,t.next=3,o([n]);case 3:return c=t.sent,p=w(c,1),l=p[0],d=C(s,i),f=w(d,2),m=f[0],g=f[1],x=ue.generateLogicSigAccountForPool({network:r,asset1ID:m,asset2ID:g}),A=[],I=n.map((function(t,e){if(e===Be.FUNDING_TXN)return A.push(t.txn.txID().toString()),l;var n=a.default.signLogicSigTransactionObject(t.txn,x),r=n.txID,o=n.blob;return A.push(r),o})),t.abrupt("return",{signedTxns:I,txnIDs:A});case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ue(t){return Ge.apply(this,arguments)}function Ge(){return(Ge=c(u().mark((function t(e){var n,r,a,o,s;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.signedTxns,a=e.txnIDs,t.prev=1,t.next=4,n.sendRawTransaction(r).do();case 4:return t.next=6,Z(n,a[Be.POOL_TOKEN_CREATE]);case 6:if(o=t.sent,"number"==typeof(s=o["asset-index"])){t.next=10;break}throw new Error("Generated ID is not valid: got ".concat(s));case 10:return t.abrupt("return",{poolTokenID:s});case 13:throw t.prev=13,t.t0=t.catch(1),new M(t.t0,"We encountered something unexpected while bootstraping the pool. Try again later.");case 16:case"end":return t.stop()}}),t,null,[[1,13]])})))).apply(this,arguments)}function We(){return(We=c(u().mark((function t(e){var n,r,a,o,s,i,c;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,a=e.pool,o=a.asset1ID,s=a.asset2ID,i=e.signedTxns,c=e.txnIDs,t.next=3,Ue({client:n,signedTxns:i,txnIDs:c});case 3:return t.abrupt("return",Qe.v1_1.getPoolInfo({client:n,network:r,asset1ID:o,asset2ID:s}));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var ze,Je={generateTxns:function(t){return je.apply(this,arguments)},signTxns:function(t){return qe.apply(this,arguments)},execute:function(t){return We.apply(this,arguments)},getBootstrapFundingTxnAmount:Xe};!function(t){t[t.FUNDING_TXN=0]="FUNDING_TXN",t[t.VALIDATOR_APP_CALL=1]="VALIDATOR_APP_CALL"}(ze||(ze={}));var Ye=5,Ke=6;function He(t,e){return Ze.apply(this,arguments)}function Ze(){return(Ze=c(u().mark((function e(n,r){var a,o,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=null===(a=r.find((function(t){return"appl"===t.txn.type})))||void 0===a?void 0:a.txn.txID())){e.next=7;break}return e.next=4,t.waitForConfirmation(n,o,1e3);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=void 0;case 8:return s=e.t0,e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $e(t,e){return tn.apply(this,arguments)}function tn(){return(tn=c(u().mark((function t(e,n){var r;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,He(e,n);case 2:return r=t.sent,t.abrupt("return",null==r?void 0:r["inner-txns"]);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function en(){return(en=c(u().mark((function e(n){var r,o,s,i,c,p,l,d,f,m,g,x,A,I,h,T,y,v,_,S;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,o=n.network,s=n.asset_1,i=n.asset_2,c=n.initiatorAddr,e.next=3,r.getTransactionParams().do();case 3:return p=e.sent,l=xt(o,N.V2),d=t.getApplicationAddress(l),f=V(s,i),m=w(f,2),g=m[0].id,x=m[1].id,e.next=9,Qe.v2.getPoolInfo({client:r,network:o,asset1ID:g,asset2ID:x});case 9:if(e.sent.status!==exports.PoolStatus.READY){e.next=12;break}throw new Error("Pool for ".concat(s.unit_name,"-").concat(i.unit_name," already exists"));case 12:return A=pe.generateLogicSigAccountForPool({network:o,asset1ID:g,asset2ID:x}),I=A.address(),h=j(x),(T=a.default.makeApplicationOptInTxnFromObject({from:I,appIndex:l,appArgs:[lt("bootstrap")],note:mt.getAppCallTxnNoteWithClientName(N.V2),foreignAssets:[g,x],rekeyTo:d,suggestedParams:p})).fee=rn(h),y=a.default.makePaymentTxnWithSuggestedParamsFromObject({from:c,to:I,amount:nn(h),suggestedParams:p}),(v=[])[ze.FUNDING_TXN]=y,v[ze.VALIDATOR_APP_CALL]=T,_=a.default.assignGroupID(v),(S=[])[ze.FUNDING_TXN]={txn:_[ze.FUNDING_TXN],signers:[c]},S[ze.VALIDATOR_APP_CALL]={txn:_[ze.VALIDATOR_APP_CALL],signers:[I]},e.abrupt("return",S);case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nn(t){return function(t,e){var n=le(t).schema,r=4e5+28500*n.numLocalInts+5e4*n.numLocalByteSlices;return e||(r+=1e5),r}(N.V2,t)+rn(t)+1e5}function rn(e){return((e?Ye:Ke)+1)*t.ALGORAND_MIN_TX_FEE}function an(){return(an=c(u().mark((function t(e){var n,r,o,s,i,c,p,l,d,f,m,g,x,A,I;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.txGroup,r=e.network,o=e.initiatorSigner,s=e.asset1ID,i=e.asset2ID,t.next=3,o([n]);case 3:return c=t.sent,p=w(c,1),l=p[0],d=C(s,i),f=w(d,2),m=f[0],g=f[1],x=pe.generateLogicSigAccountForPool({network:r,asset1ID:m,asset2ID:g}),A=[],I=n.map((function(t,e){if(e===ze.FUNDING_TXN)return A.push(t.txn.txID().toString()),l;var n=a.default.signLogicSigTransactionObject(t.txn,x),r=n.txID,o=n.blob;return A.push(r),o})),t.abrupt("return",{signedTxns:I,txnIDs:A});case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function on(){return(on=c(u().mark((function t(e){var n,r,a,o,s,i,c,p,l,d,f;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,a=e.pool,o=a.asset1ID,s=a.asset2ID,i=e.txGroup,c=e.signedTxns,t.prev=1,t.next=4,n.sendRawTransaction(c).do();case 4:return t.next=6,He(n,i);case 6:if(t.t1=p=t.sent,t.t0=null===t.t1,t.t0){t.next=10;break}t.t0=void 0===p;case 10:if(!t.t0){t.next=14;break}t.t2=void 0,t.next=15;break;case 14:t.t2=null===(l=p["local-state-delta"][0].delta)||void 0===l||null===(d=l.find((function(t){return t.key===btoa(ye.v2.poolTokenID)})))||void 0===d?void 0:d.value.uint;case 15:if("number"==typeof(f=t.t2)){t.next=18;break}throw new Error("Generated ID is not valid: got ".concat(f));case 18:return t.abrupt("return",Qe.v2.getPoolInfo({client:n,network:r,asset1ID:o,asset2ID:s}));case 21:throw t.prev=21,t.t3=t.catch(1),new M(t.t3,"We encountered something unexpected while bootstraping the pool. Try again later.");case 24:case"end":return t.stop()}}),t,null,[[1,21]])})))).apply(this,arguments)}var sn,un={generateTxns:function(t){return en.apply(this,arguments)},signTxns:function(t){return an.apply(this,arguments)},execute:function(t){return on.apply(this,arguments)},getBootstrapFundingTxnAmount:nn,getTotalCost:function(e){return t.ALGORAND_MIN_TX_FEE+nn(e)}};var cn,pn=(f(sn={},N.V1_1,Je),f(sn,N.V2,un),f(sn,"generateTxns",(function(t){return t.contractVersion===N.V1_1?Je.generateTxns(t):un.generateTxns(t)})),f(sn,"signTxns",(function(t){return t.contractVersion===N.V1_1?Je.signTxns(t):un.signTxns(t)})),f(sn,"execute",(function(t){return t.contractVersion===N.V1_1?Je.execute(t):un.execute(t)})),f(sn,"calculateBootstrapFundingTxnAmount",(function(t){var e=t.contractVersion,n=t.isAlgoPool;return e===N.V1_1?Je.getBootstrapFundingTxnAmount(n):un.getBootstrapFundingTxnAmount(n)})),sn);exports.V1_1AddLiquidityTxnIndices=void 0,(cn=exports.V1_1AddLiquidityTxnIndices||(exports.V1_1AddLiquidityTxnIndices={}))[cn.FEE_TXN=0]="FEE_TXN",cn[cn.VALIDATOR_APP_CALL_TXN=1]="VALIDATOR_APP_CALL_TXN",cn[cn.ASSET1_IN_TXN=2]="ASSET1_IN_TXN",cn[cn.ASSET2_IN_TXN=3]="ASSET2_IN_TXN",cn[cn.LIQUDITY_OUT_TXN=4]="LIQUDITY_OUT_TXN";var ln,dn,fn,mn,gn=5*t.ALGORAND_MIN_TX_FEE;exports.V2AddLiquidityType=void 0,(mn=exports.V2AddLiquidityType||(exports.V2AddLiquidityType={})).SINGLE="single",mn.FLEXIBLE="flexible",mn.INITIAL="initial";var xn,An=(f(ln={},exports.V2AddLiquidityType.FLEXIBLE,{ASSET1_IN_TXN:0,ASSET2_IN_TXN:1,VALIDATOR_APP_CALL_TXN:2}),f(ln,exports.V2AddLiquidityType.SINGLE,{ASSET_IN_TXN:0,VALIDATOR_APP_CALL_TXN:1}),f(ln,exports.V2AddLiquidityType.INITIAL,{ASSET1_IN_TXN:0,ASSET2_IN_TXN:1,VALIDATOR_APP_CALL_TXN:2}),ln),In=(f(dn={},exports.V2AddLiquidityType.INITIAL,1),f(dn,exports.V2AddLiquidityType.SINGLE,2),f(dn,exports.V2AddLiquidityType.FLEXIBLE,2),dn),hn=(f(fn={},exports.V2AddLiquidityType.INITIAL,3),f(fn,exports.V2AddLiquidityType.FLEXIBLE,3),f(fn,exports.V2AddLiquidityType.SINGLE,2),fn);function Tn(t){var e,n,r,a=t.reserves,o=t.totalFeeShare,s=t.asset1,u=t.asset2,i=a.asset1*a.asset2,c=a.asset1+BigInt(s.amount),p=a.asset2+BigInt(u.amount),l=c*p,d=BigInt(parseInt(String(Math.sqrt(Number(l*a.issuedLiquidity*a.issuedLiquidity/i))))),f=d-a.issuedLiquidity,m=f*c/d,g=f*p/d,x=BigInt(s.amount)-m,A=BigInt(u.amount)-g;if(x>A){var I=x;r=yn(I,o),e={id:s.id,amount:I+r,decimals:s.decimals,reserves:a.asset1},n={id:u.id,amount:BigInt(Math.abs(Math.min(Number(A),0))),decimals:u.decimals,reserves:a.asset2},f-=r*d/(c*BigInt(2))}else{var h=A;r=yn(h,o),e={id:u.id,amount:h+r,decimals:u.decimals,reserves:a.asset2},n={id:s.id,amount:BigInt(Math.abs(Math.min(Number(x),0))),decimals:s.decimals,reserves:a.asset1},f-=r*d/(p*BigInt(2))}return{poolTokenOutAmount:f,internalSwapQuote:{assetIn:e,assetOut:n,swapFees:r,priceImpact:Ht({inputSupply:e.reserves,outputSupply:n.reserves,assetIn:e,assetOut:n})}}}function yn(t,e){return t*BigInt(e)/(BigInt(1e4)-BigInt(e))}function vn(e){return(In[e]+1)*t.ALGORAND_MIN_TX_FEE}var wn=lt("add_liquidity"),_n=(f(xn={},N.V1_1,[lt("mint")]),f(xn,N.V2,{INITIAL_LIQUIDITY:[lt("add_initial_liquidity")],SINGLE_ASSET_MODE:[wn,lt("single")],FLEXIBLE_MODE:[wn,lt("flexible")]}),xn);function Sn(){return(Sn=c(u().mark((function t(e){var n,r,o,s,i,c,p,l,d,f,m,g,x,A,I,h;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,o=e.poolAddress,s=e.asset1In,i=e.asset2In,c=e.poolTokenOut,p=e.slippage,l=e.initiatorAddr,d=tt("negative",p,c.amount),t.next=4,n.getTransactionParams().do();case 4:return f=t.sent,m=a.default.makeApplicationNoOpTxnFromObject({from:o,appIndex:xt(r,N.V1_1),appArgs:_n.v1_1,accounts:[l],note:mt.getAppCallTxnNoteWithClientName(N.V1_1),foreignAssets:0==i.id?[s.id,c.id]:[s.id,i.id,c.id],suggestedParams:f}),g=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:o,assetIndex:s.id,amount:s.amount,suggestedParams:f}),x=0===i.id?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:o,amount:i.amount,suggestedParams:f}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:o,assetIndex:i.id,amount:i.amount,suggestedParams:f}),A=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:o,to:l,assetIndex:c.id,amount:d,suggestedParams:f}),I=a.default.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:o,amount:m.fee+A.fee,note:O,suggestedParams:f}),h=a.default.assignGroupID([I,m,g,x,A]),t.abrupt("return",[{txn:h[0],signers:[l]},{txn:h[1],signers:[o]},{txn:h[2],signers:[l]},{txn:h[3],signers:[l]},{txn:h[4],signers:[o]}]);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function En(){return(En=c(u().mark((function t(e){var n,r,o,s,i,c,p,l,d,f;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.pool,r=e.txGroup,o=e.initiatorSigner,s=n.account,t.next=4,o([r]);case 4:return i=t.sent,c=w(i,3),p=c[0],l=c[1],d=c[2],f=r.map((function(t,e){return e===exports.V1_1AddLiquidityTxnIndices.FEE_TXN?p:e===exports.V1_1AddLiquidityTxnIndices.ASSET1_IN_TXN?l:e===exports.V1_1AddLiquidityTxnIndices.ASSET2_IN_TXN?d:a.default.signLogicSigTransactionObject(t.txn,s).blob})),t.abrupt("return",f);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function bn(){return(bn=c(u().mark((function t(e){var n,r,a,o,s,i,c,p,l,d,f,m,g,x,A,I,h;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,a=e.txGroup,o=e.signedTxns,s=e.initiatorAddr,t.prev=1,i=BigInt(a[exports.V1_1AddLiquidityTxnIndices.LIQUDITY_OUT_TXN].txn.amount),t.next=5,Ie({client:n,pool:r,accountAddr:s});case 5:return c=t.sent,t.next=8,st(n,[o]);case 8:return p=t.sent,l=w(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,g=it(a),x=ct(a),t.next=17,Ie({client:n,pool:r,accountAddr:s});case 17:return A=t.sent,(I=A.excessPoolTokens-c.excessPoolTokens)<0n&&(I=0n),t.abrupt("return",{round:f,fees:g,poolTokenID:r.poolTokenID,poolTokenOut:i+I,excessAmount:{excessAmountForAddingLiquidity:I,totalExcessAmount:A.excessPoolTokens},txnID:m,groupID:x});case 23:throw t.prev=23,t.t0=t.catch(1),"SlippageTolerance"===(h=new M(t.t0,"We encountered something unexpected while adding liquidity. Try again later.")).type&&h.setMessage("Adding liquidity failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),h;case 28:case"end":return t.stop()}}),t,null,[[1,23]])})))).apply(this,arguments)}var Dn=Object.freeze({__proto__:null,getQuote:function(t){var e=t.pool,n=t.reserves,r=t.asset1In,a=t.asset2In;if(0n===n.issuedLiquidity){var o=BigInt(Math.floor(Math.sqrt(Number(r)*Number(a))));if(o<=BigInt(1e3))throw new Error("Initial liquidity amount is too small. The amount must be greater than ".concat(1e3,", this quote is for ").concat(o,"."));return{round:n.round,asset1ID:e.asset1ID,asset1In:BigInt(r),asset2ID:e.asset2ID,asset2In:BigInt(a),poolTokenID:e.poolTokenID,poolTokenOut:o-BigInt(1e3),share:1}}var s=BigInt(r)*n.issuedLiquidity/n.asset1,u=BigInt(a)*n.issuedLiquidity/n.asset2,i=s<u?s:u;return{round:n.round,asset1ID:e.asset1ID,asset1In:BigInt(r),asset2ID:e.asset2ID,asset2In:BigInt(a),poolTokenID:e.poolTokenID,poolTokenOut:i,share:Qe.getPoolShare(n.issuedLiquidity+i,i)}},generateTxns:function(t){return Sn.apply(this,arguments)},signTxns:function(t){return En.apply(this,arguments)},execute:function(t){return bn.apply(this,arguments)}});function On(t){var e=t.txGroup;return(0,t.initiatorSigner)([e])}function Nn(t){return Pn.apply(this,arguments)}function Pn(){return(Pn=c(u().mark((function t(e){var n,r,a,o,s,i,c,p,l,d,f,m,g;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,a=e.txGroup,o=e.signedTxns,t.prev=1,t.next=4,st(n,[o]);case 4:return c=t.sent,p=w(c,1),l=p[0],d=l.confirmedRound,f=l.txnID,t.next=11,$e(n,a);case 11:if(t.t1=s=t.sent,t.t0=null===t.t1,t.t0){t.next=15;break}t.t0=void 0===s;case 15:if(!t.t0){t.next=19;break}t.t2=void 0,t.next=20;break;case 19:t.t2=null===(i=s.find((function(t){return"axfer"===t.txn.txn.type})))||void 0===i?void 0:i.txn.txn;case 20:return m=t.t2,t.abrupt("return",{round:d,assetOut:m?{amount:m.aamt,id:m.xaid}:void 0,fees:it(a),poolTokenID:r.poolTokenID,txnID:f,groupID:ct(a)});case 24:throw t.prev=24,t.t3=t.catch(1),"SlippageTolerance"===(g=new M(t.t3,"We encountered something unexpected while adding liquidity. Try again later.")).type&&g.setMessage("Adding liquidity failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),g;case 29:case"end":return t.stop()}}),t,null,[[1,24]])})))).apply(this,arguments)}function kn(){return(kn=c(u().mark((function e(n){var r,o,s,i,c,p,l,d,f,m,g,x,A,I,h,T,y,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,o=n.network,s=n.poolAddress,i=n.asset1In,c=n.asset2In,p=n.poolTokenOut,l=n.initiatorAddr,d=n.minPoolTokenAssetAmount,e.next=3,r.getTransactionParams().do();case 3:return f=e.sent,m=V(i,c),g=w(m,2),x=g[0],A=g[1],I=j(A.id),h=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:s,assetIndex:x.id,amount:x.amount,suggestedParams:f}),T=I?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:s,amount:A.amount,suggestedParams:f}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:s,assetIndex:A.id,amount:A.amount,suggestedParams:f}),(y=a.default.makeApplicationNoOpTxnFromObject({from:l,appIndex:xt(o,N.V2),note:mt.getAppCallTxnNoteWithClientName(N.V2),appArgs:[].concat(_(_n.v2.FLEXIBLE_MODE),[t.encodeUint64(d)]),accounts:[s],foreignAssets:[p.id],suggestedParams:f})).fee=vn(exports.V2AddLiquidityType.FLEXIBLE),v=a.default.assignGroupID([h,T,y]),e.abrupt("return",[{txn:v[0],signers:[l]},{txn:v[1],signers:[l]},{txn:v[2],signers:[l]}]);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ln=Object.freeze({__proto__:null,getQuote:function(t){var e=t.pool,n=t.slippage,r=void 0===n?.05:n,a=t.asset1,o=t.asset2;if(0n===e.issuedPoolTokens)throw new Error("Pool has no liquidity at the moment. To be able to do Flexible Swap, you should first add initial liquidity.");if(e.status!==exports.PoolStatus.READY)throw new Error("Pool is not ready");if(!e.poolTokenID)throw new Error("Pool token ID is not available");var s={asset1:e.asset1Reserves||0n,asset2:e.asset2Reserves||0n,issuedLiquidity:e.issuedPoolTokens||0n},u=Tn({reserves:s,totalFeeShare:e.totalFeeShare,asset1:{id:e.asset1ID,amount:a.amount,decimals:a.decimals},asset2:{id:e.asset2ID,amount:o.amount,decimals:o.decimals}}),i=u.poolTokenOutAmount,c=u.internalSwapQuote,p=i-BigInt(Math.ceil(Number(i)*r));return{asset1In:{id:e.asset1ID,amount:BigInt(a.amount)},asset2In:{id:e.asset2ID,amount:BigInt(o.amount)},poolTokenOut:{id:e.poolTokenID,amount:i},share:Qe.getPoolShare(s.issuedLiquidity+i,i),slippage:r,internalSwapQuote:c,minPoolTokenAssetAmountWithSlippage:p}},generateTxns:function(t){return kn.apply(this,arguments)},signTxns:On,execute:Nn});function Rn(){return(Rn=c(u().mark((function e(n){var r,o,s,i,c,p,l,d,f,m,g,x;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,o=n.network,s=n.poolAddress,i=n.assetIn,c=n.poolTokenId,p=n.initiatorAddr,l=n.minPoolTokenAssetAmount,e.next=3,r.getTransactionParams().do();case 3:return d=e.sent,f=j(i.id),m=f?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:p,to:s,amount:i.amount,suggestedParams:d}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:s,assetIndex:i.id,amount:i.amount,suggestedParams:d}),(g=a.default.makeApplicationNoOpTxnFromObject({from:p,appIndex:xt(o,N.V2),note:mt.getAppCallTxnNoteWithClientName(N.V2),appArgs:[].concat(_(_n.v2.SINGLE_ASSET_MODE),[t.encodeUint64(l)]),accounts:[s],foreignAssets:[c],suggestedParams:d})).fee=vn(exports.V2AddLiquidityType.SINGLE),x=a.default.assignGroupID([m,g]),e.abrupt("return",[{txn:x[0],signers:[p]},{txn:x[1],signers:[p]}]);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Fn=Object.freeze({__proto__:null,getQuote:function(t){var e=t.pool,n=t.assetIn,r=t.slippage,a=void 0===r?.05:r,o=t.decimals;if(0n===e.issuedPoolTokens)throw new Error("Pool has no liquidity");if(e.status!==exports.PoolStatus.READY)throw new Error("Pool is not ready");if(!e.poolTokenID)throw new Error("Pool token ID is not available");var s=n.id===e.asset1ID,u=n.id===e.asset2ID;if(!s&&!u)throw new Error("Provided input asset id didn't match any asset of the pool");var i={id:e.asset1ID,amount:s?n.amount:0,decimals:o.asset1},c={id:e.asset2ID,amount:u?n.amount:0,decimals:o.asset2},p={asset1:e.asset1Reserves||0n,asset2:e.asset2Reserves||0n,issuedLiquidity:e.issuedPoolTokens||0n},l=Tn({reserves:p,totalFeeShare:e.totalFeeShare||0,asset1:i,asset2:c}),d=l.poolTokenOutAmount,f=l.internalSwapQuote,m=d-BigInt(Math.ceil(Number(d)*a));return{assetIn:{id:s?e.asset1ID:e.asset2ID,amount:BigInt(n.amount)},poolTokenOut:{id:e.poolTokenID,amount:d},share:Qe.getPoolShare(p.issuedLiquidity+d,d),slippage:a,internalSwapQuote:f,minPoolTokenAssetAmountWithSlippage:m}},generateTxns:function(t){return Rn.apply(this,arguments)},signTxns:On,execute:Nn});function Bn(){return(Bn=c(u().mark((function t(e){var n,r,o,s,i,c,p,l,d,f,m,g,x;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,o=e.network,s=e.poolAddress,i=e.asset1In,c=e.asset2In,p=e.poolTokenId,l=e.initiatorAddr,d=j(r.asset2ID),t.next=4,n.getTransactionParams().do();case 4:return f=t.sent,m=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:s,assetIndex:r.asset1ID,amount:i.amount,suggestedParams:f}),g=d?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:s,amount:c.amount,suggestedParams:f}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:s,assetIndex:r.asset2ID,amount:c.amount,suggestedParams:f}),(x=a.default.makeApplicationNoOpTxnFromObject({from:l,appIndex:xt(o,N.V2),appArgs:_n.v2.INITIAL_LIQUIDITY,note:mt.getAppCallTxnNoteWithClientName(N.V2),accounts:[s],foreignAssets:[p],suggestedParams:f})).fee=vn(exports.V2AddLiquidityType.INITIAL),t.abrupt("return",a.default.assignGroupID([m,g,x]).map((function(t){return{txn:t,signers:[l]}})));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Mn,Qn,Vn=Object.freeze({__proto__:null,getQuote:function(t){var e=t.pool,n=t.asset1,r=t.asset2,a=t.slippage,o=void 0===a?.05:a;if(0n!==e.issuedPoolTokens)throw new Error("Pool already has liquidity");var s=BigInt(Math.floor(Math.sqrt(Number(n.amount)*Number(r.amount))));if(s<=BigInt(1e3))throw new Error("Initial liquidity amount is too small. Liquidity amount must be greater than ".concat(1e3,", this quote is for ").concat(s,"."));var u=function(t,e){if(!t.amount||!e.amount)throw new Error("Both assets are required for the initial add liquidity");return BigInt(Math.abs(Math.floor(Math.sqrt(nt(t.decimals,Math.floor(Number(t.amount)))*nt(e.decimals,Math.floor(Number(e.amount))))-1e3)))}(n,r);return{asset1In:{id:e.asset1ID,amount:BigInt(n.amount)},asset2In:{id:e.asset2ID,amount:BigInt(r.amount)},poolTokenOut:{id:e.poolTokenID,amount:u},slippage:o}},generateTxns:function(t){return Bn.apply(this,arguments)},signTxns:On,execute:Nn}),Cn=Object.freeze({__proto__:null,flexible:Ln,withSingleAsset:Fn,initial:Vn}),jn=(f(Mn={},N.V1_1,Dn),f(Mn,N.V2,Cn),Mn);!function(t){t[t.FEE_TXN=0]="FEE_TXN",t[t.VALIDATOR_APP_CALL_TXN=1]="VALIDATOR_APP_CALL_TXN",t[t.ASSET1_OUT_TXN=2]="ASSET1_OUT_TXN",t[t.ASSET2_OUT_TXN=3]="ASSET2_OUT_TXN",t[t.POOL_TOKEN_IN_TXN=4]="POOL_TOKEN_IN_TXN"}(Qn||(Qn={}));var Xn,qn=Object.values(Qn).length,Un=lt("remove_liquidity");function Gn(){return(Gn=c(u().mark((function t(e){var n,r,o,s,i,c,p,l,d,f,m,g,x,A,I,h,T,y,v,w;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,o=e.poolTokenIn,s=e.asset1Out,i=e.asset2Out,c=e.slippage,p=e.initiatorAddr,t.next=3,n.getTransactionParams().do();case 3:return l=t.sent,d=r.account.address(),f=j(r.asset2ID),m=a.default.makeApplicationNoOpTxnFromObject({from:d,appIndex:r.validatorAppID,appArgs:[lt("burn")],note:mt.getAppCallTxnNoteWithClientName(N.V1_1),accounts:[p],foreignAssets:f?[r.asset1ID,r.poolTokenID]:[r.asset1ID,r.asset2ID,r.poolTokenID],suggestedParams:l}),g=tt("negative",c,s),x=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:d,to:p,assetIndex:r.asset1ID,amount:g,suggestedParams:l}),A=tt("negative",c,i),I=f?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:d,to:p,amount:A,suggestedParams:l}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:d,to:p,assetIndex:r.asset2ID,amount:A,suggestedParams:l}),h=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:d,assetIndex:r.poolTokenID,amount:o,suggestedParams:l}),T=m.fee+x.fee+I.fee,y=a.default.makePaymentTxnWithSuggestedParamsFromObject({from:p,to:d,amount:T,note:O,suggestedParams:l}),(v=[])[Qn.FEE_TXN]=y,v[Qn.VALIDATOR_APP_CALL_TXN]=m,v[Qn.ASSET1_OUT_TXN]=x,v[Qn.ASSET2_OUT_TXN]=I,v[Qn.POOL_TOKEN_IN_TXN]=h,w=a.default.assignGroupID(v),t.abrupt("return",[{txn:w[Qn.FEE_TXN],signers:[p]},{txn:w[Qn.VALIDATOR_APP_CALL_TXN],signers:[d]},{txn:w[Qn.ASSET1_OUT_TXN],signers:[d]},{txn:w[Qn.ASSET2_OUT_TXN],signers:[d]},{txn:w[Qn.POOL_TOKEN_IN_TXN],signers:[p]}]);case 22:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Wn(){return(Wn=c(u().mark((function t(e){var n,r,o,s,i,c,p,l,d;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.pool,r=e.txGroup,o=e.initiatorSigner,t.next=3,o([r]);case 3:return s=t.sent,i=w(s,2),c=i[0],p=i[1],l=n.account,d=r.map((function(t,e){return e===Qn.FEE_TXN?c:e===Qn.POOL_TOKEN_IN_TXN?p:a.default.signLogicSigTransactionObject(t.txn,l).blob})),t.abrupt("return",d);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function zn(){return(zn=c(u().mark((function t(e){var n,r,a,o,s,i,c,p,l,d,f,m,g,x,A,I,h,T;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,a=e.txGroup,o=e.signedTxns,s=e.initiatorAddr,t.prev=1,i=a[Qn.ASSET1_OUT_TXN].txn.amount,c=a[Qn.ASSET2_OUT_TXN].txn.amount,p=a[Qn.POOL_TOKEN_IN_TXN].txn.amount,t.next=7,Ie({client:n,pool:r,accountAddr:s});case 7:return l=t.sent,t.next=10,st(n,[o]);case 10:return d=t.sent,f=w(d,1),m=f[0],g=m.confirmedRound,x=m.txnID,t.next=17,Ie({client:n,pool:r,accountAddr:s});case 17:return A=t.sent,(I=A.excessAsset1-l.excessAsset1)<0n&&(I=0n),(h=A.excessAsset2-l.excessAsset2)<0n&&(h=0n),t.abrupt("return",{round:g,fees:it(a),asset1ID:r.asset1ID,asset1Out:BigInt(i)+I,asset2ID:r.asset2ID,asset2Out:BigInt(c)+h,poolTokenID:r.poolTokenID,poolTokenIn:BigInt(p),excessAmounts:[{assetID:r.asset1ID,excessAmountForBurning:I,totalExcessAmount:A.excessAsset1},{assetID:r.asset2ID,excessAmountForBurning:h,totalExcessAmount:A.excessAsset2}],txnID:x,groupID:ct(a)});case 25:throw t.prev=25,t.t0=t.catch(1),"SlippageTolerance"===(T=new M(t.t0,"We encountered something unexpected while burning liquidity. Try again later.")).type&&T.setMessage("The burn failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),T;case 30:case"end":return t.stop()}}),t,null,[[1,25]])})))).apply(this,arguments)}function Jn(){return(Jn=c(u().mark((function t(e){var n,r,o,i,c,p,l,d,f,m,g,x,A,I,h,T,y,v,w,_;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.quote.type!==exports.SwapQuoteType.Router){t.next=2;break}return t.abrupt("return",Vt(s(s({},e),{},{route:e.quote.data.route})));case 2:if(n=e.client,r=e.initiatorAddr,o=e.slippage,i=e.swapType,c=e.quote,p=c.data,l=p.pool,d=p.quote,f=d.assetInID,m=d.assetOutID,g=l.account.address(),(x=[l.asset1ID,l.asset2ID]).includes(f)&&x.includes(m)&&f!==m){t.next=9;break}throw new M({pool:l,quote:c},"Input asset (#".concat(f,") and output asset (#").concat(m,") provided to generate transactions do not belong to the pool ").concat(g,"."));case 9:return t.next=11,n.getTransactionParams().do();case 11:return A=t.sent,I=j(f),h=i===exports.SwapType.FixedInput?d.assetInAmount:tt("positive",o,d.assetInAmount),T=i===exports.SwapType.FixedOutput?d.assetOutAmount:tt("negative",o,d.assetOutAmount),y=I?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:r,to:g,amount:h,suggestedParams:A}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:r,to:g,amount:h,assetIndex:f,suggestedParams:A}),(v=a.default.makeApplicationNoOpTxnFromObject({from:r,appIndex:l.validatorAppID,appArgs:[Et,bt[i],a.default.encodeUint64(T)],note:mt.getAppCallTxnNoteWithClientName(N.V2),accounts:[g],foreignAssets:[l.asset1ID,l.asset2ID],suggestedParams:A})).fee=Yt(i),(w=[])[vt.INPUT_TXN]=y,w[vt.APP_CALL_TXN]=v,_=a.default.assignGroupID(w),t.abrupt("return",[{txn:_[vt.INPUT_TXN],signers:[r]},{txn:_[vt.APP_CALL_TXN],signers:[r]}]);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Yn(){return(Yn=c(u().mark((function t(e){var n,r,a,o,s,i,c,p,l,d,f,m,g,x,A,I;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.client,o=e.quote,s=e.txGroup,i=e.signedTxns,t.next=3,st(a,[i]);case 3:return c=t.sent,p=w(c,1),l=p[0],d=l.confirmedRound,f=l.txnID,t.next=10,$e(a,s);case 10:return m=t.sent,g=Zt(o),x=$t(o).id,A=null==m||null===(n=m.find((function(t){return t.txn.txn.xaid===g.id})))||void 0===n?void 0:n.txn.txn,I=null==m||null===(r=m.find((function(t){return t.txn.txn.xaid===x})))||void 0===r?void 0:r.txn.txn,t.abrupt("return",{round:d,assetIn:A&&{amount:BigInt(g.amount)-BigInt(A.aamt||0),id:g.id},assetOut:I&&{amount:I.aamt,id:x},quote:o,txnID:f});case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Kn(){return(Kn=c(u().mark((function t(e){var n,r,a,o,s,i,c,p;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.type,r=e.amount,a=e.assetIn,o=e.assetOut,s=e.network,i=e.isSwapRouterEnabled,c=e.pool,n!==exports.SwapType.FixedInput){t.next=7;break}return t.next=4,tr({assetIn:a,assetOut:o,amount:r,isSwapRouterEnabled:i,network:s,pool:c});case 4:p=t.sent,t.next=10;break;case 7:return t.next=9,nr({amount:r,assetIn:a,assetOut:o,isSwapRouterEnabled:i,network:s,pool:c});case 9:p=t.sent;case 10:return t.abrupt("return",p);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Hn(t){return Promise.allSettled(t).then((function(t){if(t.every((function(t){return"rejected"===t.status}))){var e=t[0].reason;if(2===t.length){var n=t[1].reason;if(re(e)&&!re(n))throw e;throw n}throw e}return t.filter((function(t){return"fulfilled"===t.status&&t.value})).map((function(t){return t.value}))}))}function Zn(t){var e=t.amount,n=t.assetIn,r=t.assetOut,a=t.pool;if(!Qe.isPoolReady(a))throw new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"There is not an available pool for this asset pair");var o,s,u=n.id,i=n.decimals,c=r.id,p=r.decimals,l=BigInt(e),d=a.totalFeeShare;if(u===a.asset1ID)o=a.asset1Reserves,s=a.asset2Reserves;else{if(u!==a.asset2ID)throw new D(exports.SwapQuoteErrorType.AssetDoesNotBelongToPoolError,"Input asset (#".concat(u,") doesn't belong to the pool ").concat(a.account.address(),"."));o=a.asset2Reserves,s=a.asset1Reserves}var f=ar({inputSupply:o,outputSupply:s,swapInputAmount:l,totalFeeShare:d,decimals:{assetIn:i,assetOut:p}}),m=f.swapOutputAmount,g=f.totalFeeAmount,x=f.priceImpact;if(m>s)throw new D(exports.SwapQuoteErrorType.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");if(Jt(Number(e)))throw new D(exports.SwapQuoteErrorType.LowSwapAmountError,"Swap amount is too low.");return{assetInID:u,assetInAmount:l,assetOutID:c,assetOutAmount:m,swapFee:Number(g),rate:et(p,Number(m))/et(i,Number(l)),priceImpact:x}}function $n(t){var e=t.amount,n=t.assetIn,r=t.assetOut,a=t.pool;if(!a||!Qe.isPoolReady(a))throw new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"There is not an available pool for this asset pair");var o,s,u=n.id,i=n.decimals,c=r.id,p=r.decimals,l=BigInt(e),d=a.totalFeeShare;if(c===a.asset1ID)o=a.asset2Reserves,s=a.asset1Reserves;else{if(c!==a.asset2ID)throw new D(exports.SwapQuoteErrorType.AssetDoesNotBelongToPoolError,"Output asset (#".concat(c,") doesn't belong to the pool ").concat(a.account.address(),"."));o=a.asset1Reserves,s=a.asset2Reserves}var f=function(t){var e=t.inputSupply,n=t.outputSupply,r=t.swapOutputAmount,a=t.totalFeeShare,o=t.decimals,s=function(t){var e=t.inputSupply,n=t.outputSupply,r=t.outputAmount,a=BigInt(e*n/(n-r))-e;return a+=BigInt(1)}({inputSupply:e,outputSupply:n,outputAmount:r}),u=function(t){var e=t.swapAmount,n=t.totalFeeShare,r=Math.floor(Number(e*BigInt(1e4)/(BigInt(1e4)-BigInt(n))));return BigInt(r)-e}({swapAmount:s,totalFeeShare:a}),i=s+u,c=Ht({inputSupply:e,outputSupply:n,assetIn:{amount:i,decimals:o.assetIn},assetOut:{amount:r,decimals:o.assetOut}});return{swapInputAmount:i,totalFeeAmount:u,priceImpact:c}}({inputSupply:o,outputSupply:s,swapOutputAmount:l,totalFeeShare:d,decimals:{assetIn:i,assetOut:p}}),m=f.swapInputAmount,g=f.totalFeeAmount,x=f.priceImpact;if(l>s)throw new D(exports.SwapQuoteErrorType.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");if(Jt(Number(m)))throw new D(exports.SwapQuoteErrorType.LowSwapAmountError,"Swap amount is too low.");return{type:exports.SwapQuoteType.Direct,data:{pool:a,quote:{assetInID:u,assetInAmount:m,assetOutID:c,assetOutAmount:l,swapFee:Number(g),rate:et(p,Number(l))/et(i,Number(m)),priceImpact:x}}}}function tr(t){return er.apply(this,arguments)}function er(){return(er=c(u().mark((function t(e){var n,r,a,o,s,i,c,p;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.amount,r=e.assetIn,a=e.assetOut,o=e.isSwapRouterEnabled,s=e.network,i=e.pool,c=[],i?c.push(new Promise((function(t,e){try{var o=Zn({amount:n,assetIn:r,assetOut:a,pool:i});t({type:exports.SwapQuoteType.Direct,data:{pool:i,quote:o}})}catch(t){e(t)}}))):c.push(Promise.reject(new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"There is not an available pool for this asset pair"))),o&&c.push(qt({amount:n,assetInID:r.id,assetOutID:a.id,swapType:exports.SwapType.FixedInput,network:s}).then((function(t){return{type:exports.SwapQuoteType.Router,data:t}}))),t.next=6,Hn(c);case 6:return p=t.sent,t.abrupt("return",ne(p));case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function nr(t){return rr.apply(this,arguments)}function rr(){return(rr=c(u().mark((function t(e){var n,r,a,o,s,i,c,p;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.amount,r=e.assetIn,a=e.assetOut,o=e.isSwapRouterEnabled,s=e.network,i=e.pool,c=[new Promise((function(t,e){try{t($n({amount:n,assetIn:r,assetOut:a,pool:i}))}catch(t){e(t)}}))],o&&c.push(qt({amount:n,assetInID:r.id,assetOutID:a.id,swapType:exports.SwapType.FixedOutput,network:s}).then((function(t){return{type:exports.SwapQuoteType.Router,data:t}}))),t.next=5,Hn(c);case 5:return p=t.sent,t.abrupt("return",ne(p));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ar(t){var e=t.inputSupply,n=t.outputSupply,r=t.swapInputAmount,a=t.totalFeeShare,o=t.decimals,s=BigInt(function(t){var e=t.inputAmount,n=t.totalFeeShare;return Math.floor(Number(e*BigInt(n))/1e4)}({inputAmount:r,totalFeeShare:a})),u=function(t){var e=t.inputSupply,n=t.outputSupply,r=t.swapAmount,a=n-BigInt(e*n/(e+BigInt(r)));return a-=BigInt(1)}({inputSupply:e,outputSupply:n,swapAmount:r-s});return{swapOutputAmount:u,totalFeeAmount:s,priceImpact:Ht({inputSupply:e,outputSupply:n,assetIn:{amount:r,decimals:o.assetIn},assetOut:{amount:u,decimals:o.assetOut}})}}!function(t){t[t.ASSET_TRANSFER_TXN=0]="ASSET_TRANSFER_TXN",t[t.APP_CALL_TXN=1]="APP_CALL_TXN"}(Xn||(Xn={}));var or={getQuote:function(t){return Kn.apply(this,arguments)},getFixedInputSwapQuote:tr,getFixedInputDirectSwapQuote:Zn,getFixedOutputDirectSwapQuote:$n,getFixedOutputSwapQuote:nr,generateTxns:function(t){return Jn.apply(this,arguments)},signTxns:function(t){var e=t.txGroup;return(0,t.initiatorSigner)([e])},execute:function(t){return Yn.apply(this,arguments)},calculateFixedInputSwap:ar};function sr(t,e){var n,r,a=BigInt(t),o=e.issuedLiquidity;return o>a+BigInt(1e3)?(n=a*e.asset1/o,r=a*e.asset2/o):(n=e.asset1,r=e.asset2),{asset1OutputAmount:n,asset2OutputAmount:r}}function ur(){return(ur=c(u().mark((function e(n){var r,o,s,i,c,p,l,d,f,m,g,x,A,I;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,o=n.pool,s=n.poolTokenIn,i=n.initiatorAddr,c=n.minAsset1Amount,p=n.minAsset2Amount,l=n.slippage,e.next=3,r.getTransactionParams().do();case 3:if(d=e.sent,f=o.account.address(),m=o.poolTokenID){e.next=8;break}throw new Error("Pool token asset ID is missing");case 8:return g=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:i,to:f,assetIndex:m,amount:s,suggestedParams:d}),(x=a.default.makeApplicationNoOpTxnFromObject({from:i,appIndex:o.validatorAppID,note:mt.getAppCallTxnNoteWithClientName(N.V2),appArgs:[Un,a.default.encodeUint64(tt("negative",l,c)),a.default.encodeUint64(tt("negative",l,p))],accounts:[f],foreignAssets:[o.asset1ID,o.asset2ID],suggestedParams:d})).fee=3*t.ALGORAND_MIN_TX_FEE,(A=[])[Xn.ASSET_TRANSFER_TXN]=g,A[Xn.APP_CALL_TXN]=x,I=a.default.assignGroupID(A),e.abrupt("return",[{txn:I[Xn.ASSET_TRANSFER_TXN],signers:[i]},{txn:I[Xn.APP_CALL_TXN],signers:[i]}]);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ir(){return(ir=c(u().mark((function e(n){var r,o,s,i,c,p,l,d,f,m,g,x,A,I,h,T,y,v,w;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,o=n.pool,s=n.initiatorAddr,i=n.poolTokenIn,c=n.outputAssetId,p=n.minOutputAssetAmount,l=n.slippage,e.next=3,r.getTransactionParams().do();case 3:if(d=e.sent,f=o.asset1ID,m=o.asset2ID,g=o.account.address(),x=o.poolTokenID){e.next=9;break}throw new Error("Pool token asset ID is missing");case 9:if(A=0,I=0,h=tt("negative",l,p),c!==f){e.next=17;break}A=h,I=0,e.next=23;break;case 17:if(c!==m){e.next=22;break}A=0,I=h,e.next=23;break;case 22:throw new Error("Invalid output asset id. It doesn't match with pool assets");case 23:return T=a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:s,to:g,assetIndex:x,amount:i,suggestedParams:d}),(y=a.default.makeApplicationNoOpTxnFromObject({from:s,appIndex:o.validatorAppID,note:mt.getAppCallTxnNoteWithClientName(N.V2),appArgs:[Un,a.default.encodeUint64(A),a.default.encodeUint64(I)],accounts:[g],foreignAssets:[c],suggestedParams:d})).fee=3*t.ALGORAND_MIN_TX_FEE,(v=[])[Xn.ASSET_TRANSFER_TXN]=T,v[Xn.APP_CALL_TXN]=y,w=a.default.assignGroupID(v),e.abrupt("return",[{txn:w[Xn.ASSET_TRANSFER_TXN],signers:[s]},{txn:w[Xn.APP_CALL_TXN],signers:[s]}]);case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cr(){return(cr=c(u().mark((function t(e){var n,r,a,o,s,i,c,p;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.client,a=e.txGroup,o=e.signedTxns,t.next=3,st(r,[o]);case 3:return s=t.sent,i=w(s,1),c=i[0].txnID,t.next=8,$e(r,a);case 8:if(t.t1=n=t.sent,t.t0=null===t.t1,t.t0){t.next=12;break}t.t0=void 0===n;case 12:if(!t.t0){t.next=16;break}t.t2=void 0,t.next=17;break;case 16:t.t2=n.map((function(t){return{assetId:t.txn.txn.xaid,amount:t.txn.txn.aamt}}));case 17:return p=t.t2,t.abrupt("return",{outputAssets:p,txnID:c});case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var pr,lr,dr={getQuote:function(t){var e=t.pool,n=t.reserves,r=t.poolTokenIn,a=BigInt(r),o=sr(a,n),s=o.asset1OutputAmount,u=o.asset2OutputAmount;return{round:n.round,asset1Out:{assetId:e.asset1ID,amount:s},asset2Out:{assetId:e.asset2ID,amount:u},poolTokenIn:{assetId:e.poolTokenID,amount:a}}},getSingleAssetRemoveLiquidityQuote:function(t){var e,n=t.pool,r=t.reserves,a=t.poolTokenIn,o=t.assetOutID,s=t.decimals,u=BigInt(a),i=sr(u,r),c=i.asset1OutputAmount,p=i.asset2OutputAmount,l=n.totalFeeShare;if(o===n.asset1ID){var d=or.calculateFixedInputSwap({inputSupply:r.asset2-p,outputSupply:r.asset1-c,swapInputAmount:p,totalFeeShare:l,decimals:s}),f=d.swapOutputAmount,m=d.totalFeeAmount,g=d.priceImpact;e={round:r.round,assetOut:{assetId:o,amount:c+f},poolTokenIn:{assetId:n.poolTokenID,amount:u},internalSwapQuote:{amountIn:{assetId:n.asset2ID,amount:p},amountOut:{assetId:n.asset1ID,amount:f},swapFees:{assetId:n.asset2ID,amount:m},priceImpact:g}}}else{if(o!==n.asset2ID)throw new Error("assetOutID must be one of the pool assets");var x=or.calculateFixedInputSwap({inputSupply:r.asset1-c,outputSupply:r.asset2-p,swapInputAmount:c,totalFeeShare:l,decimals:s}),A=x.swapOutputAmount,I=x.totalFeeAmount,h=x.priceImpact;e={round:r.round,assetOut:{assetId:o,amount:p+A},poolTokenIn:{assetId:n.poolTokenID,amount:u},internalSwapQuote:{amountIn:{assetId:n.asset2ID,amount:p},amountOut:{assetId:n.asset1ID,amount:A},swapFees:{assetId:n.asset2ID,amount:I},priceImpact:h}}}return e},generateTxns:function(t){return ur.apply(this,arguments)},generateSingleAssetOutTxns:function(t){return ir.apply(this,arguments)},signTxns:function(t){var e=t.txGroup;return(0,t.initiatorSigner)([e])},execute:function(t){return cr.apply(this,arguments)}},fr=(f(pr={},N.V1_1,{generateTxns:function(t){return Gn.apply(this,arguments)},getQuote:function(t){var e=t.pool,n=t.reserves,r=t.poolTokenIn,a=BigInt(r),o=n.issuedLiquidity&&a*n.asset1/n.issuedLiquidity,s=n.issuedLiquidity&&a*n.asset2/n.issuedLiquidity;return{round:n.round,poolTokenID:e.poolTokenID,poolTokenIn:a,asset1ID:e.asset1ID,asset1Out:o,asset2ID:e.asset2ID,asset2Out:s}},signTxns:function(t){return Wn.apply(this,arguments)},execute:function(t){return zn.apply(this,arguments)}}),f(pr,N.V2,dr),pr),mr=3n,gr=1000n;function xr(){return(xr=c(u().mark((function t(e){var n,r,o,s,i,c,p,l;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.pool,r=e.txGroup,o=e.initiatorSigner,t.next=3,o([r]);case 3:return s=t.sent,i=w(s,2),c=i[0],p=i[1],l=r.map((function(t,e){return e===lr.FEE_TXN_INDEX?c:e===lr.ASSET_IN_TXN_INDEX?p:a.default.signLogicSigTransactionObject(t.txn,n.account.lsig).blob})),t.abrupt("return",l);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ar(){return(Ar=c(u().mark((function t(e){var n,r,o,s,i,c,p,l,d,f,m,g,x,A,I,h,T,y,v,w;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.client,r=e.quoteAndPool,o=e.swapType,s=e.slippage,i=e.initiatorAddr,c=r.pool,p=r.quote,l=p.assetInID,d=p.assetOutID,f=c.account.address(),(m=[c.asset1ID,c.asset2ID]).includes(l)&&m.includes(d)&&l!==d){t.next=7;break}throw new M({pool:c,quote:p},"Input asset (#".concat(l,") and output asset (#").concat(d,") provided to generate transactions do not belong to the pool ").concat(f,"."));case 7:return t.next=9,n.getTransactionParams().do();case 9:return g=t.sent,x=[lt("swap"),o===exports.SwapType.FixedInput?lt("fi"):lt("fo")],A=a.default.makeApplicationNoOpTxnFromObject({from:f,appIndex:c.validatorAppID,appArgs:x,accounts:[i],note:mt.getAppCallTxnNoteWithClientName(N.V1_1),foreignAssets:0==c.asset2ID?[c.asset1ID,c.poolTokenID]:[c.asset1ID,c.asset2ID,c.poolTokenID],suggestedParams:g}),I=o===exports.SwapType.FixedOutput?tt("positive",s,p.assetInAmount):p.assetInAmount,h=0===l?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:i,to:f,amount:I,suggestedParams:g}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:i,to:f,assetIndex:l,amount:I,suggestedParams:g}),T=o===exports.SwapType.FixedInput?tt("negative",s,p.assetOutAmount):p.assetOutAmount,y=0===d?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:f,to:i,amount:T,suggestedParams:g}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:f,to:i,assetIndex:d,amount:T,suggestedParams:g}),v=a.default.makePaymentTxnWithSuggestedParamsFromObject({from:i,to:f,amount:A.fee+y.fee,note:O,suggestedParams:g}),w=a.default.assignGroupID([v,A,h,y]),t.abrupt("return",[{txn:w[0],signers:[i]},{txn:w[1],signers:[f]},{txn:w[2],signers:[i]},{txn:w[3],signers:[f]}]);case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ir(t){var e=t.pool,n=t.reserves,r=t.assetIn,a=t.decimals;if(e.status!==exports.PoolStatus.READY)throw new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"There is not an available pool for this asset pair");var o,u,i,c=BigInt(r.amount);if(r.id===e.asset1ID)o=e.asset2ID,u=n.asset1,i=n.asset2;else{if(r.id!==e.asset2ID)throw new D(exports.SwapQuoteErrorType.AssetDoesNotBelongToPoolError,"Input asset (#".concat(r.id,") doesn't belong to the pool ").concat(e.account.address(),"."));o=e.asset1ID,u=n.asset2,i=n.asset1}var p=c*mr/gr,l=i-u*i/(u+(c-p));if(l>i)throw new D(exports.SwapQuoteErrorType.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");var d={assetIn:{amount:c,decimals:a.assetIn},assetOut:{amount:l,decimals:a.assetOut}},f={round:n.round,assetInID:r.id,assetInAmount:c,assetOutID:o,assetOutAmount:l,swapFee:Number(p),rate:Kt(d),priceImpact:Ht(s({inputSupply:u,outputSupply:i},d))};return{type:exports.SwapQuoteType.Direct,data:{pool:e,quote:f}}}function hr(t){return Tr.apply(this,arguments)}function Tr(){return(Tr=c(u().mark((function t(e){var n,r,a,o,s,i,c,p,l,d,f,m,g,x,A,I;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,a=e.signedTxns,o=e.assetIn,s=e.assetOut,i=e.initiatorAddr,t.next=3,Ie({client:n,pool:r,accountAddr:i});case 3:return c=t.sent,t.next=6,st(n,[a]);case 6:return p=t.sent,l=w(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,t.next=13,Ie({client:n,pool:r,accountAddr:i});case 13:return g=t.sent,s.id===r.asset1ID?(x=c.excessAsset1,A=g.excessAsset1):(x=c.excessAsset2,A=g.excessAsset2),(I=A-x)<0n&&(I=0n),t.abrupt("return",{round:f,assetInID:o.id,assetInAmount:BigInt(o.amount),assetOutID:s.id,assetOutAmount:BigInt(s.amount)+I,excessAmount:{assetID:s.id,excessAmountForSwap:I,totalExcessAmount:A},txnID:m});case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function yr(t){var e=t.pool,n=t.reserves,r=t.assetOut,a=t.decimals;if(e.status!==exports.PoolStatus.READY)throw new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"There is not an available pool for this asset pair");var o,s,u,i=BigInt(r.amount);if(r.id===e.asset1ID)o=e.asset2ID,s=n.asset2,u=n.asset1;else{if(r.id!==e.asset2ID)throw new D(exports.SwapQuoteErrorType.AssetDoesNotBelongToPoolError,"Output asset (#".concat(r.id,") doesn't belong to the pool ").concat(e.account.address(),"."));o=e.asset1ID,s=n.asset1,u=n.asset2}if(i>u)throw new D(exports.SwapQuoteErrorType.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");var c=s*u/(u-i)-s,p=c*gr/(gr-mr),l=p-c,d=et(a.assetOut,Number(i))/et(a.assetIn,Number(p)),f=et(a.assetOut,Number(u))/et(a.assetIn,Number(s)),m=rt({decimalPlaces:5},Math.abs(d/f-1)),g={round:n.round,assetInID:o,assetInAmount:p,assetOutID:r.id,assetOutAmount:i,swapFee:Number(l),rate:d,priceImpact:m};return{type:exports.SwapQuoteType.Direct,data:{pool:e,quote:g}}}function vr(t){return wr.apply(this,arguments)}function wr(){return(wr=c(u().mark((function t(e){var n,r,a,o,s,i,c,p,l,d,f,m,g,x,A,I;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,a=e.signedTxns,o=e.assetIn,s=e.assetOut,i=e.initiatorAddr,t.next=3,Ie({client:n,pool:r,accountAddr:i});case 3:return c=t.sent,t.next=6,st(n,[a]);case 6:return p=t.sent,l=w(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,t.next=13,Ie({client:n,pool:r,accountAddr:i});case 13:return g=t.sent,o.id===r.asset1ID?(x=c.excessAsset1,A=g.excessAsset1):(x=c.excessAsset2,A=g.excessAsset2),(I=A-x)<0n&&(I=0n),t.abrupt("return",{round:f,assetInID:o.id,assetInAmount:BigInt(o.amount)-I,assetOutID:s.id,assetOutAmount:BigInt(s.amount),excessAmount:{assetID:o.id,excessAmountForSwap:I,totalExcessAmount:A},txnID:m});case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _r(){return(_r=c(u().mark((function t(e){var n,r,a,o,i,c,p,l,d,f;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.client,r=e.pool,a=e.swapType,o=e.txGroup,i=e.signedTxns,c=e.initiatorAddr,r.status===exports.PoolStatus.READY){t.next=3;break}throw new M({pool:r,swapType:a,txGroup:o},"There is not an available pool for this asset pair");case 3:if(t.prev=3,p={id:o[lr.ASSET_IN_TXN_INDEX].txn.assetIndex||0,amount:o[lr.ASSET_IN_TXN_INDEX].txn.amount},l={id:o[lr.ASSET_OUT_TXN_INDEX].txn.assetIndex||0,amount:o[lr.ASSET_OUT_TXN_INDEX].txn.amount},a!==exports.SwapType.FixedInput){t.next=12;break}return t.next=9,hr({client:n,pool:r,signedTxns:i,assetIn:p,assetOut:l,initiatorAddr:c});case 9:d=t.sent,t.next=15;break;case 12:return t.next=14,vr({client:n,pool:r,signedTxns:i,assetIn:p,assetOut:l,initiatorAddr:c});case 14:d=t.sent;case 15:return t.abrupt("return",s(s({},d),{},{groupID:ct(o),fees:it(o)}));case 18:throw t.prev=18,t.t0=t.catch(3),"SlippageTolerance"===(f=new M(t.t0,"We encountered something unexpected while swapping. Try again later.")).type&&f.setMessage("The swap failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),f;case 23:case"end":return t.stop()}}),t,null,[[3,18]])})))).apply(this,arguments)}!function(t){t[t.FEE_TXN_INDEX=0]="FEE_TXN_INDEX",t[t.VALIDATOR_APP_CALL_TXN_INDEX=1]="VALIDATOR_APP_CALL_TXN_INDEX",t[t.ASSET_IN_TXN_INDEX=2]="ASSET_IN_TXN_INDEX",t[t.ASSET_OUT_TXN_INDEX=3]="ASSET_OUT_TXN_INDEX"}(lr||(lr={}));var Sr,Er={getQuote:function(t,e,n,r,a){return t===exports.SwapType.FixedInput?Ir({pool:e,reserves:n,assetIn:r,decimals:a}):yr({pool:e,reserves:n,assetOut:r,decimals:a})},getFixedInputSwapQuote:Ir,getFixedOutputSwapQuote:yr,generateTxns:function(t){return Ar.apply(this,arguments)},signTxns:function(t){return xr.apply(this,arguments)},execute:function(t){return _r.apply(this,arguments)},executeFixedOutputSwap:vr};function br(t){return Promise.allSettled(t).then((function(t){if(t.every((function(t){return"rejected"===t.status}))){var e=w(t.map((function(t){return t.reason})),2),n=e[0],r=e[1];if(re(n)&&!re(r))throw n;throw r}return t.filter((function(t){return"fulfilled"===t.status&&t.value})).map((function(t){return t.value}))}))}function Dr(){return(Dr=c(u().mark((function t(e){var n,r,a,o,s,i,c,p,l,d;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.amount,a=e.assetIn,o=e.assetOut,s=e.isSwapRouterEnabled,i=e.pools,c=[],(p=i.find((function(t){return t.info.contractVersion===N.V1_1})))?c.push(new Promise((function(t,e){try{t(Er.getFixedInputSwapQuote({pool:p.info,assetIn:{amount:r,id:Number(a.id)},decimals:{assetIn:a.decimals,assetOut:o.decimals},reserves:p.reserves}))}catch(t){e(t)}}))):c.push(Promise.reject(new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"Trying to swap from non-existent pool"))),l=i.find((function(t){return t.info.contractVersion===N.V2})),c.push(or.getFixedInputSwapQuote({amount:r,assetIn:{id:X(a),decimals:a.decimals},assetOut:{id:X(o),decimals:o.decimals},pool:null!==(n=null==l?void 0:l.info)&&void 0!==n?n:null,isSwapRouterEnabled:s,network:e.network})),t.next=8,br(c);case 8:return d=t.sent,t.abrupt("return",ne(d));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Or(){return(Or=c(u().mark((function t(e){var n,r,a,o,s,i,c,p,l,d;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.amount,a=e.assetIn,o=e.assetOut,s=e.pools,i=e.isSwapRouterEnabled,c=[],(p=s.find((function(t){return t.info.contractVersion===N.V1_1})))?c.push(new Promise((function(t,e){try{t(Er.getFixedOutputSwapQuote({pool:p.info,assetOut:{amount:r,id:Number(o.id)},decimals:{assetIn:a.decimals,assetOut:o.decimals},reserves:p.reserves}))}catch(t){e(t)}}))):c.push(Promise.reject(new D(exports.SwapQuoteErrorType.NoAvailablePoolError,"Trying to swap from non-existent pool"))),l=s.find((function(t){return t.info.contractVersion===N.V2})),c.push(or.getFixedOutputSwapQuote({amount:r,assetIn:{id:X(a),decimals:a.decimals},assetOut:{id:X(o),decimals:o.decimals},pool:null!==(n=null==l?void 0:l.info)&&void 0!==n?n:null,isSwapRouterEnabled:i,network:e.network})),t.next=8,br(c);case 8:return d=t.sent,t.abrupt("return",ne(d));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Nr=(f(Sr={},N.V1_1,Er),f(Sr,N.V2,or),f(Sr,"getQuote",(function(t){var e=t.type;if(e===exports.SwapType.FixedInput)return function(t){return Dr.apply(this,arguments)}(t);if(e===exports.SwapType.FixedOutput)return function(t){return Or.apply(this,arguments)}(t);throw new D(exports.SwapQuoteErrorType.InvalidSwapTypeError,"Invalid swap type")})),f(Sr,"generateTxns",(function(t){return t.quote.type===exports.SwapQuoteType.Direct&&te(t.quote)===N.V1_1?Er.generateTxns(s(s({},t),{},{quoteAndPool:t.quote.data})):or.generateTxns(t)})),f(Sr,"signTxns",(function(t){if(t.quote.type===exports.SwapQuoteType.Direct&&te(t.quote)===N.V1_1){var e=t.quote.data.pool;return Er.signTxns(s(s({},t),{},{pool:e}))}return or.signTxns(t)})),f(Sr,"execute",(function(t){return t.contractVersion===N.V1_1?Er.execute(t):or.execute(t)})),Sr);function Pr(){return(Pr=c(u().mark((function t(e){var n,r,a,o,s,i,c,p,l,d;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,a=e.txGroup,o=e.initiatorSigner,t.prev=1,t.next=4,kr({txGroup:a,pool:r,initiatorSigner:o});case 4:return s=t.sent,t.next=7,st(n,[s]);case 7:return i=t.sent,c=w(i,1),p=c[0],l=p.txnID,d=p.confirmedRound,t.abrupt("return",{fees:it(a),confirmedRound:d,txnID:l,groupID:ct(a)});case 15:throw t.prev=15,t.t0=t.catch(1),new M(t.t0,"We encountered something unexpected while redeeming. Try again later.");case 18:case"end":return t.stop()}}),t,null,[[1,15]])})))).apply(this,arguments)}function kr(t){return Lr.apply(this,arguments)}function Lr(){return(Lr=c(u().mark((function t(e){var n,r,o,s,i,c,p,l;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.txGroup,r=e.pool,o=e.initiatorSigner,t.next=3,o([n]);case 3:return s=t.sent,i=w(s,1),c=i[0],p=r.account.lsig,l=n.map((function(t,e){return 0===e?c:a.default.signLogicSigTransactionObject(t.txn,p).blob})),t.abrupt("return",l);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Rr(){return Rr=c(u().mark((function t(e){var n,r,o,s,i,p;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.data,o=e.initiatorSigner,t.prev=1,s=r.map((function(t){var e=t.txGroup,n=t.pool;return{txns:e,txnFees:it(e),groupID:ct(e),lsig:n.account.lsig}})),t.next=5,o(s.map((function(t){return t.txns})));case 5:return i=t.sent,p=Promise.all(s.map((function(t,e){return new Promise(function(){var r=c(u().mark((function r(o,s){var c,p,l,d,f,m;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,c=t.txns.map((function(n,r){return 0===r?i[e]:a.default.signLogicSigTransactionObject(n.txn,t.lsig).blob})),r.next=4,st(n,[c]);case 4:p=r.sent,l=w(p,1),d=l[0],f=d.txnID,m=d.confirmedRound,o({fees:t.txnFees,groupID:t.groupID,txnID:f,confirmedRound:m}),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(0),s(r.t0);case 15:case"end":return r.stop()}}),r,null,[[0,12]])})));return function(t,e){return r.apply(this,arguments)}}())}))),t.abrupt("return",p);case 10:throw t.prev=10,t.t0=t.catch(1),new M(t.t0,"We encountered something unexpected while redeeming. Try again later.");case 13:case"end":return t.stop()}}),t,null,[[1,10]])}))),Rr.apply(this,arguments)}function Fr(){return(Fr=c(u().mark((function t(e){var n,r,o,s,i,c,p,l,d,f,m;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,o=e.assetID,s=e.assetOut,i=e.initiatorAddr,t.next=3,n.getTransactionParams().do();case 3:return c=t.sent,p=r.account.address(),l=a.default.makeApplicationNoOpTxnFromObject({from:p,appIndex:r.validatorAppID,appArgs:[lt("redeem")],note:mt.getAppCallTxnNoteWithClientName(r.contractVersion),accounts:[i],foreignAssets:0==r.asset2ID?[r.asset1ID,r.poolTokenID]:[r.asset1ID,r.asset2ID,r.poolTokenID],suggestedParams:c}),d=0===o?a.default.makePaymentTxnWithSuggestedParamsFromObject({from:p,to:i,amount:BigInt(s),suggestedParams:c}):a.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:i,assetIndex:o,amount:BigInt(s),suggestedParams:c}),f=a.default.makePaymentTxnWithSuggestedParamsFromObject({from:i,to:p,amount:l.fee+d.fee,note:O,suggestedParams:c}),m=a.default.assignGroupID([f,l,d]),t.abrupt("return",[{txn:m[0],signers:[i]},{txn:m[1],signers:[p]},{txn:m[2],signers:[p]}]);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Br(e){var n=e.suggestedParams,r=e.stakingAppID,a=e.initiatorAddr,o=e.liquidityAssetID,s=e.program,u=e.amount,i=t.encodeUint64(u),c=t.encodeUint64(s.id);return t.makeApplicationNoOpTxnFromObject({appIndex:r,from:a,suggestedParams:n,foreignAssets:[o],accounts:[s.accountAddress],appArgs:[lt("commit"),i],note:U([lt("tinymanStaking/v1:b"),c,t.encodeUint64(o),i])})}function Mr(){return(Mr=c(u().mark((function e(n){var r,a,o,s,i,c,p,l,d,f,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,a=n.stakingAppID,o=n.program,s=n.requiredAssetID,i=n.liquidityAssetID,c=n.amount,p=n.initiatorAddr,e.next=3,r.getTransactionParams().do();case 3:if(l=e.sent,d=Br({suggestedParams:l,stakingAppID:a,program:o,liquidityAssetID:i,initiatorAddr:p,amount:c}),f=[d],"number"!=typeof s){e.next=10;break}return m=t.makeApplicationNoOpTxnFromObject({appIndex:a,from:p,suggestedParams:l,foreignAssets:[s],accounts:[o.accountAddress],appArgs:[lt("log_balance")]}),f=t.assignGroupID([d,m]),e.abrupt("return",[{txn:f[0],signers:[p]},{txn:f[1],signers:[p]}]);case 10:return e.abrupt("return",[{txn:f[0],signers:[p]}]);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}exports.ALGO_ASSET=P,exports.ALGO_ASSET_ID=0,exports.ASSET_OPT_IN_PROCESS_TXN_COUNT=1,exports.AddLiquidity=jn,exports.BASE_MINIMUM_BALANCE=1e5,exports.Bootstrap=pn,exports.CONTRACT_VERSION=N,exports.MINIMUM_ADD_LIQUIDITY_AMOUNT=1e3,exports.MINIMUM_BALANCE_REQUIRED_PER_APP=1e5,exports.MINIMUM_BALANCE_REQUIRED_PER_ASSET=1e5,exports.MINIMUM_BALANCE_REQUIRED_PER_BYTE_SCHEMA=5e4,exports.MINIMUM_BALANCE_REQUIRED_PER_INT_SCHEMA_VALUE=28500,exports.OPT_IN_VALIDATOR_APP_PROCESS_TXN_COUNT=1,exports.OPT_OUT_VALIDATOR_APP_PROCESS_TXN_COUNT=1,exports.POOL_TOKEN_UNIT_NAME=k,exports.REDEEM_PROCESS_TXN_COUNT=3,exports.RemoveLiquidity=fr,exports.Swap=Nr,exports.SwapQuoteError=D,exports.V1_1_ADD_LIQUIDITY_PROCESS_TXN_COUNT=5,exports.V1_1_REMOVE_LIQUIDITY_TXN_COUNT=qn,exports.V2AddLiquidityTxnIndices=An,exports.V2_REMOVE_LIQUIDITY_APP_CALL_INNER_TXN_COUNT=2,exports.applySlippageToAmount=tt,exports.calculateAccountMinimumRequiredBalance=me,exports.calculatePriceImpact=Ht,exports.calculateSwapRate=Kt,exports.combineAndRegroupSignerTxns=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=n.flat(),o=a.map((function(e){var n=e.txn;return n.group=void 0,t.decodeUnsignedTransaction(t.encodeUnsignedTransaction(n))})),u=t.assignGroupID(o);return a.map((function(t,e){return s(s({},t),{},{txn:u[e]})}))},exports.convertFromBaseUnits=et,exports.convertToBaseUnits=nt,exports.generateOptIntoAssetTxns=function(t){return Q.apply(this,arguments)},exports.generateOptIntoValidatorTxns=function(t){return At.apply(this,arguments)},exports.generateOptOutOfValidatorTxns=function(t){return ht.apply(this,arguments)},exports.generateRedeemTxns=function(t){return Fr.apply(this,arguments)},exports.generateSwapRouterAssetOptInTransaction=Mt,exports.generateSwapRouterTxns=Vt,exports.getAccountExcess=function(t){return Te.apply(this,arguments)},exports.getAccountExcessWithinPool=Ie,exports.getAccountInformation=de,exports.getAddLiquidityTotalFee=function(e){switch(e.version){case N.V1_1:return gn;case N.V2:return n=e.type,(In[n]+hn[n])*t.ALGORAND_MIN_TX_FEE;default:throw new Error("Provided contract version was not valid.")}var n},exports.getAssetInAndAssetOutFromSwapQuote=function(t){return{assetIn:Zt(t),assetOut:$t(t)}},exports.getAssetInAndOutFromSwapRoute=Bt,exports.getAssetInFromSwapQuote=Zt,exports.getAssetInFromSwapRoute=Ft,exports.getAssetOutFromSwapQuote=$t,exports.getAssetOutFromSwapRoute=Rt,exports.getBestQuote=ne,exports.getMinRequiredBalanceToOptIn=function(t){var e,n=t.currentMinumumBalanceForAccount,r=t.suggestedTransactionFee;if("app-opt-in"===t.type){var a=le(t.contractVersion);e=1e5+5e4*a.schema.numLocalByteSlices+28500*a.schema.numLocalInts}else e=1e5;return e+(n||0)+(r||0)},exports.getStakingAppID=function(t){return"testnet"===t?51948952:649588853},exports.getSwapAppCallFeeAmount=Yt,exports.getSwapQuoteContractVersion=te,exports.getSwapQuotePriceImpact=function(t){return t.type===exports.SwapQuoteType.Router?Number(t.data.price_impact):t.data.quote.priceImpact},exports.getSwapQuoteRate=ee,exports.getSwapRoute=qt,exports.getSwapRouteRate=kt,exports.getSwapRouterAppID=Lt,exports.getSwapRouterAppOptInRequiredAssetIDs=jt,exports.getSwapTotalFee=function(t){switch(t.version){case N.V1_1:return Gt;case N.V2:return Wt(t.type);default:throw new Error("Provided contract version was not valid.")}},exports.getTxnGroupID=ct,exports.getV2MinSwapAssetInAmount=zt,exports.getV2SwapTotalFee=Wt,exports.getValidatorAppID=xt,exports.hasSufficientMinimumBalance=function(t){return t.amount>=t.minimum_required_balance},exports.isAccountOptedIntoApp=function(t){var e=t.appID;return t.accountAppsLocalState.some((function(t){return t.id===e}))},exports.isSwapAssetInAmountLow=Jt,exports.isSwapQuoteErrorCausedByAmount=re,exports.poolUtils=Qe,exports.prepareCommitTransactions=function(t){return Mr.apply(this,arguments)},exports.redeemAllExcessAsset=function(t){return Rr.apply(this,arguments)},exports.redeemExcessAsset=function(t){return Pr.apply(this,arguments)},exports.sendAndWaitRawTransaction=st,exports.sumUpTxnFees=it,exports.tinymanContract_v1_1=ue,exports.tinymanContract_v2=pe,exports.tinymanJSSDKConfig=mt;
>>>>>>> feat/tiny-970-swap-router
